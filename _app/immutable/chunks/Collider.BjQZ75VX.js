import{c as F,b as Q}from"./disclose-version.CY5IDNoG.js";import{p as M,aj as O,D as s,y as E,E as j,t as z}from"./runtime.XPaRurxh.js";import{s as L}from"./snippet.CMdN7rSJ.js";import{p as V}from"./props.Dz65N0hT.js";import{o as S,a as _}from"./index-client.D5mbYn_g.js";import{u as k,a as G,b as H,c as q,d as B,R as J,o as K,A as h,e as N,f as U,g as X,h as Y}from"./createCollidersFromChildren.DijvmNJY.js";import{O as Z,V as l,Q as m,a as p,r as $,s as ee,w as te}from"./T.y93Wq12a.js";const ne=(i,e)=>{const t=Array.from(i);for(let o=0;o<i.length/3;o++)t[o*3]*=e.x,t[o*3+1]*=e.y,t[o*3+2]*=e.z;return t},oe=(i,e,t)=>{const o=e.slice();if(i==="heightfield")return o;if(i==="trimesh"||i==="convexHull")return o[0]=new Float32Array(ne(o[0],t)),o;const c=[t.x,t.y,t.z];return o.map((a,r)=>(c[r]??1)*a)};function de(i,e){M(e,!0);let t=V(e,"collider",15);const o=new Z,{updateRef:c}=k(e.oncreate),a=G(),r=H(),u=!!a,d=q(),{world:g}=d,C=B(),y={oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit};S(async()=>{await O();const n=o.getWorldScale(new l),b=oe(e.shape,e.args,n),D=J[e.shape](...b);if(t(g.createCollider(D,a)),t().setActiveCollisionTypes(K.ALL),c(t()),d.addColliderToContext(t(),o,y),C.registerColliders([t()]),u){const w=new l,f=new m;r==null||r.getWorldPosition(w),r==null||r.getWorldQuaternion(f),f.invert();const I=o.getWorldPosition(new l).sub(w),T=o.getWorldQuaternion(new m).premultiply(f);t().setTranslationWrtParent(I),t().setRotationWrtParent(T)}else t().setTranslation(o.getWorldPosition(new l)),t().setRotation(o.getWorldQuaternion(new m))}),s(()=>{var n;(n=t())==null||n.setRestitution(e.restitution??0)}),s(()=>{var n;(n=t())==null||n.setRestitutionCombineRule(e.restitutionCombineRule??h.Average)}),s(()=>{var n;(n=t())==null||n.setFriction(e.friction??.7)}),s(()=>{var n;(n=t())==null||n.setFrictionCombineRule(e.frictionCombineRule??h.Average)}),s(()=>{var n;return(n=t())==null?void 0:n.setSensor(e.sensor??!1)}),s(()=>{var n;return(n=t())==null?void 0:n.setContactForceEventThreshold(e.contactForceEventThreshold??0)}),s(()=>{var n;e.density!==void 0&&((n=t())==null||n.setDensity(e.density))}),s(()=>{t()&&e.mass&&(e.centerOfMass&&e.principalAngularInertia&&e.angularInertiaLocalFrame?t().setMassProperties(e.mass,{x:e.centerOfMass[0],y:e.centerOfMass[1],z:e.centerOfMass[2]},{x:e.principalAngularInertia[0],y:e.principalAngularInertia[1],z:e.principalAngularInertia[2]},N(e.angularInertiaLocalFrame)):t().setMass(e.mass))}),s(()=>{var n;t()&&U(t(),y,(n=a==null?void 0:a.userData)==null?void 0:n.events)});const v=()=>{t()&&(t().setTranslation(X(o)),t().setRotation(Y(o)))},{start:x,stop:R}=p(()=>{v()},{autoStart:!u&&e.type==="dynamic"});s(()=>{!u&&e.type==="dynamic"?x():R()}),_(()=>{t()&&(d.removeColliderFromContext(t()),C.removeColliders([t()]),g.removeCollider(t(),!0),t(void 0))});const P=$();ee(o),te(P,n=>(n==null||n.add(o),()=>{n==null||n.remove(o)}));var A=F(),W=E(A);return L(W,()=>e.children??j,()=>({collider:t()})),Q(i,A),z({refresh:v})}export{de as C};
