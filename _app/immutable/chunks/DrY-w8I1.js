import{g as W,a as m}from"./a6heQtOT.js";import{l as f,s as v,a3 as L,u as s,ar as z,a6 as F,aa as K,a7 as Q,a8 as U,as as q}from"./DGLrSMKY.js";import"./DsnmJJEf.js";import{s as H}from"./BXYCPDa6.js";import{p as r}from"./D7NB5tT8.js";import{_ as J,g2 as X,g3 as Y,g4 as Z,V as $}from"./C_yIfSnU.js";import{i as ee,p as C,b as te,g as ne,a as oe,s as ie,E as h}from"./DbMPvVxC.js";const ae=()=>f("threlte-rapier-context"),D=(o,e)=>{o.forEach(t=>{t&&t.collider&&t.collider.isValid()&&t.collider.setCollisionGroups(e)})},xe=()=>{const o=new Map,e=f("threlte-rapier-collision-group");if(!e)return{registerColliders:()=>{},removeColliders:()=>{}};let t=W(e);const i=e.subscribe(d=>{t=d,D(o,d)});return m(i),{registerColliders:d=>{d.forEach(c=>{o.has(c.handle)||o.set(c.handle,{collider:c,initialCollisionGroup:c.collisionGroups()})}),D(o,t)},removeColliders:d=>{d.forEach(c=>{const g=o.get(c.handle);g&&c&&c.isValid()&&c.setCollisionGroups(g.initialCollisionGroup),o.delete(c.handle)})}}},Re=()=>f("threlte-rapier-rigidbody"),S=Symbol("threlte-rapier-rigidbody-object3d"),Ce=()=>f(S),se=o=>{v(S,o)},re=o=>{const e=[];let t;const i=()=>{if(e.forEach(d=>d()),e.length=0,t===void 0)return;const l=o?.(t);l&&e.push(l)},u=l=>{t=l,i()};return m(()=>{e.forEach(l=>l())}),{updateRef:u}},T={position:["setTranslation","setNextKinematicTranslation"],rotation:["setRotation","setNextKinematicRotation"]},le=(o,e)=>{const t={};T.position.forEach(i=>{t[i]=o[i].bind(o);const u=(...l)=>(e.userData.physics.resetPosition=!0,t[i](...l));o[i]=u}),T.rotation.forEach(i=>{t[i]=o[i].bind(o);const u=(...l)=>(e.userData.physics.resetRotation=!0,t[i](...l));o[i]=u})};function he(o,e){L(e,!0);const{world:t,rapier:i,addRigidBodyToContext:u,removeRigidBodyFromContext:l}=ae();let d=r(e,"type",3,"dynamic"),c=r(e,"canSleep",3,!0),g=r(e,"gravityScale",3,1),k=r(e,"ccd",3,!1),V=r(e,"angularDamping",3,0),E=r(e,"linearDamping",3,0),w=r(e,"lockRotations",3,!1),B=r(e,"lockTranslations",3,!1),O=r(e,"enabledRotations",19,()=>[!0,!0,!0]),M=r(e,"enabledTranslations",19,()=>[!0,!0,!0]),P=r(e,"dominance",3,0),G=r(e,"enabled",3,!0),j=r(e,"userData",19,()=>({})),_=r(e,"rigidBody",15);const{updateRef:I}=re(e.oncreate),a=new J;ee(a),a.userData.isSleeping=!1;const N=new i.RigidBodyDesc(C(d())).setCanSleep(c());let n=t.createRigidBody(N);le(n,a),_(n),(async()=>{await q(),a.updateMatrix(),a.updateWorldMatrix(!0,!1);const y=a.parent?te(a.parent):new $(1,1,1),x=ne(a).multiply(y),R=oe(a);ie(a,x,R),n.setTranslation(x,!0),n.setRotation(R,!0),I(n)})(),a.userData.rigidBody=n,s(()=>n.setBodyType(C(d()),!0)),s(()=>{e.linearVelocity&&n.setLinvel({x:e.linearVelocity[0],y:e.linearVelocity[1],z:e.linearVelocity[2]},!0)}),s(()=>{e.angularVelocity&&n.setAngvel({x:e.angularVelocity[0],y:e.angularVelocity[1],z:e.angularVelocity[2]},!0)}),s(()=>n.setGravityScale(g(),!0)),s(()=>n.enableCcd(k())),s(()=>n.setDominanceGroup(P())),s(()=>n.lockRotations(w(),!0)),s(()=>n.lockTranslations(B(),!0)),s(()=>n.setEnabledRotations(...O(),!0)),s(()=>n.setEnabledTranslations(...M(),!0)),s(()=>n.setAngularDamping(V())),s(()=>n.setLinearDamping(E())),s(()=>n.setEnabled(G())),s(()=>{n.userData={events:{oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit,onsleep:e.onsleep,onwake:e.onwake},...j()}}),v("threlte-rapier-rigidbody",n),se(a),u(n,a,{oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit,onsleep:e.onsleep,onwake:e.onwake}),m(()=>{l(n),t.removeRigidBody(n)});const p=X();Y(a),Z(p,y=>(y?.add(a),()=>{y?.remove(a)}));var b=z(),A=F(b);H(A,()=>e.children??K,()=>({rigidBody:n})),Q(o,b),U()}const De=(o,e={},t={})=>{let i=0;(e.oncollisionenter||e.oncollisionexit||t.oncollisionenter||t.oncollisionexit||e.onsensorenter||e.onsensorexit||t.onsensorenter||t.onsensorexit)&&(i=i|h.COLLISION_EVENTS),(e.oncontact||t.oncontact)&&(i=i|h.CONTACT_FORCE_EVENTS),i>0&&o.setActiveEvents(i)};export{he as R,Re as a,Ce as b,ae as c,xe as d,De as e,re as u};
