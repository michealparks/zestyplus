import{c as h,a as R}from"./disclose-version.dWtSGD-r.js";import{a0 as W,w as S,z as c,a2 as b,a1 as q,C as H,D as L,B as j}from"./runtime.liGrBqgh.js";import{e as Q,i as U}from"./each.DIW0GBHS.js";import{c as _}from"./svelte-component.bmro9bRp.js";import{a as p,p as D}from"./props.B9ZiqexT.js";import{V as f}from"./three.module.iKKkBh6O.js";import{i as X,u as Z,o as $,T as A}from"./T.Bd7S2fO2.js";import{c as tt,Y as et,i as rt}from"./createCollidersFromChildren.B-8rqJtL.js";import{a as nt}from"./index-client.jWRNFgTM.js";import{d as st,g as ot,w as I}from"./index.y_WUssML.js";import{C as it}from"./Collider.BGbyoF5h.js";const at=a=>{const t=I(void 0),m=I(void 0),u=tt(),s=st([t,m],([e,r])=>{if(e&&r)return[e,r]}),l=I(void 0),d=s.subscribe(e=>{e&&l.set(a(...e,u))});return nt(()=>{d();const e=ot(l);e&&(e instanceof et?u.world.removeMultibodyJoint(e,!0):u.world.removeImpulseJoint(e,!0))}),{joint:l,rigidBodyA:t,rigidBodyB:m}},z=a=>X(a,"Vector3"),dt=(a,t,m)=>at((u,s,{world:l,rapier:d})=>{const e=z(a)?a:new f(...a),r=z(t)?t:new f(...t),g=d.JointData.rope(m,e,r);return l.createImpulseJoint(g,u,s,!0)});function pt(a,t){W(t,!0);let m=p(t,"startRigidBody",15),u=p(t,"lastRigidBody",15),s=p(t,"positions",15),l=j(()=>t.length/(t.segments-1)),d=H(!1);const e=j(()=>Array.from({length:t.segments-1},()=>dt([0,0,0],[0,0,0],c(l))));s(new Float32Array(t.segments));const r=D([]);S(()=>{m(r.at(0)),u(r.at(-1))});const g=D([]),V=new f().fromArray(t.ropeStart),C=new f().fromArray(t.ropeEnd),E=o=>{const n=o/(t.segments-1);return V.clone().lerp(C,n)};S(()=>{r.length!==t.segments||g.length!==t.segments||c(d)||(c(e).forEach((o,n)=>{o.rigidBodyA.set(r[n]),o.rigidBodyB.set(r[n+1])}),L(d,!0))}),D(Array.from({length:t.segments},()=>new f(0,0,0)));const y=new f;Z(()=>{var o;if(c(d))for(let n=0,i=0,B=g.length;n<B;n+=1,i+=3)(o=g[n])==null||o.getWorldPosition(y),s(s()[i+0]=y.x,!0),s(s()[i+1]=y.y,!0),s(s()[i+2]=y.z,!0)}),$(()=>[c(d),t.ropeStart,t.ropeEnd],([o])=>{var n;o&&((n=m())==null||n.setNextKinematicTranslation({x:t.ropeStart[0],y:t.ropeStart[1],z:t.ropeStart[2]}))});var J=h(),T=b(J);Q(T,17,()=>({length:t.segments}),U,(o,n,i)=>{var B=h(),k=b(B);_(k,()=>A.Group,(O,Y)=>{Y(O,{oncreate:v=>{v.position.copy(E(i))},children:(v,mt)=>{rt(v,{get linearDamping(){return t.damping},get angularDamping(){return t.damping},type:i===0?"kinematicPosition":"dynamic",get rigidBody(){return r[i]},set rigidBody(w){r[i]=w},children:(w,ut)=>{var x=j(()=>[t.ballRadius]);it(w,{shape:"ball",get args(){return c(x)},children:(F,lt)=>{var P=h(),G=b(P);_(G,()=>A.Object3D,(K,M)=>{M(K,{get ref(){return g[i]},set ref(N){g[i]=N}})}),R(F,P)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),R(o,B)}),R(a,J),q()}export{pt as default};
