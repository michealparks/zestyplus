var rt=e=>{throw TypeError(e)};var Fe=(e,t,r)=>t.has(e)||rt("Cannot "+r);var C=(e,t,r)=>(Fe(e,t,"read from private field"),r?r.call(e):t.get(e)),k=(e,t,r)=>t.has(e)?rt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),ne=(e,t,r,i)=>(Fe(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),ze=(e,t,r)=>(Fe(e,t,"access private method"),r);import{c as X,a as z,t as O,d as Ft}from"./disclose-version.hHKxC-Jk.js";import{h as Gt,aK as kt,af as Vt,aL as $t,E as Wt,aM as jt,aN as Kt,m as Xt,u as Qt,L as it,al as Yt,q as Zt,n as te,aO as Jt,ax as st,ap as nt,W as qt,a0 as W,a2 as L,a1 as j,z as T,C as V,a8 as D,a9 as P,D as I,w as $,B as Te,a3 as N,a7 as le,at,aP as er}from"./runtime.BZbTZrfI.js";import{i as G}from"./if.DbWg_N7N.js";import{s as Oe}from"./snippet.BOLubvD_.js";import{b as Ve}from"./this.BM1gElvp.js";import{r as yt,s as tr,p as Z,b as rr,c as ot}from"./props.DC6YhwhV.js";import{c as ir}from"./cache.BsMMbLZ9.js";import{h as sr,g as nr,j as ar,k as or,l as lr,m as ur,n as cr,p as fr,q as Tt,a as hr,u as dr}from"./T.DXVn7S3O.js";import{c as vr}from"./user.Cfi8szMa.js";import{a as pr,o as Ee,d as Xe,s as ce}from"./render.CYzfISmf.js";import{o as _t}from"./types.Dwph6ITp.js";import{u as xe,t as De,K as Se,s as lt}from"./keybindings.svelte.hmu8biEM.js";import{u as mr}from"./analyser.svelte.ARxWFVcG.js";import{u as Et}from"./auth.svelte.C3nh3yTw.js";import{g as F,ae as fe,af as H,ag as gr,ah as xr,ai as Sr,aj as yr,ak as ie,al as A,am as He,a8 as ut,an as Tr,M as _r,ao as Ie,i as Ae,D as Ce,h as de,ap as Er,aq as Qe,ar as wt,as as Mt,R as Rt,at as ye,a7 as wr,p as Mr,B as ct,au as bt,av as Bt,C as Rr,H as ft}from"./three.module.iKKkBh6O.js";import"./legacy.DAlpyf03.js";import{i as Ye}from"./lifecycle.dIvfKtke.js";import{e as Ze,i as Ut}from"./each.BwHTd-Qj.js";function ve(e,t,r,i){var a=e.__attributes??(e.__attributes={});Gt&&(a[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||a[t]!==(a[t]=r)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[kt]=r),r==null?e.removeAttribute(t):typeof r!="string"&&br(e).includes(t)?e[t]=r:e.setAttribute(t,r))}var ht=new Map;function br(e){var t=ht.get(e.nodeName);if(t)return t;ht.set(e.nodeName,t=[]);for(var r,i=e,a=Element.prototype;a!==i;){r=$t(i);for(var u in r)r[u].set&&t.push(u);i=Vt(i)}return t}function Br(e,t,r){if(r){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}const Ur=()=>performance.now(),q={tick:e=>requestAnimationFrame(e),now:()=>Ur(),tasks:new Set};function zt(){const e=q.now();q.tasks.forEach(t=>{t.c(e)||(q.tasks.delete(t),t.f())}),q.tasks.size!==0&&q.tick(zt)}function zr(e){let t;return q.tasks.size===0&&q.tick(zt),{promise:new Promise(r=>{q.tasks.add(t={c:e,f:r})}),abort(){q.tasks.delete(t)}}}function Pe(e,t){e.dispatchEvent(new CustomEvent(t))}function Ar(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function dt(e){const t={},r=e.split(";");for(const i of r){const[a,u]=i.split(":");if(!a||u===void 0)break;const c=Ar(a.trim());t[c]=u.trim()}return t}const Cr=e=>e;function Je(e,t,r,i){var a=(e&Jt)!==0,u="both",c,v=t.inert,l=t.style.overflow,s,h;function n(){var y=qt,M=it;st(null),nt(null);try{return c??(c=r()(t,(i==null?void 0:i())??{},{direction:u}))}finally{st(y),nt(M)}}var o={is_global:a,in(){t.inert=v,Pe(t,"introstart"),s=$e(t,n(),h,1,()=>{Pe(t,"introend"),s==null||s.abort(),s=c=void 0,t.style.overflow=l})},out(y){t.inert=!0,Pe(t,"outrostart"),h=$e(t,n(),s,0,()=>{Pe(t,"outroend"),y==null||y()})},stop:()=>{s==null||s.abort(),h==null||h.abort()}},p=it;if((p.transitions??(p.transitions=[])).push(o),pr){var d=a;if(!d){for(var f=p.parent;f&&f.f&Wt;)for(;(f=f.parent)&&!(f.f&jt););d=!f||(f.f&Kt)!==0}d&&Xt(()=>{Qt(()=>o.in())})}}function $e(e,t,r,i,a){var u=i===1;if(Yt(t)){var c,v=!1;return Zt(()=>{if(!v){var y=t({direction:u?"in":"out"});c=$e(e,y,r,i,a)}}),{abort:()=>{v=!0,c==null||c.abort()},deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:()=>c.t()}}if(r==null||r.deactivate(),!(t!=null&&t.duration))return a(),{abort:te,deactivate:te,reset:te,t:()=>i};const{delay:l=0,css:s,tick:h,easing:n=Cr}=t;var o=[];if(u&&r===void 0&&(h&&h(0,1),s)){var p=dt(s(0,1));o.push(p,p)}var d=()=>1-i,f=e.animate(o,{duration:l});return f.onfinish=()=>{var y=(r==null?void 0:r.t())??1-i;r==null||r.abort();var M=i-y,g=t.duration*Math.abs(M),S=[];if(g>0){var m=!1;if(s)for(var x=Math.ceil(g/16.666666666666668),_=0;_<=x;_+=1){var b=y+M*n(_/x),B=dt(s(b,1-b));S.push(B),m||(m=B.overflow==="hidden")}m&&(e.style.overflow="hidden"),d=()=>{var w=f.currentTime;return y+M*n(w/g)},h&&zr(()=>{if(f.playState!=="running")return!1;var w=d();return h(w,1-w),!0})}f=e.animate(S,{duration:g,fill:"forwards"}),f.onfinish=()=>{d=()=>i,h==null||h(i,1-i),a()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=te)},deactivate:()=>{a=te},reset:()=>{i===0&&(h==null||h(1,0))},t:()=>d()}}const Pr=e=>{sr(e),ir();const{scene:t}=nr();ar(t),or(t),lr(),ur(e),cr(),fr(e),vr()};function Dr(e,t){W(t,!0);let r=yt(t,["$$slots","$$events","$$legacy","children"]);Pr(r);var i=X(),a=L(i);Oe(a,()=>t.children),z(e,i),j()}var Ir=O('<div class="svelte-1osucwe"><canvas class="svelte-1osucwe"><!></canvas></div>');function Nr(e,t){W(t,!0);let r=yt(t,["$$slots","$$events","$$legacy","children"]),i=V(void 0),a=V(void 0);var u=Ir(),c=D(u),v=D(c);{var l=s=>{Dr(s,tr({get dom(){return T(a)},get canvas(){return T(i)}},()=>r,{children:(h,n)=>{var o=X(),p=L(o);Oe(p,()=>t.children??te),z(h,o)},$$slots:{default:!0}}))};G(v,s=>{T(i)&&T(a)&&s(l)})}P(c),Ve(c,s=>I(i,s),()=>T(i)),P(u),Ve(u,s=>I(a,s),()=>T(a)),z(e,u),j()}const qe=window;function Or(e){let t=e.activeElement;for(;t!=null&&t.shadowRoot;){const r=t.shadowRoot.activeElement;if(r===t)break;t=r}return t}var pe,we;class Hr{constructor(t={}){k(this,pe);k(this,we);const{window:r=qe,document:i=r==null?void 0:r.document}=t;r!==void 0&&(ne(this,pe,i),ne(this,we,Tt(a=>{const u=Ee(r,"focusin",a),c=Ee(r,"focusout",a);return()=>{u(),c()}})))}get current(){var t;return(t=C(this,we))==null||t.call(this),C(this,pe)?Or(C(this,pe)):null}}pe=new WeakMap,we=new WeakMap;new Hr;function Lr(e){return typeof e=="function"}function _e(e,t){if(Lr(e)){const r=e;return r()??t??r()}return e??t??e}function Fr(e,t=250){let r=V(null);function i(...a){if(T(r))T(r).timeout&&clearTimeout(T(r).timeout);else{let u,c;const v=new Promise((l,s)=>{u=l,c=s});I(r,Z({timeout:null,runner:null,promise:v,resolve:u,reject:c}))}return T(r).runner=async()=>{if(!T(r))return;const u=T(r);I(r,null);try{u.resolve(await e.apply(this,a))}catch(c){u.reject(c)}},T(r).timeout=setTimeout(T(r).runner,typeof t=="function"?t():t),T(r).promise}return i.cancel=async()=>{(!T(r)||T(r).timeout===null)&&(await new Promise(a=>setTimeout(a,0)),!T(r)||T(r).timeout===null)||(clearTimeout(T(r).timeout),T(r).reject("Cancelled"),I(r,null))},i.runScheduledNow=async()=>{var a,u;(!T(r)||!T(r).timeout)&&(await new Promise(c=>setTimeout(c,0)),!T(r)||!T(r).timeout)||(clearTimeout(T(r).timeout),T(r).timeout=null,await((u=(a=T(r)).runner)==null?void 0:u.call(a)))},Object.defineProperty(i,"pending",{enumerable:!0,get(){var a;return!!((a=T(r))!=null&&a.timeout)}}),i}function vt(e,t,r,i){$(()=>{const a=_e(e),u=_e(t);if(a!=null)if(Array.isArray(u))for(const c of u)$(()=>Ee(a,c,r,i));else return Ee(a,u,r,i)})}const Gr=["keypress","mousemove","touchmove","click","scroll"],kr={events:Gr,initialState:!1,timeout:6e4};var ae,Me;class At{constructor(t){k(this,ae,V(!1));k(this,Me,V(Z(Date.now())));const r={...kr,...t},i=r.window??qe,a=r.document??(i==null?void 0:i.document),u=Te(()=>_e(r.timeout)),c=Te(()=>_e(r.events)),v=Te(()=>_e(r.detectVisibilityChanges));C(this,ae).v=Z(r.initialState);const l=Fr(()=>{I(C(this,ae),!0)},()=>T(u));l();const s=()=>{I(C(this,ae),!1),I(C(this,Me),Z(Date.now())),l()};vt(()=>i,T(c),()=>{s()},{passive:!0}),$(()=>{!T(v)||!a||vt(a,["visibilitychange"],()=>{a.hidden||s()})})}get lastActive(){return T(C(this,Me))}get current(){return T(C(this,ae))}}ae=new WeakMap,Me=new WeakMap;function Vr(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}var oe,re,me,ge,Re,Ne,he,We,Ct;class et{constructor(t,r,i={}){k(this,he);k(this,oe,V());k(this,re);k(this,me);k(this,ge);k(this,Re);k(this,Ne,t=>{t.key!==C(this,re)||t.newValue===null||ze(this,he,We).call(this,t.newValue)});const{storage:a="local",serializer:u={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:c=!0,window:v=qe}=i;if(C(this,oe).v=Z(r),ne(this,re,t),ne(this,me,u),v===void 0)return;const l=Vr(a,v);ne(this,ge,l);const s=l.getItem(t);s!==null&&ze(this,he,We).call(this,s),c&&a==="local"&&ne(this,Re,Tt(()=>Ee(v,"storage",C(this,Ne))))}get current(){var t;return(t=C(this,Re))==null||t.call(this),T(C(this,oe))}set current(t){I(C(this,oe),Z(t)),ze(this,he,Ct).call(this,t)}}oe=new WeakMap,re=new WeakMap,me=new WeakMap,ge=new WeakMap,Re=new WeakMap,Ne=new WeakMap,he=new WeakSet,We=function(t){try{I(C(this,oe),Z(C(this,me).deserialize(t)))}catch(r){console.error(`Error when parsing "${t}" from persisted store "${C(this,re)}"`,r)}},Ct=function(t){var r;try{(r=C(this,ge))==null||r.setItem(C(this,re),C(this,me).serialize(t))}catch(i){console.error(`Error when writing value from persisted store "${C(this,re)}" to ${C(this,ge)}`,i)}};var be;class $r{constructor(){k(this,be,V())}get current(){return T(C(this,be))}set current(t){I(C(this,be),Z(t))}}be=new WeakMap;const Pt=new $r;let pt=!1;const Wr={NO_TRACK_PLAYING:204},jr=async e=>{const t="https://api.spotify.com/v1/me/player/currently-playing";try{const r=await fetch(t,{headers:{Authorization:`Bearer ${e.access}`,"Content-Type":"application/json"}});if(r.status===Wr.NO_TRACK_PLAYING){console.log("No track is currently playing.");return}if(!r.ok){console.error(`fetchCurrentlyPlayingTrack: ${r.status} - ${r.statusText}`);return}return r.json()}catch(r){console.error("Error fetching currently playing track:",r)}},je=async e=>{const t=await jr(e);if(Pt.current=t,t===void 0){setTimeout(je,3e3,e);return}const r=t.item.duration_ms-t.progress_ms+1e3;setTimeout(je,r,e)},Dt=()=>{const{token:e,authenticated:t}=Et();return pt||($(()=>{t.current==="logged-in"&&je(e)}),pt=!0),{track:Pt}};/**
 * postprocessing v6.36.6 build Tue Dec 31 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var Ge=1/1e3,Kr=1e3,Xr=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Ge}get fixedDelta(){return this._fixedDelta*Ge}set fixedDelta(e){this._fixedDelta=e*Kr}get elapsed(){return this._elapsed*Ge}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Qr=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),r=new Mr;return r.setAttribute("position",new ct(e,3)),r.setAttribute("uv",new ct(t,2)),r})(),Q=class Ke{static get fullscreenGeometry(){return Qr}constructor(t="Pass",r=new ut,i=new Tr){this.name=t,this.renderer=null,this.scene=r,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const r=this.fullscreenMaterial;r!==null&&(r.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let r=this.screen;r!==null?r.material=t:(r=new _r(Ke.fullscreenGeometry,t),r.frustumCulled=!1,this.scene===null&&(this.scene=new ut),this.scene.add(r),this.screen=r)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,r=He){}render(t,r,i,a,u){throw new Error("Render method not implemented!")}setSize(t,r){}initialize(t,r,i){}dispose(){for(const t of Object.keys(this)){const r=this[t];(r instanceof ie||r instanceof bt||r instanceof Bt||r instanceof Ke)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Yr=class extends Q{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,r,i,a){const u=e.state.buffers.stencil;u.setLocked(!1),u.setTest(!1)}},Zr=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,It="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Nt=class extends de{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new A(null),opacity:new A(1)},blending:ye,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Zr,vertexShader:It})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Jr=class extends Q{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Nt,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new ie(1,1,{minFilter:Ie,magFilter:Ie,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,r,i,a){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,r){r!==void 0&&(this.renderTarget.texture.type=r,r!==fe?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e!==null&&e.outputColorSpace===H&&(this.renderTarget.texture.colorSpace=H))}},mt=new Rr,Ot=class extends Q{constructor(e=!0,t=!0,r=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=r,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,r){this.color=e,this.depth=t,this.stencil=r}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,r,i,a){const u=this.overrideClearColor,c=this.overrideClearAlpha,v=e.getClearAlpha(),l=u!==null,s=c>=0;l?(e.getClearColor(mt),e.setClearColor(u,s?c:v)):s&&e.setClearAlpha(c),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(mt,v):s&&e.setClearAlpha(v)}},qr=class extends Q{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new Ot(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,r,i,a){const u=e.getContext(),c=e.state.buffers,v=this.scene,l=this.camera,s=this.clearPass,h=this.inverted?0:1,n=1-h;c.color.setMask(!1),c.depth.setMask(!1),c.color.setLocked(!0),c.depth.setLocked(!0),c.stencil.setTest(!0),c.stencil.setOp(u.REPLACE,u.REPLACE,u.REPLACE),c.stencil.setFunc(u.ALWAYS,h,4294967295),c.stencil.setClear(n),c.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?s.render(e,null):(s.render(e,t),s.render(e,r))),this.renderToScreen?(e.setRenderTarget(null),e.render(v,l)):(e.setRenderTarget(t),e.render(v,l),e.setRenderTarget(r),e.render(v,l)),c.color.setLocked(!1),c.depth.setLocked(!1),c.stencil.setLocked(!1),c.stencil.setFunc(u.EQUAL,1,4294967295),c.stencil.setOp(u.KEEP,u.KEEP,u.KEEP),c.stencil.setLocked(!0)}},ei=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:a}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,r,a,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Jr,this.depthTexture=null,this.passes=[],this.timer=new Xr,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new F),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===fe&&e.outputColorSpace===H&&(this.inputBuffer.texture.colorSpace=H,this.outputBuffer.texture.colorSpace=H,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const a of this.passes)a.initialize(e,r,i)}}replaceRenderer(e,t=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new gr;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=xr,e.type=Sr):e.type=yr,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i){const a=this.renderer,u=a===null?new F:a.getDrawingBufferSize(new F),c={minFilter:Ie,magFilter:Ie,stencilBuffer:t,depthBuffer:e,type:r},v=new ie(u.width,u.height,c);return i>0&&(v.ignoreDepthForMultisampleCopy=!1,v.samples=i),r===fe&&a!==null&&a.outputColorSpace===H&&(v.texture.colorSpace=H),v.texture.name="EffectComposer.Buffer",v.texture.generateMipmaps=!1,v}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const r=this.passes,i=this.renderer,a=i.getDrawingBufferSize(new F),u=i.getContext().getContextAttributes().alpha,c=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(a.width,a.height),e.initialize(i,u,c),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?r.splice(t,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const v=this.createDepthTexture();for(e of r)e.setDepthTexture(v)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,r=t.indexOf(e);if(r!==-1&&t.splice(r,1).length>0){if(this.depthTexture!==null){const u=(v,l)=>v||l.needsDepthTexture;t.reduce(u,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,r=this.copyPass;let i=this.inputBuffer,a=this.outputBuffer,u=!1,c,v,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const s of this.passes)s.enabled&&(s.render(t,i,a,e,u),s.needsSwap&&(u&&(r.renderToScreen=s.renderToScreen,c=t.getContext(),v=t.state.buffers.stencil,v.setFunc(c.NOTEQUAL,1,4294967295),r.render(t,i,a,e,u),v.setFunc(c.EQUAL,1,4294967295)),l=i,i=a,a=l),s instanceof qr?u=!0:s instanceof Yr&&(u=!1))}setSize(e,t,r){const i=this.renderer,a=i.getSize(new F);(e===void 0||t===void 0)&&(e=a.width,t=a.height),(a.width!==e||a.height!==t)&&i.setSize(e,t,r);const u=i.getDrawingBufferSize(new F);this.inputBuffer.setSize(u.width,u.height),this.outputBuffer.setSize(u.width,u.height);for(const c of this.passes)c.setSize(u.width,u.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Q.fullscreenGeometry.dispose()}},ue={NONE:0,DEPTH:1,CONVOLUTION:2},U={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},ti=class{constructor(){this.shaderParts=new Map([[U.FRAGMENT_HEAD,null],[U.FRAGMENT_MAIN_UV,null],[U.FRAGMENT_MAIN_IMAGE,null],[U.VERTEX_HEAD,null],[U.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ue.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=wt}},ke=!1,gt=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let r;if(t.material.flatShading)switch(t.material.side){case Ce:r=this.materialsFlatShadedDoubleSide;break;case Ae:r=this.materialsFlatShadedBackSide;break;default:r=this.materialsFlatShaded;break}else switch(t.material.side){case Ce:r=this.materialsDoubleSide;break;case Ae:r=this.materialsBackSide;break;default:r=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=r[2]:t.isInstancedMesh?t.material=r[1]:t.material=r[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof de))return e.clone();const t=e.uniforms,r=new Map;for(const a in t){const u=t[a].value;u.isRenderTargetTexture&&(t[a].value=null,r.set(a,u))}const i=e.clone();for(const a of r)t[a[0]].value=a[1],i.uniforms[a[0]].value=a[1];return i}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const r of t)r.uniforms=Object.assign({},e.uniforms),r.side=Er;t[2].skinning=!0,this.materialsBackSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.side=Ae,i}),this.materialsDoubleSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.side=Ce,i}),this.materialsFlatShaded=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=Ae,i}),this.materialsFlatShadedDoubleSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=Ce,i})}}render(e,t,r){const i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,ke){const a=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,r);for(const u of a)u[0].material=u[1];this.meshCount!==a.size&&a.clear()}else{const a=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,r),t.overrideMaterial=a}e.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return ke}static set workaroundEnabled(e){ke=e}},ee=-1,Y=class extends Qe{constructor(e,t=ee,r=ee,i=1){super(),this.resizable=e,this.baseSize=new F(1,1),this.preferredSize=new F(t,r),this.target=this.preferredSize,this.s=i,this.effectiveSize=new F,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,r=this.effectiveSize,i=this.scale;t.width!==ee?r.width=t.width:t.height!==ee?r.width=Math.round(t.height*(e.width/Math.max(e.height,1))):r.width=Math.round(e.width*i),t.height!==ee?r.height=t.height:t.width!==ee?r.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r.height=Math.round(e.height*i)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(ee),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ee}},R={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},ri="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",ii="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",ni="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ai="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",oi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",li="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",ci="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",fi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",hi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",di="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",vi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",pi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",mi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",gi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",xi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",yi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Ti="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",_i="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Ei="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",wi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Mi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Ri="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",bi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Bi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",zi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Ai="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Ci="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Pi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Di=new Map([[R.ADD,ri],[R.ALPHA,ii],[R.AVERAGE,si],[R.COLOR,ni],[R.COLOR_BURN,ai],[R.COLOR_DODGE,oi],[R.DARKEN,li],[R.DIFFERENCE,ui],[R.DIVIDE,ci],[R.DST,null],[R.EXCLUSION,fi],[R.HARD_LIGHT,hi],[R.HARD_MIX,di],[R.HUE,vi],[R.INVERT,pi],[R.INVERT_RGB,mi],[R.LIGHTEN,gi],[R.LINEAR_BURN,xi],[R.LINEAR_DODGE,Si],[R.LINEAR_LIGHT,yi],[R.LUMINOSITY,Ti],[R.MULTIPLY,_i],[R.NEGATION,Ei],[R.NORMAL,wi],[R.OVERLAY,Mi],[R.PIN_LIGHT,Ri],[R.REFLECT,bi],[R.SATURATION,Bi],[R.SCREEN,Ui],[R.SOFT_LIGHT,zi],[R.SRC,Ai],[R.SUBTRACT,Ci],[R.VIVID_LIGHT,Pi]]),Ii=class extends Qe{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new A(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return Di.get(this.blendFunction)}},Le={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Ni=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Oi="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Hi=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Li=class extends de{constructor(e=new ft){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new A(null),texelSize:new A(new ft),scale:new A(1),kernel:new A(0)},blending:ye,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ni,vertexShader:Oi}),this.setTexelSize(e.x,e.y),this.kernelSize=Le.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return Hi[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const r=1/e,i=1/t;this.uniforms.texelSize.value.set(r,i,r*.5,i*.5)}},Fi=class extends Q{constructor({kernelSize:e=Le.MEDIUM,resolutionScale:t=.5,width:r=Y.AUTO_SIZE,height:i=Y.AUTO_SIZE,resolutionX:a=r,resolutionY:u=i}={}){super("KawaseBlurPass"),this.renderTargetA=new ie(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const c=this.resolution=new Y(this,a,u,t);c.addEventListener("change",v=>this.setSize(c.baseWidth,c.baseHeight)),this._blurMaterial=new Li,this._blurMaterial.kernelSize=e,this.copyMaterial=new Nt}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,r,i,a){const u=this.scene,c=this.camera,v=this.renderTargetA,l=this.renderTargetB,s=this.blurMaterial,h=s.kernelSequence;let n=t;this.fullscreenMaterial=s;for(let o=0,p=h.length;o<p;++o){const d=o&1?l:v;s.kernel=h[o],s.inputBuffer=n.texture,e.setRenderTarget(d),e.render(u,c),n=d}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=n.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(u,c)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t);const i=r.width,a=r.height;this.renderTargetA.setSize(i,a),this.renderTargetB.setSize(i,a),this.blurMaterial.setSize(e,t)}initialize(e,t,r){r!==void 0&&(this.renderTargetA.texture.type=r,this.renderTargetB.texture.type=r,r!==fe?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e!==null&&e.outputColorSpace===H&&(this.renderTargetA.texture.colorSpace=H,this.renderTargetB.texture.colorSpace=H))}static get AUTO_SIZE(){return Y.AUTO_SIZE}},Gi=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,ki=class extends de{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Rt.replace(/\D+/g,"")},uniforms:{inputBuffer:new A(null),threshold:new A(0),smoothing:new A(1),range:new A(null)},blending:ye,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Gi,vertexShader:It}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Vi=class extends Q{constructor({renderTarget:e,luminanceRange:t,colorOutput:r,resolutionScale:i=1,width:a=Y.AUTO_SIZE,height:u=Y.AUTO_SIZE,resolutionX:c=a,resolutionY:v=u}={}){super("LuminancePass"),this.fullscreenMaterial=new ki(r,t),this.needsSwap=!1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new ie(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new Y(this,c,v,i);l.addEventListener("change",s=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,r,i,a){const u=this.fullscreenMaterial;u.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height)}initialize(e,t,r){r!==void 0&&r!==fe&&(this.renderTarget.texture.type=r,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},$i=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Wi="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",ji=class extends de{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new A(null),texelSize:new A(new F)},blending:ye,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:$i,vertexShader:Wi})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ki=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Xi="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Qi=class extends de{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new A(null),supportBuffer:new A(null),texelSize:new A(new F),radius:new A(.85)},blending:ye,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ki,vertexShader:Xi})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Yi=class extends Q{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new ie(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new ji,this.upsamplingMaterial=new Qi,this.resolution=new F}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let r=0;r<e;++r){const i=t.clone();i.texture.name="Downsampling.Mipmap"+r,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(let r=1,i=e-1;r<i;++r){const a=t.clone();a.texture.name="Upsampling.Mipmap"+r,this.upsamplingMipmaps.push(a)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,r,i,a){const{scene:u,camera:c}=this,{downsamplingMaterial:v,upsamplingMaterial:l}=this,{downsamplingMipmaps:s,upsamplingMipmaps:h}=this;let n=t;this.fullscreenMaterial=v;for(let o=0,p=s.length;o<p;++o){const d=s[o];v.setSize(n.width,n.height),v.inputBuffer=n.texture,e.setRenderTarget(d),e.render(u,c),n=d}this.fullscreenMaterial=l;for(let o=h.length-1;o>=0;--o){const p=h[o];l.setSize(n.width,n.height),l.inputBuffer=n.texture,l.supportBuffer=s[o].texture,e.setRenderTarget(p),e.render(u,c),n=p}}setSize(e,t){const r=this.resolution;r.set(e,t);let i=r.width,a=r.height;for(let u=0,c=this.downsamplingMipmaps.length;u<c;++u)i=Math.round(i*.5),a=Math.round(a*.5),this.downsamplingMipmaps[u].setSize(i,a),u<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[u].setSize(i,a)}initialize(e,t,r){if(r!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const a of i)a.texture.type=r;if(r!==fe)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(e!==null&&e.outputColorSpace===H)for(const a of i)a.texture.colorSpace=H}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},Zi=class extends Qe{constructor(e,t,{attributes:r=ue.NONE,blendFunction:i=R.NORMAL,defines:a=new Map,uniforms:u=new Map,extensions:c=null,vertexShader:v=null}={}){super(),this.name=e,this.renderer=null,this.attributes=r,this.fragmentShader=t,this.vertexShader=v,this.defines=a,this.uniforms=u,this.extensions=c,this.blendMode=new Ii(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=wt,this._outputColorSpace=Mt}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=He){}update(e,t,r){}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof ie||t instanceof bt||t instanceof Bt||t instanceof Q)&&this[e].dispose()}}},Ji=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,qi=class extends Zi{constructor({blendFunction:e=R.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:r=.025,mipmapBlur:i=!1,intensity:a=1,radius:u=.85,levels:c=8,kernelSize:v=Le.LARGE,resolutionScale:l=.5,width:s=Y.AUTO_SIZE,height:h=Y.AUTO_SIZE,resolutionX:n=s,resolutionY:o=h}={}){super("BloomEffect",Ji,{blendFunction:e,uniforms:new Map([["map",new A(null)],["intensity",new A(a)]])}),this.renderTarget=new ie(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Fi({kernelSize:v}),this.luminancePass=new Vi({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=r,this.mipmapBlurPass=new Yi,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=u,this.mipmapBlurPass.levels=c,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const p=this.resolution=new Y(this,n,o,l);p.addEventListener("change",d=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,r){const i=this.renderTarget,a=this.luminancePass;a.enabled?(a.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,a.renderTarget):this.blurPass.render(e,a.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,i)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height),this.blurPass.resolution.copy(r),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,r){this.blurPass.initialize(e,t,r),this.luminancePass.initialize(e,t,r),this.mipmapBlurPass.initialize(e,t,r),r!==void 0&&(this.renderTarget.texture.type=r,e!==null&&e.outputColorSpace===H&&(this.renderTarget.texture.colorSpace=H))}},es=class extends Q{constructor(e,t,r=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new Ot,this.overrideMaterialManager=r===null?null:new gt(r),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new gt(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,r,i,a){const u=this.scene,c=this.camera,v=this.selection,l=c.layers.mask,s=u.background,h=e.shadowMap.autoUpdate,n=this.renderToScreen?null:t;v!==null&&c.layers.set(v.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(u.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(n),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,u,c):e.render(u,c),c.layers.mask=l,u.background=s,e.shadowMap.autoUpdate=h}},ts=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,rs="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",is=class extends de{constructor(e,t,r,i,a=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Rt.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new A(null),depthBuffer:new A(null),resolution:new A(new F),texelSize:new A(new F),cameraNear:new A(.3),cameraFar:new A(1e3),aspect:new A(1),time:new A(0)},blending:ye,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:a}),e&&this.setShaderParts(e),t&&this.setDefines(t),r&&this.setUniforms(r),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=He){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=ts.replace(U.FRAGMENT_HEAD,e.get(U.FRAGMENT_HEAD)||"").replace(U.FRAGMENT_MAIN_UV,e.get(U.FRAGMENT_MAIN_UV)||"").replace(U.FRAGMENT_MAIN_IMAGE,e.get(U.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=rs.replace(U.VERTEX_HEAD,e.get(U.VERTEX_HEAD)||"").replace(U.VERTEX_MAIN_SUPPORT,e.get(U.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof wr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const r=this.uniforms;r.resolution.value.set(e,t),r.texelSize.value.set(1/e,1/t),r.aspect.value=e/t}static get Section(){return U}};function xt(e,t,r){for(const i of t){const a="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),u=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const c of r.entries())c[1]!==null&&r.set(c[0],c[1].replace(u,a))}}function ss(e,t,r){let i=t.getFragmentShader(),a=t.getVertexShader();const u=i!==void 0&&/mainImage/.test(i),c=i!==void 0&&/mainUv/.test(i);if(r.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(c&&r.attributes&ue.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!u&&!c)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const v=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=r.shaderParts;let s=l.get(U.FRAGMENT_HEAD)||"",h=l.get(U.FRAGMENT_MAIN_UV)||"",n=l.get(U.FRAGMENT_MAIN_IMAGE)||"",o=l.get(U.VERTEX_HEAD)||"",p=l.get(U.VERTEX_MAIN_SUPPORT)||"";const d=new Set,f=new Set;if(c&&(h+=`	${e}MainUv(UV);
`,r.uvTransformation=!0),a!==null&&/mainSupport/.test(a)){const g=/mainSupport *\([\w\s]*?uv\s*?\)/.test(a);p+=`	${e}MainSupport(`,p+=g?`vUv);
`:`);
`;for(const S of a.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const m of S[1].split(/\s*,\s*/))r.varyings.add(m),d.add(m),f.add(m);for(const S of a.matchAll(v))f.add(S[1])}for(const g of i.matchAll(v))f.add(g[1]);for(const g of t.defines.keys())f.add(g.replace(/\([\w\s,]*\)/g,""));for(const g of t.uniforms.keys())f.add(g);f.delete("while"),f.delete("for"),f.delete("if"),t.uniforms.forEach((g,S)=>r.uniforms.set(e+S.charAt(0).toUpperCase()+S.slice(1),g)),t.defines.forEach((g,S)=>r.defines.set(e+S.charAt(0).toUpperCase()+S.slice(1),g));const y=new Map([["fragment",i],["vertex",a]]);xt(e,f,r.defines),xt(e,f,y),i=y.get("fragment"),a=y.get("vertex");const M=t.blendMode;if(r.blendModes.set(M.blendFunction,M),u){t.inputColorSpace!==null&&t.inputColorSpace!==r.colorSpace&&(n+=t.inputColorSpace===H?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==Mt?r.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(r.colorSpace=t.inputColorSpace);const g=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;n+=`${e}MainImage(color0, UV, `,r.attributes&ue.DEPTH&&g.test(i)&&(n+="depth, ",r.readDepth=!0),n+=`color1);
	`;const S=e+"BlendOpacity";r.uniforms.set(S,M.opacity),n+=`color0 = blend${M.blendFunction}(color0, color1, ${S});

	`,s+=`uniform float ${S};

`}if(s+=i+`
`,a!==null&&(o+=a+`
`),l.set(U.FRAGMENT_HEAD,s),l.set(U.FRAGMENT_MAIN_UV,h),l.set(U.FRAGMENT_MAIN_IMAGE,n),l.set(U.VERTEX_HEAD,o),l.set(U.VERTEX_MAIN_SUPPORT,p),t.extensions!==null)for(const g of t.extensions)r.extensions.add(g)}}var ns=class extends Q{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new is(null,null,null,e),this.listener=r=>this.handleEvent(r),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,r)=>r.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new ti;let t=0;for(const c of this.effects)if(c.blendMode.blendFunction===R.DST)e.attributes|=c.getAttributes()&ue.DEPTH;else{if(e.attributes&c.getAttributes()&ue.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${c.name})`);ss("e"+t++,c,e)}let r=e.shaderParts.get(U.FRAGMENT_HEAD),i=e.shaderParts.get(U.FRAGMENT_MAIN_IMAGE),a=e.shaderParts.get(U.FRAGMENT_MAIN_UV);const u=/\bblend\b/g;for(const c of e.blendModes.values())r+=c.getShaderCode().replace(u,`blend${c.blendFunction}`)+`
`;e.attributes&ue.DEPTH?(e.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===H&&(i+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(a=`vec2 transformedUv = vUv;
`+a,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(U.FRAGMENT_HEAD,r),e.shaderParts.set(U.FRAGMENT_MAIN_IMAGE,i),e.shaderParts.set(U.FRAGMENT_MAIN_UV,a);for(const[c,v]of e.shaderParts)v!==null&&e.shaderParts.set(c,v.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=He){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const r of this.effects)r.setDepthTexture(e,t)}render(e,t,r,i,a){for(const u of this.effects)u.update(e,t,i);if(!this.skipRendering||this.renderToScreen){const u=this.fullscreenMaterial;u.inputBuffer=t.texture,u.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const r of this.effects)r.setSize(e,t)}initialize(e,t,r){this.renderer=e;for(const i of this.effects)i.initialize(e,t,r);this.updateMaterial(),r!==void 0&&r!==fe&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}};function as(e,t){W(t,!0);const r=rr(),i=()=>ot(v,"$camera",r),a=()=>ot(l,"$size",r),{scene:u,renderer:c,camera:v,size:l,autoRender:s,renderStage:h}=hr(),n=new ei(c);$(()=>{n.removeAllPasses(),n.addPass(new es(u,i())),n.addPass(new ns(i(),new qi({intensity:.8,luminanceThreshold:.1,height:1024,width:1024,luminanceSmoothing:.5,mipmapBlur:!0,kernelSize:Le.MEDIUM})))}),$(()=>{const o=a().width*window.devicePixelRatio,p=a().height*window.devicePixelRatio;n.setSize(o,p)}),$(()=>{const o=s.current;return s.set(!1),()=>s.set(o)}),dr(o=>{n.render(o)},{stage:h,autoInvalidate:!1}),j()}var os=O("<!> <!>",1);function ls(e,t){W(t,!0);var r=os(),i=L(r);as(i,{});var a=N(i,2);Oe(a,()=>t.children),z(e,r),j()}function us(e,t){W(t,!1),_t(r=>{if(document.startViewTransition)return new Promise(i=>{document.startViewTransition(async()=>{i(),await r.complete})})}),xe(Se.PreviousPage,()=>De(-1)),xe(Se.NextPage,()=>De(1)),Ye(),j()}const cs=e=>e;function tt(e,{delay:t=0,duration:r=400,easing:i=cs}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:r,easing:i,css:u=>`opacity: ${u*a}`}}const St=(e,t=te,r=te)=>{var i=fs();i.__click=function(...u){var c;(c=r())==null||c.apply(this,u)};var a=N(D(i));P(i),le(()=>ce(a,` ${t()??""}`)),z(e,i)};var fs=O('<button class="variant-filled-surface btn btn-md flex gap-1 bg-zinc-900 text-xs text-slate-100"><svg id="icon-spotify" viewBox="0 0 24 28" class="h-4 fill-slate-100"><path d="M17.609 18.906c0-0.438-0.172-0.609-0.469-0.797-2.016-1.203-4.359-1.797-6.984-1.797-1.531 0-3 0.203-4.484 0.531-0.359 0.078-0.656 0.313-0.656 0.812 0 0.391 0.297 0.766 0.766 0.766 0.141 0 0.391-0.078 0.578-0.125 1.219-0.25 2.5-0.422 3.797-0.422 2.297 0 4.469 0.562 6.203 1.609 0.187 0.109 0.313 0.172 0.516 0.172 0.391 0 0.734-0.313 0.734-0.75zM19.109 15.547c0-0.422-0.156-0.719-0.547-0.953-2.391-1.422-5.422-2.203-8.563-2.203-2.016 0-3.391 0.281-4.734 0.656-0.5 0.141-0.75 0.484-0.75 1s0.422 0.938 0.938 0.938c0.219 0 0.344-0.063 0.578-0.125 1.094-0.297 2.406-0.516 3.922-0.516 2.969 0 5.672 0.781 7.625 1.937 0.172 0.094 0.344 0.203 0.594 0.203 0.531 0 0.938-0.422 0.938-0.938zM20.797 11.672c0-0.578-0.25-0.875-0.625-1.094-2.703-1.578-6.406-2.312-9.938-2.312-2.078 0-3.984 0.234-5.688 0.734-0.438 0.125-0.844 0.5-0.844 1.156 0 0.641 0.484 1.141 1.125 1.141 0.234 0 0.453-0.078 0.625-0.125 1.516-0.422 3.156-0.578 4.797-0.578 3.25 0 6.625 0.719 8.797 2.016 0.219 0.125 0.375 0.187 0.625 0.187 0.594 0 1.125-0.469 1.125-1.125zM24 14c0 6.625-5.375 12-12 12s-12-5.375-12-12 5.375-12 12-12 12 5.375 12 12z"></path></svg> </button>'),hs=O("<div><!></div>");function ds(e,t){W(t,!1);const{authenticated:r,login:i,logout:a}=Et();Ye();var u=hs(),c=D(u);{var v=s=>{var h=Ft("...");z(s,h)},l=s=>{var h=X(),n=L(h);{var o=d=>{var f=at(()=>()=>a());St(d,()=>"Logout Spotify",()=>T(f))},p=d=>{var f=X(),y=L(f);{var M=g=>{var S=at(()=>()=>i());St(g,()=>"Connect Spotify",()=>T(S))};G(y,g=>{r.current==="logged-out"&&g(M)},!0)}z(d,f)};G(n,d=>{r.current==="logged-in"?d(o):d(p,!1)},!0)}z(s,h)};G(c,s=>{r.current==="pending"?s(v):s(l,!1)})}P(u),z(e,u),j()}Xe(["click"]);var vs=(e,t)=>I(t,!T(t)),ps=O('<button class="absolute right-2 top-2 z-10 h-6 w-6 p-1" aria-label="Open settings"><svg class="h-full fill-white" viewBox="0 0 32 32"><path d="M13,16c0,1.65,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S13,14.34,13,16z"></path><path d="M13,26c0,1.65,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S13,24.34,13,26z"></path><path d="M13,6c0,1.654,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S13,4.34,13,6z"></path></svg></button>'),ms=(e,t)=>{e.target===e.currentTarget&&I(t,!1)},gs=O('<div class="flex w-full items-center gap-2"><kbd class="kbd"> </kbd> <div> </div></div>'),xs=O('<button aria-label="Exit settings" class="absolute left-0 top-0 z-20 grid h-screen w-screen cursor-default bg-black opacity-80"></button> <div class="pointer-events-none absolute left-0 top-0 z-20 grid h-screen w-screen place-content-center"><div class="card pointer-events-auto w-80 rounded-sm bg-white p-4 shadow-xl"><div class="-mt-12 mb-4 flex w-full justify-center"><img alt="" width="200" src="/zestyplus2.png"></div> <div class="flex flex-col items-center justify-center gap-4"><div class="flex gap-2"><small>Not sure what to play?</small> <a class="variant-filled-surface btn btn-sm text-xs" href="https://open.spotify.com/playlist/3TfXpq49b3Q93pCz4SfB7K?si=bf8730839a6844af&amp;nd=1&amp;dlsi=234712d881d24f8f" target="_blank">2024 Playlist</a></div> <hr> <div class="flex flex-col justify-between gap-1.5 text-xs"><h4 class="text-sm"><strong>Keybindings</strong></h4> <!></div> <hr class="border"> <!></div></div></div>',1),Ss=O("<!> <!>",1);function ys(e,t){W(t,!0);let r=V(!1);const i=new At({timeout:3e3});xe(Se.Settings,()=>I(r,!T(r)));var a=Ss(),u=L(a);{var c=s=>{var h=ps();h.__click=[vs,r],Je(3,h,()=>tt),z(s,h)};G(u,s=>{i.current||s(c)})}var v=N(u,2);{var l=s=>{var h=xs(),n=L(h);n.__click=[ms,r];var o=N(n,2),p=D(o),d=N(D(p),2),f=N(D(d),4),y=N(D(f),2);Ze(y,16,()=>[["←","Previous page"],["→","Next page"],["F","Fullscreen"],["C","Costco mode"]],Ut,(g,S)=>{let m=()=>S[0],x=()=>S[1];var _=gs(),b=D(_),B=D(b,!0);P(b);var w=N(b,2),E=D(w,!0);P(w),P(_),le(()=>{ce(B,m()),ce(E,x())}),z(g,_)}),P(f);var M=N(f,4);ds(M,{}),P(d),P(p),P(o),z(s,h)};G(v,s=>{T(r)&&s(l)})}z(e,a),j()}Xe(["click"]);var Ts=O('<a target="_blank"> </a>'),_s=O('<div class="absolute bottom-0 left-0 flex items-end gap-1.5 p-4 text-white"><div class="h-[120px] w-[120px] overflow-hidden rounded shadow-2xl"><a href="https://spotify.com" target="_blank" class="absolute -mt-8"><img alt="Spotify logo" src="/spotify-logo.svg" width="22"></a> <a target="_blank"><img class="select-none" width="120" height="120"></a></div> <div class="flex flex-col gap-1 px-2 py-2"><a target="_blank"><p class="text-lg font-bold leading-none"> </p></a> <p class="text-xs leading-none opacity-75"></p></div></div>');function Es(e,t){W(t,!0);const{track:r}=Dt(),i=new et("trackinfo-visible",!0);xe(Se.TrackInfo,()=>i.current=!i.current);var a=X(),u=L(a);{var c=v=>{var l=_s();const s=Te(()=>{const{item:g}=r.current;return{item:g}});var h=D(l),n=N(D(h),2),o=D(n);P(n),P(h);var p=N(h,2),d=D(p),f=D(d),y=D(f,!0);P(f),P(d);var M=N(d,2);Ze(M,21,()=>T(s).item.artists,g=>g.name,(g,S)=>{var m=Ts(),x=D(m,!0);P(m),le(()=>{ve(m,"href",T(S).external_urls.spotify),ce(x,T(S).name)}),z(g,m)}),P(M),P(p),P(l),le(()=>{ve(n,"href",T(s).item.album.external_urls.spotify),ve(o,"alt",T(s).item.album.name),ve(o,"src",T(s).item.album.images[0].url),ve(d,"href",T(s).item.external_urls.spotify),ce(y,T(s).item.name)}),Je(3,l,()=>tt,()=>({duration:200})),z(v,l)};G(u,v=>{i.current&&r.current&&v(c)})}z(e,a),j()}const ws=(e,t)=>{const r=e.getTime()-Date.now();if(r>0){const i=setTimeout(t,r);return()=>clearTimeout(i)}else return console.error("Target time is in the past. Check system clock."),()=>{}},Ms=(e=1)=>{const t=new Date().getFullYear()+1,r=new Date(t,0,1,0,0,0);return new Date(r.getTime()-6e4*e)},Rs=e=>{const t=Math.floor(e/1e3),r=Math.floor(t/60).toString(),i=(t%60).toString().padStart(2,"0");return`${r}:${i}`};var bs=O('<div class="z-1 pointer-events-none absolute grid h-full w-full place-content-center text-8xl text-white svelte-xkzlrh"><div class="flex gap-2 svelte-xkzlrh">🫲 <div class="w-48 svelte-xkzlrh"> </div> 🫱</div></div>'),Bs=O('<div class="emoji absolute svelte-xkzlrh"> </div>'),Us=O('<div class="z-1 pointer-events-none absolute h-full w-full place-content-center text-8xl text-white svelte-xkzlrh"></div>');function zs(e,t){W(t,!0);const r=["👺","😱","🤩","🥳","😘","🤌","👏","🫶","💥","🍾","🎺","🎻","🎉","🎊","🪩","🙂‍↕️","🤝","🤙","🫂","🤸","💸","📈","🎈","🧘‍♀️","🏄‍♂️","🫵"];let i=Z([]),a=-1,u=V("idle"),c=V(""),v=V(!1);const l=()=>{const y=new Date().getTime(),M=a-y;I(c,Z(Rs(M))),y<=a?requestAnimationFrame(l):I(u,"celebrating")},s=()=>{I(u,"counting"),requestAnimationFrame(l)},h=()=>{const f={emoji:r.at((Math.random()*r.length|0)-1)??"",x:Math.random()*100,y:Math.random()*100};i.push(f),i.length>50&&i.shift()};$(()=>{const f=Ms(10);return a=f.getTime(),ws(f,s)}),$(()=>{if(T(u)==="celebrating"){setInterval(h,500);const f=1e3*60*3;setTimeout(()=>{I(v,!0),setTimeout(()=>{I(u,"idle")},f)},f)}});var n=X(),o=L(n);{var p=f=>{var y=bs(),M=D(y),g=N(D(M)),S=D(g,!0);P(g),er(),P(M),P(y),le(()=>ce(S,T(c))),z(f,y)},d=f=>{var y=X(),M=L(y);{var g=S=>{var m=Us();Ze(m,21,()=>i,Ut,(x,_)=>{let b=()=>T(_).emoji,B=()=>T(_).x,w=()=>T(_).y;var E=Bs(),K=D(E,!0);P(E),le(()=>{ve(E,"style",`left: ${B()??""}%; top: ${w()??""}%`),ce(K,b())}),z(x,E)}),P(m),le(()=>Br(m,"fading",T(v))),z(S,m)};G(M,S=>{T(u)==="celebrating"&&S(g)},!0)}z(f,y)};G(o,f=>{T(u)==="counting"?f(p):f(d,!1)})}z(e,n),j()}let Ht=null;class Lt{}Lt.render=function(e,t){Ht(e,t)};self.QrCreator=Lt;(function(e){function t(v,l,s,h){var n={},o=e(s,l);o.u(v),o.J(),h=h||0;var p=o.h(),d=o.h()+2*h;return n.text=v,n.level=l,n.version=s,n.O=d,n.a=function(f,y){return f-=h,y-=h,0>f||f>=p||0>y||y>=p?!1:o.a(f,y)},n}function r(v,l,s,h,n,o,p,d,f,y){function M(g,S,m,x,_,b,B){g?(v.lineTo(S+b,m+B),v.arcTo(S,m,x,_,o)):v.lineTo(S,m)}p?v.moveTo(l+o,s):v.moveTo(l,s),M(d,h,s,h,n,-o,0),M(f,h,n,l,n,0,-o),M(y,l,n,l,s,o,0),M(p,l,s,h,s,0,o)}function i(v,l,s,h,n,o,p,d,f,y){function M(g,S,m,x){v.moveTo(g+m,S),v.lineTo(g,S),v.lineTo(g,S+x),v.arcTo(g,S,g+m,S,o)}p&&M(l,s,o,o),d&&M(h,s,-o,o),f&&M(h,n,-o,-o),y&&M(l,n,o,-o)}function a(v,l){var s=l.fill;if(typeof s=="string")v.fillStyle=s;else{var h=s.type,n=s.colorStops;if(s=s.position.map(p=>Math.round(p*l.size)),h==="linear-gradient")var o=v.createLinearGradient.apply(v,s);else if(h==="radial-gradient")o=v.createRadialGradient.apply(v,s);else throw Error("Unsupported fill");n.forEach(([p,d])=>{o.addColorStop(p,d)}),v.fillStyle=o}}function u(v,l){e:{var s=l.text,h=l.v,n=l.N,o=l.K,p=l.P;for(n=Math.max(1,n||1),o=Math.min(40,o||40);n<=o;n+=1)try{var d=t(s,h,n,p);break e}catch{}d=void 0}if(!d)return null;for(s=v.getContext("2d"),l.background&&(s.fillStyle=l.background,s.fillRect(l.left,l.top,l.size,l.size)),h=d.O,o=l.size/h,s.beginPath(),p=0;p<h;p+=1)for(n=0;n<h;n+=1){var f=s,y=l.left+n*o,M=l.top+p*o,g=p,S=n,m=d.a,x=y+o,_=M+o,b=g-1,B=g+1,w=S-1,E=S+1,K=Math.floor(Math.min(.5,Math.max(0,l.R))*o),J=m(g,S),se=m(b,w),Be=m(b,S);b=m(b,E);var Ue=m(g,E);E=m(B,E),S=m(B,S),B=m(B,w),g=m(g,w),y=Math.round(y),M=Math.round(M),x=Math.round(x),_=Math.round(_),J?r(f,y,M,x,_,K,!Be&&!g,!Be&&!Ue,!S&&!Ue,!S&&!g):i(f,y,M,x,_,K,Be&&g&&se,Be&&Ue&&b,S&&Ue&&E,S&&g&&B)}return a(s,l),s.fill(),v}var c={minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:200,fill:"#000",background:null,text:"no text",radius:.5,quiet:0};Ht=function(v,l){var s={};Object.assign(s,c,v),s.N=s.minVersion,s.K=s.maxVersion,s.v=s.ecLevel,s.left=s.left,s.top=s.top,s.size=s.size,s.fill=s.fill,s.background=s.background,s.text=s.text,s.R=s.radius,s.P=s.quiet,l instanceof HTMLCanvasElement?((l.width!==s.size||l.height!==s.size)&&(l.width=s.size,l.height=s.size),l.getContext("2d").clearRect(0,0,l.width,l.height),u(l,s)):(v=document.createElement("canvas"),v.width=s.size,v.height=s.size,s=u(v,s),l.appendChild(s))}})(function(){function e(l){var s=r.s(l);return{S:function(){return 4},b:function(){return s.length},write:function(h){for(var n=0;n<s.length;n+=1)h.put(s[n],8)}}}function t(){var l=[],s=0,h={B:function(){return l},c:function(n){return(l[Math.floor(n/8)]>>>7-n%8&1)==1},put:function(n,o){for(var p=0;p<o;p+=1)h.m((n>>>o-p-1&1)==1)},f:function(){return s},m:function(n){var o=Math.floor(s/8);l.length<=o&&l.push(0),n&&(l[o]|=128>>>s%8),s+=1}};return h}function r(l,s){function h(g,S){for(var m=-1;7>=m;m+=1)if(!(-1>=g+m||d<=g+m))for(var x=-1;7>=x;x+=1)-1>=S+x||d<=S+x||(p[g+m][S+x]=0<=m&&6>=m&&(x==0||x==6)||0<=x&&6>=x&&(m==0||m==6)||2<=m&&4>=m&&2<=x&&4>=x)}function n(g,S){for(var m=d=4*l+17,x=Array(m),_=0;_<m;_+=1){x[_]=Array(m);for(var b=0;b<m;b+=1)x[_][b]=null}for(p=x,h(0,0),h(d-7,0),h(0,d-7),m=u.G(l),x=0;x<m.length;x+=1)for(_=0;_<m.length;_+=1){b=m[x];var B=m[_];if(p[b][B]==null)for(var w=-2;2>=w;w+=1)for(var E=-2;2>=E;E+=1)p[b+w][B+E]=w==-2||w==2||E==-2||E==2||w==0&&E==0}for(m=8;m<d-8;m+=1)p[m][6]==null&&(p[m][6]=m%2==0);for(m=8;m<d-8;m+=1)p[6][m]==null&&(p[6][m]=m%2==0);for(m=u.w(o<<3|S),x=0;15>x;x+=1)_=!g&&(m>>x&1)==1,p[6>x?x:8>x?x+1:d-15+x][8]=_,p[8][8>x?d-x-1:9>x?15-x:14-x]=_;if(p[d-8][8]=!g,7<=l){for(m=u.A(l),x=0;18>x;x+=1)_=!g&&(m>>x&1)==1,p[Math.floor(x/3)][x%3+d-8-3]=_;for(x=0;18>x;x+=1)_=!g&&(m>>x&1)==1,p[x%3+d-8-3][Math.floor(x/3)]=_}if(f==null){for(g=v.I(l,o),m=t(),x=0;x<y.length;x+=1)_=y[x],m.put(4,4),m.put(_.b(),u.f(4,l)),_.write(m);for(x=_=0;x<g.length;x+=1)_+=g[x].j;if(m.f()>8*_)throw Error("code length overflow. ("+m.f()+">"+8*_+")");for(m.f()+4<=8*_&&m.put(0,4);m.f()%8!=0;)m.m(!1);for(;!(m.f()>=8*_)&&(m.put(236,8),!(m.f()>=8*_));)m.put(17,8);var K=0;for(_=x=0,b=Array(g.length),B=Array(g.length),w=0;w<g.length;w+=1){var J=g[w].j,se=g[w].o-J;for(x=Math.max(x,J),_=Math.max(_,se),b[w]=Array(J),E=0;E<b[w].length;E+=1)b[w][E]=255&m.B()[E+K];for(K+=J,E=u.C(se),J=i(b[w],E.b()-1).l(E),B[w]=Array(E.b()-1),E=0;E<B[w].length;E+=1)se=E+J.b()-B[w].length,B[w][E]=0<=se?J.c(se):0}for(E=m=0;E<g.length;E+=1)m+=g[E].o;for(m=Array(m),E=K=0;E<x;E+=1)for(w=0;w<g.length;w+=1)E<b[w].length&&(m[K]=b[w][E],K+=1);for(E=0;E<_;E+=1)for(w=0;w<g.length;w+=1)E<B[w].length&&(m[K]=B[w][E],K+=1);f=m}for(g=f,m=-1,x=d-1,_=7,b=0,S=u.F(S),B=d-1;0<B;B-=2)for(B==6&&--B;;){for(w=0;2>w;w+=1)p[x][B-w]==null&&(E=!1,b<g.length&&(E=(g[b]>>>_&1)==1),S(x,B-w)&&(E=!E),p[x][B-w]=E,--_,_==-1&&(b+=1,_=7));if(x+=m,0>x||d<=x){x-=m,m=-m;break}}}var o=a[s],p=null,d=0,f=null,y=[],M={u:function(g){g=e(g),y.push(g),f=null},a:function(g,S){if(0>g||d<=g||0>S||d<=S)throw Error(g+","+S);return p[g][S]},h:function(){return d},J:function(){for(var g=0,S=0,m=0;8>m;m+=1){n(!0,m);var x=u.D(M);(m==0||g>x)&&(g=x,S=m)}n(!1,S)}};return M}function i(l,s){if(typeof l.length>"u")throw Error(l.length+"/"+s);var h=function(){for(var o=0;o<l.length&&l[o]==0;)o+=1;for(var p=Array(l.length-o+s),d=0;d<l.length-o;d+=1)p[d]=l[d+o];return p}(),n={c:function(o){return h[o]},b:function(){return h.length},multiply:function(o){for(var p=Array(n.b()+o.b()-1),d=0;d<n.b();d+=1)for(var f=0;f<o.b();f+=1)p[d+f]^=c.i(c.g(n.c(d))+c.g(o.c(f)));return i(p,0)},l:function(o){if(0>n.b()-o.b())return n;for(var p=c.g(n.c(0))-c.g(o.c(0)),d=Array(n.b()),f=0;f<n.b();f+=1)d[f]=n.c(f);for(f=0;f<o.b();f+=1)d[f]^=c.i(c.g(o.c(f))+p);return i(d,0).l(o)}};return n}r.s=function(l){for(var s=[],h=0;h<l.length;h++){var n=l.charCodeAt(h);128>n?s.push(n):2048>n?s.push(192|n>>6,128|n&63):55296>n||57344<=n?s.push(224|n>>12,128|n>>6&63,128|n&63):(h++,n=65536+((n&1023)<<10|l.charCodeAt(h)&1023),s.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63))}return s};var a={L:1,M:0,Q:3,H:2},u=function(){function l(n){for(var o=0;n!=0;)o+=1,n>>>=1;return o}var s=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],h={w:function(n){for(var o=n<<10;0<=l(o)-l(1335);)o^=1335<<l(o)-l(1335);return(n<<10|o)^21522},A:function(n){for(var o=n<<12;0<=l(o)-l(7973);)o^=7973<<l(o)-l(7973);return n<<12|o},G:function(n){return s[n-1]},F:function(n){switch(n){case 0:return function(o,p){return(o+p)%2==0};case 1:return function(o){return o%2==0};case 2:return function(o,p){return p%3==0};case 3:return function(o,p){return(o+p)%3==0};case 4:return function(o,p){return(Math.floor(o/2)+Math.floor(p/3))%2==0};case 5:return function(o,p){return o*p%2+o*p%3==0};case 6:return function(o,p){return(o*p%2+o*p%3)%2==0};case 7:return function(o,p){return(o*p%3+(o+p)%2)%2==0};default:throw Error("bad maskPattern:"+n)}},C:function(n){for(var o=i([1],0),p=0;p<n;p+=1)o=o.multiply(i([1,c.i(p)],0));return o},f:function(n,o){if(n!=4||1>o||40<o)throw Error("mode: "+n+"; type: "+o);return 10>o?8:16},D:function(n){for(var o=n.h(),p=0,d=0;d<o;d+=1)for(var f=0;f<o;f+=1){for(var y=0,M=n.a(d,f),g=-1;1>=g;g+=1)if(!(0>d+g||o<=d+g))for(var S=-1;1>=S;S+=1)0>f+S||o<=f+S||(g!=0||S!=0)&&M==n.a(d+g,f+S)&&(y+=1);5<y&&(p+=3+y-5)}for(d=0;d<o-1;d+=1)for(f=0;f<o-1;f+=1)y=0,n.a(d,f)&&(y+=1),n.a(d+1,f)&&(y+=1),n.a(d,f+1)&&(y+=1),n.a(d+1,f+1)&&(y+=1),(y==0||y==4)&&(p+=3);for(d=0;d<o;d+=1)for(f=0;f<o-6;f+=1)n.a(d,f)&&!n.a(d,f+1)&&n.a(d,f+2)&&n.a(d,f+3)&&n.a(d,f+4)&&!n.a(d,f+5)&&n.a(d,f+6)&&(p+=40);for(f=0;f<o;f+=1)for(d=0;d<o-6;d+=1)n.a(d,f)&&!n.a(d+1,f)&&n.a(d+2,f)&&n.a(d+3,f)&&n.a(d+4,f)&&!n.a(d+5,f)&&n.a(d+6,f)&&(p+=40);for(f=y=0;f<o;f+=1)for(d=0;d<o;d+=1)n.a(d,f)&&(y+=1);return p+=Math.abs(100*y/o/o-50)/5*10}};return h}(),c=function(){for(var l=Array(256),s=Array(256),h=0;8>h;h+=1)l[h]=1<<h;for(h=8;256>h;h+=1)l[h]=l[h-4]^l[h-5]^l[h-6]^l[h-8];for(h=0;255>h;h+=1)s[l[h]]=h;return{g:function(n){if(1>n)throw Error("glog("+n+")");return s[n]},i:function(n){for(;0>n;)n+=255;for(;256<=n;)n-=255;return l[n]}}}(),v=function(){function l(n,o){switch(o){case a.L:return s[4*(n-1)];case a.M:return s[4*(n-1)+1];case a.Q:return s[4*(n-1)+2];case a.H:return s[4*(n-1)+3]}}var s=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],h={I:function(n,o){var p=l(n,o);if(typeof p>"u")throw Error("bad rs block @ typeNumber:"+n+"/errorCorrectLevel:"+o);n=p.length/3,o=[];for(var d=0;d<n;d+=1)for(var f=p[3*d],y=p[3*d+1],M=p[3*d+2],g=0;g<f;g+=1){var S=M,m={};m.o=y,m.j=S,o.push(m)}return o}};return h}();return r}());const As=QrCreator;var Cs=O('<div class="z-1 inline-flex w-24 p-4 svelte-x226nl"></div>');function Ps(e,t){W(t,!0);const r=new et("show-playlist-qr-code",!1),{track:i}=Dt();let a=V(void 0),u=Te(()=>{var s,h,n;return(n=(h=(s=i.current)==null?void 0:s.context)==null?void 0:h.external_urls)==null?void 0:n.spotify});$(()=>{T(a)!==void 0&&T(u)!==void 0&&As.render({text:T(u),radius:0,ecLevel:"H",fill:"#fff",background:null,size:128},T(a))}),xe(Se.QRCode,()=>r.current=!r.current);var c=X(),v=L(c);{var l=s=>{var h=Cs();Ve(h,n=>I(a,n),()=>T(a)),z(s,h)};G(v,s=>{r.current&&T(u)&&s(l)})}z(e,c),j()}var Ds=O('<div class="costco z-10 h-screen svelte-1qo5hw6"><img class="costco pointer-events-none absolute left-0 top-0 scale-[2.5] opacity-20 svelte-1qo5hw6" src="/costco.png" alt="Costco"></div>');function Is(e,t){W(t,!0);let r=V(!0),i=1e3*20;$(()=>{function v(){Math.random()>0?(I(r,!0),setTimeout(()=>{I(r,!1),setTimeout(v,i)},20*1e3)):setTimeout(v,i)}v()});var a=X(),u=L(a);{var c=v=>{var l=Ds();z(v,l)};G(u,v=>{T(r)&&v(c)})}z(e,a),j()}var Ns=()=>De(-1),Os=()=>De(1),Hs=O('<div class="absolute bottom-2 right-2"><button type="button" class="variant-filled btn-icon btn-icon-sm">←</button> <button type="button" class="variant-filled btn-icon btn-icon-sm">→</button></div>');function Ls(e,t){W(t,!1);const r=new At({timeout:3e3});Ye();var i=X(),a=L(i);{var u=c=>{var v=Hs(),l=D(v);l.__click=[Ns];var s=N(l,2);s.__click=[Os],P(v),Je(3,v,()=>tt),z(c,v)};G(a,c=>{r.current||c(u)})}z(e,i),j()}Xe(["click"]);var Fs=O('<div class="absolute left-0 top-0 h-screen w-screen"><!></div> <!> <!> <!> <!> <!> <!> <!>',1);function Gs(e,t){W(t,!0);const{startAnalyser:r}=mr();$(()=>void r());let i=-1;$(()=>{clearTimeout(i),i=lt()}),_t(()=>{clearTimeout(i),i=lt()});let a=new et("costco-mode",!1);xe(Se.CostcoMode,()=>a.current=!a.current);var u=Fs(),c=L(u),v=D(c);Nr(v,{children:(y,M)=>{var g=X(),S=L(g);{var m=x=>{ls(x,{children:(_,b)=>{var B=X(),w=L(B);Oe(w,()=>t.children),z(_,B)},$$slots:{default:!0}})};G(S,x=>{x(m,!1)})}z(y,g)},$$slots:{default:!0}}),P(c);var l=N(c,2);us(l,{});var s=N(l,2);Ls(s,{});var h=N(s,2);ys(h,{});var n=N(h,2);Es(n,{});var o=N(n,2);zs(o,{});var p=N(o,2);Ps(p,{});var d=N(p,2);{var f=y=>{Is(y,{})};G(d,y=>{a.current&&y(f)})}z(e,u),j()}const un=Object.freeze(Object.defineProperty({__proto__:null,default:Gs},Symbol.toStringTag,{value:"Module"}));export{Gs as _,un as a};
