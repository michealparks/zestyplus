import"./DsnmJJEf.js";import{o as F,a as j}from"./DLMcqm7y.js";import{a3 as M,u as o,as as Q,a8 as B,ab as z,a9 as E,a5 as L,at as V}from"./Wk8iZnnz.js";import{s as _}from"./C5lbjxb5.js";import{p as S}from"./oafpEiTJ.js";import{A as b,e as k,g as G,a as H,c as q,w as J}from"./BJsdZ20B.js";import{a0 as K,f_ as N,g2 as U,g3 as X,g4 as Y,V as l,bg as m}from"./CtU81MLD.js";import{u as Z,a as p,b as $,c as ee,d as te,e as ne}from"./DRNreWhG.js";const oe=(i,e)=>{const t=Array.from(i);for(let n=0;n<i.length/3;n++)t[n*3]*=e.x,t[n*3+1]*=e.y,t[n*3+2]*=e.z;return t},ie=(i,e,t)=>{const n=e.slice();if(i==="heightfield")return n;if(i==="trimesh"||i==="convexHull")return n[0]=new Float32Array(oe(n[0],t)),n;const c=[t.x,t.y,t.z];return n.map((r,a)=>(c[a]??1)*r)};function me(i,e){M(e,!0);let t=S(e,"collider",15);const n=new K,{updateRef:c}=Z(e.oncreate),r=p(),a=$(),d=!!r,u=ee(),{world:f}=u,y=te(),C={oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit};F(async()=>{await V();const s=n.getWorldScale(new l),O=ie(e.shape,e.args,s),I=q[e.shape](...O);if(t(f.createCollider(I,r)),t().setActiveCollisionTypes(J.ALL),c(t()),u.addColliderToContext(t(),n,C),y.registerColliders([t()]),d){const A=new l,g=new m;a?.getWorldPosition(A),a?.getWorldQuaternion(g),g.invert();const T=n.getWorldPosition(new l).sub(A),D=n.getWorldQuaternion(new m).premultiply(g);t().setTranslationWrtParent(T),t().setRotationWrtParent(D)}else t().setTranslation(n.getWorldPosition(new l)),t().setRotation(n.getWorldQuaternion(new m))}),o(()=>{t()?.setRestitution(e.restitution??0)}),o(()=>{t()?.setRestitutionCombineRule(e.restitutionCombineRule??b.Average)}),o(()=>{t()?.setFriction(e.friction??.7)}),o(()=>{t()?.setFrictionCombineRule(e.frictionCombineRule??b.Average)}),o(()=>t()?.setSensor(e.sensor??!1)),o(()=>t()?.setContactForceEventThreshold(e.contactForceEventThreshold??0)),o(()=>{e.density!==void 0&&t()?.setDensity(e.density)}),o(()=>{t()&&e.mass&&(e.centerOfMass&&e.principalAngularInertia&&e.angularInertiaLocalFrame?t().setMassProperties(e.mass,{x:e.centerOfMass[0],y:e.centerOfMass[1],z:e.centerOfMass[2]},{x:e.principalAngularInertia[0],y:e.principalAngularInertia[1],z:e.principalAngularInertia[2]},k(e.angularInertiaLocalFrame)):t().setMass(e.mass))}),o(()=>{t()&&ne(t(),C,r?.userData?.events)});const v=()=>{t()&&(t().setTranslation(G(n)),t().setRotation(H(n)))},{start:R,stop:x}=N(()=>{v()},{autoStart:!d&&e.type==="dynamic"});o(()=>{!d&&e.type==="dynamic"?R():x()}),j(()=>{t()&&(u.removeColliderFromContext(t()),y.removeColliders([t()]),f.removeCollider(t(),!0),t(void 0))});const h=U();X(n),Y(h,s=>(s?.add(n),()=>{s?.remove(n)}));var P={refresh:v},w=Q(),W=B(w);return _(W,()=>e.children??z,()=>({collider:t()})),E(i,w),L(P)}export{me as C};
