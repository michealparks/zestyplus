const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/2.-QGo-h7B.js","../chunks/disclose-version.Bg9kRutz.js","../chunks/legacy.CtaTdtmd.js","../chunks/index.BFqC5wTN.js","../chunks/3.DytwCj8D.js","../chunks/index-client.DDUn5bf5.js","../chunks/template.DXGbSFUO.js","../chunks/each.BRtJwWNB.js","../chunks/svelte-component.BQYC_p_3.js","../chunks/props.Hru3xw41.js","../chunks/T.6-q_PtqM.js","../chunks/index.CL_F-KcT.js","../assets/T.C-GW8brK.css","../chunks/index.B6sckYSE.js","../chunks/Outlines.DAeXJo25.js","../chunks/BufferGeometryUtils.qtj4nVgn.js","../chunks/revision.CsE2arzN.js","../chunks/auth.svelte.8Q3o_UP0.js","../chunks/color.D7bleQK4.js","../chunks/4.5pmbYror.js","../chunks/5.Cix-EYVh.js","../chunks/lifecycle.JTAAwys7.js","../chunks/Line2.xTcFT5D2.js","../chunks/6.LjjbO2xZ.js","../chunks/7.y0kKS_f-.js","../chunks/OrbitControls.B7PtfcIW.js","../chunks/user.iRr6-NI0.js","../chunks/MarchingCubes.D7UBNvM1.js","../chunks/MarchingCube.BlJinO40.js","../chunks/MarchingPlane.B0Zo6Kc2.js","../chunks/types.5x0aK576.js","../chunks/8.Bp1_gp6X.js","../chunks/if.BU_-hnWH.js","../chunks/9.CJ2sS7Zu.js","../chunks/10.CoPAq5FG.js","../chunks/Rope.DHBBMEhg.js","../chunks/createCollidersFromChildren.BSSDzg8b.js","../chunks/Skin.-veir9rQ.js"])))=>i.map(i=>d[i]);
var gt=e=>{throw TypeError(e)};var Le=(e,t,s)=>t.has(e)||gt("Cannot "+s);var E=(e,t,s)=>(Le(e,t,"read from private field"),s?s.call(e):t.get(e)),z=(e,t,s)=>t.has(e)?gt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),V=(e,t,s,i)=>(Le(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),K=(e,t,s)=>(Le(e,t,"access private method"),s);var Fe=(e,t,s,i)=>({set _(r){V(e,t,r,s)},get _(){return E(e,t,i)}});import"../chunks/disclose-version.Bg9kRutz.js";import{J as ct,h as oe,d as us,aH as cs,b as hs,aI as fs,M as He,U as St,Y as _t,X as xt,ao as Re,au as Be,aJ as yt,j as ke,k as Ge,l as Ve,aC as ds,m as vs,o as ps,aK as Qe,ae as ms,aL as gs,E as Ss,aM as _s,aN as xs,a2 as ys,q as Ts,K as Tt,ak as Es,$ as F,aO as bs,V as ws,B as Ht,p as N,f as R,a as L,x as b,a5 as pe,c as O,r as P,a6 as fe,n as le,aP as ht,aG as Ms,aE as kt,aQ as Gt,s as D,t as Ue,aR as Ae,as as Je,u as Et,aF as Vt}from"../chunks/index-client.DDUn5bf5.js";import{i as Rs,c as Bs,d as Ie,n as Us,a as As,b as zs,e as ft,o as Cs,s as et,r as Ps}from"../chunks/render.CrgZ7ma9.js";import{c as H,a as M,t as I,d as Is}from"../chunks/template.DXGbSFUO.js";import{i as Y}from"../chunks/if.BU_-hnWH.js";import{a3 as Ds,a4 as Os,a5 as Ns,a6 as Ls,a7 as Fs,a8 as Hs,a9 as ks,aa as Gs,s as ie,e as dt,ab as Vs,c as We,ac as Ws,l as Wt,u as $t,B as ze,T as $e,f as C,ad as re,ae as A,af as $s,ag as Ks,ah as js,ai as Xs,aj as Q,ak as w,al as De,am as bt,an as qs,M as Ys,ao as Ce,h as Te,D as Ee,g as ae,ap as Zs,aq as vt,ar as Kt,as as jt,R as Xt,at as de,au as Qs,av as qt,aw as Yt,C as Js,K as wt}from"../chunks/T.6-q_PtqM.js";import{p as Zt}from"../chunks/index.CGoGDyeg.js";import{b as Mt,_ as U}from"../chunks/preload-helper.B9yEXVFW.js";import{r as _e,s as pt,p as te,a as tt,b as ei,c as Rt}from"../chunks/props.Hru3xw41.js";import{c as ti}from"../chunks/user.iRr6-NI0.js";import{u as Qt,a as si}from"../chunks/auth.svelte.8Q3o_UP0.js";import{a as ii,g as mt,o as ri}from"../chunks/types.5x0aK576.js";import"../chunks/legacy.CtaTdtmd.js";import{i as xe}from"../chunks/lifecycle.JTAAwys7.js";import{e as ni}from"../chunks/each.BRtJwWNB.js";import{O as st,c as be,d as ai,f as oi,u as li}from"../chunks/createCollidersFromChildren.BSSDzg8b.js";import{w as Bt,d as ui}from"../chunks/index.CL_F-KcT.js";import{c as ci}from"../chunks/svelte-component.BQYC_p_3.js";function hi(e,t){if(t){const s=document.body;e.autofocus=!0,ct(()=>{document.activeElement===s&&e.focus()})}}const Ke=0,we=1,je=2;function fi(e,t,s,i,r){oe&&us();var n=e,a=cs(),o=ps,u=St,l,h,c,d=(a?_t:xt)(void 0),g=(a?_t:xt)(void 0),p=!1;function f(m,v){p=!0,v&&(Re(x),Be(x),yt(o));try{m===Ke&&s&&(l?ke(l):l=Ge(()=>s(n))),m===we&&i&&(h?ke(h):h=Ge(()=>i(n,d))),m===je&&r&&(c?ke(c):c=Ge(()=>r(n,g))),m!==Ke&&l&&Ve(l,()=>l=null),m!==we&&h&&Ve(h,()=>h=null),m!==je&&c&&Ve(c,()=>c=null)}finally{v&&(yt(null),Be(null),Re(null),ds())}}var x=hs(()=>{if(u!==(u=t())){if(fs(u)){var m=u;p=!1,m.then(v=>{m===u&&(He(d,v),f(we,!0))},v=>{if(m===u&&(He(g,v),f(je,!0),!r))throw g.v}),oe||ct(()=>{p||f(Ke,!0)})}else He(d,u),f(we,!1);return()=>u=St}});oe&&(n=vs)}function Jt(e){var t,s,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=Jt(e[t]))&&(i&&(i+=" "),i+=s)}else for(s in e)e[s]&&(i&&(i+=" "),i+=s);return i}function di(){for(var e,t,s=0,i="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=Jt(e))&&(i&&(i+=" "),i+=t);return i}function vi(e){return typeof e=="object"?di(e):e??""}function pi(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function it(e,t,s,i){var r=e.__attributes??(e.__attributes={});oe&&(r[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||r[t]!==(r[t]=s)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[Qe]=s),s==null?e.removeAttribute(t):typeof s!="string"&&es(e).includes(t)?e[t]=s:e.setAttribute(t,s))}function mi(e,t,s,i,r=!1,n=!1,a=!1){var o=t||{},u=e.tagName==="OPTION";for(var l in t)l in s||(s[l]=null);s.class&&(s.class=vi(s.class));var h=es(e),c=e.__attributes??(e.__attributes={});for(const m in s){let v=s[m];if(u&&m==="value"&&v==null){e.value=e.__value="",o[m]=v;continue}var d=o[m];if(v!==d){o[m]=v;var g=m[0]+m[1];if(g!=="$$"){if(g==="on"){const y={},T="$$"+m;let B=m.slice(2);var p=As(B);if(Rs(B)&&(B=B.slice(0,-7),y.capture=!0),!p&&d){if(v!=null)continue;e.removeEventListener(B,o[T],y),o[T]=null}if(v!=null)if(p)e[`__${B}`]=v,Ie([B]);else{let $=function(Ne){o[m].call(this,Ne)};o[T]=Bs(B,e,$,y)}else p&&(e[`__${B}`]=void 0)}else if(m==="style"&&v!=null)e.style.cssText=v+"";else if(m==="autofocus")hi(e,!!v);else if(m==="__value"||m==="value"&&v!=null)e.value=e[m]=e.__value=v;else if(m==="selected"&&u)pi(e,v);else{var f=m;r||(f=Us(f));var x=f==="defaultValue"||f==="defaultChecked";if(v==null&&!n&&!x)if(c[m]=null,f==="value"||f==="checked"){let y=e;if(f==="value"){let T=y.defaultValue;y.removeAttribute(f),y.defaultValue=T}else{let T=y.defaultChecked;y.removeAttribute(f),y.defaultChecked=T}}else e.removeAttribute(m);else x||h.includes(f)&&(n||typeof v!="string")?e[f]=v:typeof v!="function"&&(oe&&(f==="src"||f==="href"||f==="srcset")||it(e,f,v))}m==="style"&&"__styles"in e&&(e.__styles={})}}}return o}var Ut=new Map;function es(e){var t=Ut.get(e.nodeName);if(t)return t;Ut.set(e.nodeName,t=[]);for(var s,i=e,r=Element.prototype;r!==i;){s=gs(i);for(var n in s)s[n].set&&t.push(n);i=ms(i)}return t}function gi(e){if(!oe&&e.loading==="lazy"){var t=e.src;e[Qe]=null,e.loading="eager",e.removeAttribute("src"),requestAnimationFrame(()=>{e[Qe]!=="eager"&&(e.loading="lazy"),e.src=t})}}const Si=()=>performance.now(),W={tick:e=>requestAnimationFrame(e),now:()=>Si(),tasks:new Set};function ts(){const e=W.now();W.tasks.forEach(t=>{t.c(e)||(W.tasks.delete(t),t.f())}),W.tasks.size!==0&&W.tick(ts)}function _i(e){let t;return W.tasks.size===0&&W.tick(ts),{promise:new Promise(s=>{W.tasks.add(t={c:e,f:s})}),abort(){W.tasks.delete(t)}}}function Me(e,t){e.dispatchEvent(new CustomEvent(t))}function xi(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function At(e){const t={},s=e.split(";");for(const i of s){const[r,n]=i.split(":");if(!r||n===void 0)break;const a=xi(r.trim());t[a]=n.trim()}return t}const yi=e=>e;function Ti(e,t,s,i){var r=(e&bs)!==0,n="both",a,o=t.inert,u,l;function h(){var f=ws,x=Tt;Be(null),Re(null);try{return a??(a=s()(t,(i==null?void 0:i())??{},{direction:n}))}finally{Be(f),Re(x)}}var c={is_global:r,in(){t.inert=o,Me(t,"introstart"),u=rt(t,h(),l,1,()=>{Me(t,"introend"),u==null||u.abort(),u=a=void 0})},out(f){t.inert=!0,Me(t,"outrostart"),l=rt(t,h(),u,0,()=>{Me(t,"outroend"),f==null||f()})},stop:()=>{u==null||u.abort(),l==null||l.abort()}},d=Tt;if((d.transitions??(d.transitions=[])).push(c),zs){var g=r;if(!g){for(var p=d.parent;p&&p.f&Ss;)for(;(p=p.parent)&&!(p.f&_s););g=!p||(p.f&xs)!==0}g&&ys(()=>{Ts(()=>c.in())})}}function rt(e,t,s,i,r){var n=i===1;if(Es(t)){var a,o=!1;return ct(()=>{if(!o){var x=t({direction:n?"in":"out"});a=rt(e,x,s,i,r)}}),{abort:()=>{o=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(s==null||s.deactivate(),!(t!=null&&t.duration))return r(),{abort:F,deactivate:F,reset:F,t:()=>i};const{delay:u=0,css:l,tick:h,easing:c=yi}=t;var d=[];if(n&&s===void 0&&(h&&h(0,1),l)){var g=At(l(0,1));d.push(g,g)}var p=()=>1-i,f=e.animate(d,{duration:u});return f.onfinish=()=>{var x=(s==null?void 0:s.t())??1-i;s==null||s.abort();var m=i-x,v=t.duration*Math.abs(m),y=[];if(v>0){if(l)for(var T=Math.ceil(v/16.666666666666668),B=0;B<=T;B+=1){var $=x+m*c(B/T),Ne=l($,1-$);y.push(At(Ne))}p=()=>{var ye=f.currentTime;return x+m*c(ye/v)},h&&_i(()=>{if(f.playState!=="running")return!1;var ye=p();return h(ye,1-ye),!0})}f=e.animate(y,{duration:v,fill:"forwards"}),f.onfinish=()=>{p=()=>i,h==null||h(i,1-i),r()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=F)},deactivate:()=>{r=F},reset:()=>{i===0&&(h==null||h(1,0))},t:()=>p()}}const Ei=!0,bi=!1,wi=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ei,ssr:bi},Symbol.toStringTag,{value:"Module"})),zt=(e,t)=>{if(e===t)return!0;if(!e||!t)return!1;const s=e.length;if(t.length!==s)return!1;for(let i=0;i<s;i++)if(e[i]!==t[i])return!1;return!0},Mi=()=>{const e=[],i={items:e,remember:(r,n)=>{for(let o=0;o<e.length;o++){const u=e[o];if(zt(n,u.keys)&&u.promise)return u.promise}const a={promise:r(),keys:n};return e.push(a),a.promise},clear:r=>{for(let n=0;n<e.length;n++){const a=e[n];if(zt(r,a.keys)){e.splice(n,1);return}}}};return Ht("threlte-cache",i),i},Ri=e=>{Ds(e),Mi();const{scene:t}=Os();Ns(t),Ls(t),Fs(),Hs(e),ks(),Gs(e),ti()};function Bi(e,t){N(t,!0);let s=_e(t,["$$slots","$$events","$$legacy","children"]);Ri(s);var i=H(),r=R(i);ie(r,()=>t.children),M(e,i),L()}var Ui=I('<div class="svelte-1osucwe"><canvas class="svelte-1osucwe"><!></canvas></div>');function Ai(e,t){N(t,!0);let s=_e(t,["$$slots","$$events","$$legacy","children"]),i=pe(void 0),r=pe(void 0);var n=Ui(),a=O(n),o=O(a);{var u=l=>{Bi(l,pt({get dom(){return b(r)},get canvas(){return b(i)}},()=>s,{children:(h,c)=>{var d=H(),g=R(d);ie(g,()=>t.children??F),M(h,d)},$$slots:{default:!0}}))};Y(o,l=>{b(i)&&b(r)&&l(u)})}P(a),Mt(a,l=>fe(i,l),()=>b(i)),P(n),Mt(n,l=>fe(r,l),()=>b(r)),M(e,n),L()}function Ct(e,t){const{scheduler:s}=dt();return s.getStage(e)??s.createStage(e,t)}var me;class zi{constructor(){z(this,me,pe())}get current(){return b(E(this,me))}set current(t){fe(E(this,me),te(t))}}me=new WeakMap;const ss=new zi;let Pt=!1;const Ci={NO_TRACK_PLAYING:204},Pi=async e=>{const t="https://api.spotify.com/v1/me/player/currently-playing";try{const s=await fetch(t,{headers:{Authorization:`Bearer ${e.access}`,"Content-Type":"application/json"}});if(s.status===Ci.NO_TRACK_PLAYING){console.log("No track is currently playing.");return}if(!s.ok){console.error(`fetchCurrentlyPlayingTrack: ${s.status} - ${s.statusText}`);return}return s.json()}catch(s){console.error("Error fetching currently playing track:",s)}},nt=async e=>{const t=await Pi(e);if(ss.current=t,t===void 0){setTimeout(nt,3e3,e);return}const s=t.item.duration_ms-t.progress_ms+1e3;setTimeout(nt,s,e)},Ii=()=>{const{token:e,authenticated:t}=Qt();return Pt||(le(()=>{t.current==="logged-in"&&nt(e)}),Pt=!0),{track:ss}},Di=["tubeman"],Oi=Object.assign({"../routes/+layout.svelte":()=>U(()=>Promise.resolve().then(()=>Dn),void 0,import.meta.url),"../routes/+layout.ts":()=>U(()=>Promise.resolve().then(()=>wi),void 0,import.meta.url),"../routes/+page.svelte":()=>U(()=>import("../chunks/2.-QGo-h7B.js").then(e=>e.a),__vite__mapDeps([0,1,2,3]),import.meta.url),"../routes/bars/+page.svelte":()=>U(()=>import("../chunks/3.DytwCj8D.js").then(e=>e.a),__vite__mapDeps([4,1,5,3,6,7,8,9,10,11,12,13,2,14,15,16,17,18]),import.meta.url),"../routes/cubes/+page.svelte":()=>U(()=>import("../chunks/4.5pmbYror.js").then(e=>e.a),__vite__mapDeps([19,1,5,3,6,8,10,9,11,12,17,13,15,2]),import.meta.url),"../routes/curves/+page.svelte":()=>U(()=>import("../chunks/5.Cix-EYVh.js").then(e=>e.a),__vite__mapDeps([20,1,2,3,5,6,7,21,10,9,11,12,13,17,18,22]),import.meta.url),"../routes/grid/+page.svelte":()=>U(()=>import("../chunks/6.LjjbO2xZ.js").then(e=>e.a),__vite__mapDeps([23,1,5,3,6,7,8,9,10,11,12,13,2,14,15,16,17,18]),import.meta.url),"../routes/lava/+page.svelte":()=>U(()=>import("../chunks/7.y0kKS_f-.js").then(e=>e.a),__vite__mapDeps([24,1,5,3,6,7,8,10,9,11,12,13,25,26,2,27,28,29,17]),import.meta.url),"../routes/lava/MarchingCube.ts":()=>U(()=>import("../chunks/MarchingCube.BlJinO40.js"),__vite__mapDeps([28,10,1,5,3,6,9,11,12]),import.meta.url),"../routes/lava/MarchingCubes.svelte":()=>U(()=>import("../chunks/MarchingCubes.D7UBNvM1.js"),__vite__mapDeps([27,1,5,3,6,10,9,11,12,28,29]),import.meta.url),"../routes/lava/MarchingPlane.ts":()=>U(()=>import("../chunks/MarchingPlane.B0Zo6Kc2.js"),__vite__mapDeps([29,10,1,5,3,6,9,11,12]),import.meta.url),"../routes/lava/types.ts":()=>U(()=>import("../chunks/types.5x0aK576.js").then(e=>e.t),__vite__mapDeps([30,5,3,11]),import.meta.url),"../routes/lines/+page.svelte":()=>U(()=>import("../chunks/8.Bp1_gp6X.js").then(e=>e.a),__vite__mapDeps([31,1,5,3,6,7,8,9,10,11,12,13,32,16,2,18,17,22]),import.meta.url),"../routes/pulsar/+page.svelte":()=>U(()=>import("../chunks/9.CJ2sS7Zu.js").then(e=>e.a),__vite__mapDeps([33,1,2,3,5,6,7,21,17,9,10,11,12,13,25,26,22]),import.meta.url),"../routes/tubeman/+page.svelte":()=>U(()=>import("../chunks/10.CoPAq5FG.js").then(e=>e.a),__vite__mapDeps([34,1,5,3,6,8,9,10,11,12,35,7,36,13,25,26,2]),import.meta.url),"../routes/tubeman/Rope.svelte":()=>U(()=>import("../chunks/Rope.DHBBMEhg.js").then(e=>e.a),__vite__mapDeps([35,1,5,3,6,7,8,9,10,11,12,36]),import.meta.url),"../routes/tubeman/Skin.svelte":()=>U(()=>import("../chunks/Skin.-veir9rQ.js"),__vite__mapDeps([37,1,5,3,6,8,10,9,11,12]),import.meta.url)}),ve=Object.keys(Oi).map(e=>e.split("/")[2]).filter(e=>!e.startsWith("+")).filter(e=>!Di.includes(e)),Ni=()=>{const e=[...ve],t=s=>{ii(s);const i=e.pop();i!==void 0&&setTimeout(t,1e3,i)};setTimeout(t,1e3,e.pop())},Xe={Studio:"s",Fullscreen:"f",PreviousPage:"arrowleft",NextPage:"arrowright"};function Li(e,t){N(t,!1);const s=async()=>{document.body.requestFullscreen()},i=n=>{const a=Zt.url.pathname.replace("/","");let u=ve.findIndex(l=>l===a)+n;u===ve.length?u=0:u===-1&&(u=ve.length-1),mt(`/${ve[u]}`)},r=n=>{switch(n.key.toLowerCase()){case Xe.Fullscreen:return s();case Xe.PreviousPage:return i(-1);case Xe.NextPage:return i(1)}};xe(),ft("keydown",ht,r),L()}const Fi=e=>e;function Hi(e,{delay:t=0,duration:s=400,easing:i=Fi}={}){const r=+getComputedStyle(e).opacity;return{delay:t,duration:s,easing:i,css:n=>`opacity: ${n*r}`}}const is=window;function ki(e){let t=e.activeElement;for(;t!=null&&t.shadowRoot;){const s=t.shadowRoot.activeElement;if(s===t)break;t=s}return t}function It(e,t,s,i){const r=Array.isArray(t)?t:[t];for(const n of r)e.addEventListener(n,s,i);return()=>{for(const n of r)e.removeEventListener(n,s,i)}}var ue,ge,X,J,Z,at,ot;class Gi{constructor(t,s){z(this,Z);z(this,ue,pe());z(this,ge);z(this,X,0);z(this,J,null);E(this,ue).v=te(t),V(this,ge,s)}get current(){return Ms()?le(()=>(Fe(this,X)._++,E(this,X)===1&&K(this,Z,at).call(this,!0),()=>{kt().then(()=>{Fe(this,X)._--,E(this,X)===0&&K(this,Z,ot).call(this)})})):E(this,X)===0&&(K(this,Z,at).call(this,!1),K(this,Z,ot).call(this)),b(E(this,ue))}}ue=new WeakMap,ge=new WeakMap,X=new WeakMap,J=new WeakMap,Z=new WeakSet,at=function(t){V(this,J,E(this,ge).call(this,s=>{fe(E(this,ue),te(s))},t)??null)},ot=function(){E(this,J)!==null&&(E(this,J).call(this),V(this,J,null))};function Vi(e={}){const{window:t=is}=e,s=e.document??(t==null?void 0:t.document);return new Gi(null,(i,r)=>{function n(){s&&i(ki(s))}if(n(),!r||!t)return;const a=It(t,"focusin",n),o=It(t,"focusout",n);return()=>{a(),o()}})}Vi();function Wi(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}var ee,q,ce,he,Se,Pe,ne,lt,ns;class rs{constructor(t,s,i={}){z(this,ne);z(this,ee,pe());z(this,q);z(this,ce);z(this,he);z(this,Se);z(this,Pe,t=>{t.key!==E(this,q)||t.newValue===null||K(this,ne,lt).call(this,t.newValue)});const{storage:r="local",serializer:n={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:a=!0,window:o=is}=i;if(E(this,ee).v=te(s),V(this,q,t),V(this,ce,n),o===void 0)return;const u=Wi(r,o);V(this,he,u);const l=u.getItem(t);l!==null&&K(this,ne,lt).call(this,l),a&&r==="local"&&V(this,Se,Vs(()=>Cs(o,"storage",E(this,Pe))))}get current(){var t;return(t=E(this,Se))==null||t.call(this),b(E(this,ee))}set current(t){fe(E(this,ee),te(t)),K(this,ne,ns).call(this,t)}}ee=new WeakMap,q=new WeakMap,ce=new WeakMap,he=new WeakMap,Se=new WeakMap,Pe=new WeakMap,ne=new WeakSet,lt=function(t){try{fe(E(this,ee),te(E(this,ce).deserialize(t)))}catch(s){console.error(`Error when parsing "${t}" from persisted store "${E(this,q)}"`,s)}},ns=function(t){var s;try{(s=E(this,he))==null||s.setItem(E(this,q),E(this,ce).serialize(t))}catch(i){console.error(`Error when writing value from persisted store "${E(this,q)}" to ${E(this,he)}`,i)}};var $i=I('<span class="svelte-101a3xu"> </span>'),Ki=I('<div class="absolute bottom-0 right-0 flex flex-col items-end gap-1.5 p-4 text-white"><div class="h-[120px] w-[120px] overflow-hidden rounded-lg shadow-2xl"><img class="select-none" width="120" height="120"></div> <p class="text-sm leading-none"> </p> <p class="text-xs leading-none"></p></div>');function ji(e,t){N(t,!1);const{track:s}=Ii(),i=Gt(new rs("trackinfo-visible",!0));xe();var r=H();ft("keydown",ht,o=>{o.key.toLowerCase()==="t"&&Ae(i,b(i).current=!b(i).current)});var n=R(r);{var a=o=>{var u=Ki();const l=Je(()=>{const{item:f}=s.current;return{item:f}});var h=O(u),c=O(h);P(h);var d=D(h,2),g=O(d,!0);P(d);var p=D(d,2);ni(p,5,()=>b(l).item.artists,f=>f.name,(f,x)=>{var m=$i(),v=O(m,!0);P(m),Ue(()=>et(v,b(x).name)),M(f,m)}),P(p),P(u),Ue(()=>{it(c,"alt",b(l).item.album.name),it(c,"src",b(l).item.album.images[0].url),et(g,b(l).item.name)}),Ti(3,u,()=>Hi,()=>({duration:200})),M(o,u)};Y(n,o=>{b(i).current&&s.current&&o(a)})}M(e,r),L()}const Dt=(e,t=F,s=F)=>{var i=Xi();i.__click=function(...n){var a;(a=s())==null||a.apply(this,n)};var r=O(i,!0);P(i),Ue(()=>et(r,t())),M(e,i)};var Xi=I('<button class="bg-slate-600 px-2 py-0.5 text-xs text-slate-100"> </button>'),qi=I("<div><!></div>");function Yi(e,t){N(t,!1);const{authenticated:s,login:i,logout:r}=Qt();xe();var n=qi(),a=O(n);{var o=l=>{var h=Is("...");M(l,h)},u=l=>{var h=H(),c=R(h);{var d=p=>{var f=Je(()=>()=>r());Dt(p,()=>"Logout",()=>b(f))},g=p=>{var f=H(),x=R(f);{var m=v=>{var y=Je(()=>()=>i());Dt(v,()=>"Login",()=>b(y))};Y(x,v=>{s.current==="logged-out"&&v(m)},!0)}M(p,f)};Y(c,p=>{s.current==="logged-in"?p(d):p(g,!1)},!0)}M(l,h)};Y(a,l=>{s.current==="pending"?l(o):l(u,!1)})}P(n),M(e,n),L()}Ie(["click"]);var Zi=(e,t)=>Ae(t,b(t).current=!b(t).current),Qi=I('<div class="absolute left-0 top-0 z-20 grid h-screen w-screen backdrop-blur-sm"></div> <div class="absolute left-0 top-0 z-20 grid h-screen w-screen place-content-center"><div class="h-44 w-80 rounded-sm bg-white p-2 shadow-xl"><!></div></div>',1),Ji=I('<button class="absolute right-2 top-2 z-10 h-6 w-6 p-1" aria-label="Open settings"><svg class="h-full fill-white" viewBox="0 0 32 32"><path d="M13,16c0,1.654,1.346,3,3,3s3-1.346,3-3s-1.346-3-3-3S13,14.346,13,16z"></path><path d="M13,26c0,1.654,1.346,3,3,3s3-1.346,3-3s-1.346-3-3-3S13,24.346,13,26z"></path><path d="M13,6c0,1.654,1.346,3,3,3s3-1.346,3-3s-1.346-3-3-3S13,4.346,13,6z"></path></svg></button> <!>',1);function er(e,t){N(t,!1);const s=Gt(new rs("settings-open",!1));xe();var i=Ji();ft("keydown",ht,o=>{const u=o.key.toLowerCase();u==="s"&&Ae(s,b(s).current=!b(s).current),b(s).current&&u==="escape"&&Ae(s,b(s).current=!1)});var r=R(i);r.__click=[Zi,s];var n=D(r,2);{var a=o=>{var u=Qi(),l=D(R(u),2),h=O(l),c=O(h);Yi(c,{}),P(h),P(l),M(o,u)};Y(n,o=>{b(s).current&&o(a)})}M(e,i),L()}Ie(["click"]);function tr(e,t){N(t,!1),ri(s=>{if(document.startViewTransition)return new Promise(i=>{document.startViewTransition(async()=>{i(),await s.complete})})}),xe(),L()}let Ot=!1,qe;const sr=()=>Ot?!0:(qe||(qe=new Promise(e=>{st.init().then(()=>{Ot=!0,e()})})),qe),ir=(e,t,s,i)=>{var h,c,d,g;let r=0,n=0,a=0;const{renderStage:o}=dt(),u=Ct(be,{after:(h=i==null?void 0:i.simulationStageOptions)==null?void 0:h.after,before:(c=i==null?void 0:i.simulationStageOptions)==null?void 0:c.before,callback(p,f){if(e.current==="varying")f();else{const x=1/e.current;n+=p,r+=p;const m=Math.ceil(r/x);for(let v=0;v<m;v++)s.set(v>=m-2),f(x),r-=x,a+=x;t.set((n-a)/x+1)}}}),l=Ct(ai,{after:(d=i==null?void 0:i.synchronizationStageOptions)!=null&&d.after?Array.isArray(i.synchronizationStageOptions.after)?[...i.synchronizationStageOptions.after,be]:[i.synchronizationStageOptions.after,be]:be,before:(g=i==null?void 0:i.synchronizationStageOptions)!=null&&g.before?Array.isArray(i.synchronizationStageOptions.before)?[...i.synchronizationStageOptions.before,o]:[i.synchronizationStageOptions.before,o]:o});return{simulationStage:u,synchronizationStage:l}},rr=(e,t)=>{const s=new st.World(...e),i=new Map,r=new Map,n=new Map,a=new Map,o=(T,B,$)=>{i.set(T.handle,B),a.set(T.handle,$)},u=T=>{i.delete(T.handle),a.delete(T.handle)},l=(T,B,$)=>{r.set(T.handle,B),n.set(T.handle,$)},h=T=>{r.delete(T.handle),n.delete(T.handle)},c=We(t.framerate??"varying"),d=We(1),g=We(c.current==="varying"),{simulationStage:p,synchronizationStage:f}=ir(c,d,g,t),x=t.autoStart??!0,m=Bt(!x);x||(p.stop(),f.stop());const{simulationTask:v,synchronizationTask:y}=oi(s,c,d,r,g,a,n,p,f);return{rapier:st,world:s,colliderObjects:i,rigidBodyObjects:r,rigidBodyEventDispatchers:n,colliderEventDispatchers:a,addColliderToContext:o,removeColliderFromContext:u,addRigidBodyToContext:l,removeRigidBodyFromContext:h,debug:Bt(!1),pause:()=>{m.set(!0),p.stop(),f.stop()},resume:()=>{m.set(!1),p.start(),f.start()},paused:ui(m,T=>T),framerate:c,simulationOffset:d,simulationStage:p,synchronizationStage:f,updateRigidBodySimulationData:g,simulationTask:v,synchronizationTask:y}};function nr(e,t){N(t,!0);let s=tt(t,"gravity",19,()=>[0,-9.81,0]),i=tt(t,"autoStart",3,!0);const r=rr([{x:s()[0],y:s()[1],z:s()[2]},t.rawIntegrationParameters,t.rawIslands,t.rawBroadPhase,t.rawNarrowPhase,t.rawBodies,t.rawColliders,t.rawImpulseJoints,t.rawMultibodyJoints,t.rawCCDSolver,t.rawQueryPipeline,t.rawPhysicsPipeline,t.rawSerializationPipeline,t.rawDebugRenderPipeline],{framerate:t.framerate,autoStart:i(),simulationStageOptions:t.simulationStageOptions,synchronizationStageOptions:t.synchronizationStageOptions});Ht("threlte-rapier-context",r),Et(()=>{s()!==void 0&&(r.world.gravity={x:s()[0],y:s()[1],z:s()[2]})}),Et(()=>{t.framerate!==void 0&&r.framerate.set(t.framerate)}),Vt(async()=>{await kt(),r.world.free()});var n=H(),a=R(n);ie(a,()=>t.children??F),M(e,n),L()}function ar(e,t){N(t,!0);let s=_e(t,["$$slots","$$events","$$legacy","fallback","children"]);var i=H(),r=R(i);fi(r,sr,null,(n,a)=>{nr(n,pt(()=>s,{children:(o,u)=>{var l=H(),h=R(l);ie(h,()=>t.children??F),M(o,l)},$$slots:{default:!0}}))},(n,a)=>{var o=H(),u=R(o);ie(u,()=>t.fallback??F,()=>b(a)),M(n,o)}),M(e,i),L()}var or=I("<!> <!>",1);function lr(e,t){N(t,!0);let s=tt(t,"ref",27,()=>te(new Ws)),i=_e(t,["$$slots","$$events","$$legacy","ref"]);const{world:r,debug:n}=li(),a=new Wt;n.set(!0),$t(()=>{const o=r.debugRender(),u=new ze(o.vertices,3),l=new ze(o.colors,4);a.setAttribute("position",u),a.setAttribute("color",l)}),Vt(()=>{n.set(!1)}),$e(e,pt({get is(){return s()},frustumCulled:!1,renderOrder:1/0},()=>i,{children:(o,u)=>{var l=or(),h=R(l);$e(h,{is:a});var c=D(h,2);ci(c,()=>$e.LineBasicMaterial,(d,g)=>{g(d,{vertexColors:!0})}),M(o,l)},$$slots:{default:!0}})),L()}/**
 * postprocessing v6.36.4 build Tue Nov 05 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var Ye=1/1e3,ur=1e3,cr=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*Ye}get fixedDelta(){return this._fixedDelta*Ye}set fixedDelta(e){this._fixedDelta=e*ur}get elapsed(){return this._elapsed*Ye}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},hr=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),s=new Wt;return s.setAttribute("position",new ze(e,3)),s.setAttribute("uv",new ze(t,2)),s})(),k=class ut{static get fullscreenGeometry(){return hr}constructor(t="Pass",s=new bt,i=new qs){this.name=t,this.renderer=null,this.scene=s,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const s=this.fullscreenMaterial;s!==null&&(s.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let s=this.screen;s!==null?s.material=t:(s=new Ys(ut.fullscreenGeometry,t),s.frustumCulled=!1,this.scene===null&&(this.scene=new bt),this.scene.add(s),this.screen=s)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,s=De){}render(t,s,i,r,n){throw new Error("Render method not implemented!")}setSize(t,s){}initialize(t,s,i){}dispose(){for(const t of Object.keys(this)){const s=this[t];(s instanceof Q||s instanceof qt||s instanceof Yt||s instanceof ut)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},fr=class extends k{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,s,i,r){const n=e.state.buffers.stencil;n.setLocked(!1),n.setTest(!1)}},dr=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,as="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",os=class extends ae{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new w(null),opacity:new w(1)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:dr,vertexShader:as})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},vr=class extends k{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new os,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Q(1,1,{minFilter:Ce,magFilter:Ce,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,s,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTarget.texture.type=s,s!==re?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e!==null&&e.outputColorSpace===A&&(this.renderTarget.texture.colorSpace=A))}},Nt=new Js,ls=class extends k{constructor(e=!0,t=!0,s=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=s,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,s){this.color=e,this.depth=t,this.stencil=s}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,s,i,r){const n=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),u=n!==null,l=a>=0;u?(e.getClearColor(Nt),e.setClearColor(n,l?a:o)):l&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),u?e.setClearColor(Nt,o):l&&e.setClearAlpha(o)}},pr=class extends k{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new ls(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,s,i,r){const n=e.getContext(),a=e.state.buffers,o=this.scene,u=this.camera,l=this.clearPass,h=this.inverted?0:1,c=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),a.stencil.setFunc(n.ALWAYS,h,4294967295),a.stencil.setClear(c),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(e,null):(l.render(e,t),l.render(e,s))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,u)):(e.setRenderTarget(t),e.render(o,u),e.setRenderTarget(s),e.render(o,u)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(n.EQUAL,1,4294967295),a.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),a.stencil.setLocked(!0)}},mr=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:s=!1,multisampling:i=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,s,r,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new vr,this.depthTexture=null,this.passes=[],this.timer=new cr,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,s=this.multisampling;s>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):s!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new C),s=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===re&&e.outputColorSpace===A&&(this.inputBuffer.texture.colorSpace=A,this.outputBuffer.texture.colorSpace=A,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(e,s,i)}}replaceRenderer(e,t=!0){const s=this.renderer,i=s.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(s.domElement),i.appendChild(e.domElement)),s}createDepthTexture(){const e=this.depthTexture=new $s;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=Ks,e.type=js):e.type=Xs,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,s,i){const r=this.renderer,n=r===null?new C:r.getDrawingBufferSize(new C),a={minFilter:Ce,magFilter:Ce,stencilBuffer:t,depthBuffer:e,type:s},o=new Q(n.width,n.height,a);return i>0&&(o.ignoreDepthForMultisampleCopy=!1,o.samples=i),s===re&&r!==null&&r.outputColorSpace===A&&(o.texture.colorSpace=A),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const s=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new C),n=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,n,a),this.autoRenderToScreen&&(s.length>0&&(s[s.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?s.splice(t,0,e):s.push(e),this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const o=this.createDepthTexture();for(e of s)e.setDepthTexture(o)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,s=t.indexOf(e);if(s!==-1&&t.splice(s,1).length>0){if(this.depthTexture!==null){const n=(o,u)=>o||u.needsDepthTexture;t.reduce(n,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&s===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,s=this.copyPass;let i=this.inputBuffer,r=this.outputBuffer,n=!1,a,o,u;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(t,i,r,e,n),l.needsSwap&&(n&&(s.renderToScreen=l.renderToScreen,a=t.getContext(),o=t.state.buffers.stencil,o.setFunc(a.NOTEQUAL,1,4294967295),s.render(t,i,r,e,n),o.setFunc(a.EQUAL,1,4294967295)),u=i,i=r,r=u),l instanceof pr?n=!0:l instanceof fr&&(n=!1))}setSize(e,t,s){const i=this.renderer,r=i.getSize(new C);(e===void 0||t===void 0)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&i.setSize(e,t,s);const n=i.getDrawingBufferSize(new C);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height);for(const a of this.passes)a.setSize(n.width,n.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),k.fullscreenGeometry.dispose()}},se={NONE:0,DEPTH:1,CONVOLUTION:2},_={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},gr=class{constructor(){this.shaderParts=new Map([[_.FRAGMENT_HEAD,null],[_.FRAGMENT_MAIN_UV,null],[_.FRAGMENT_MAIN_IMAGE,null],[_.VERTEX_HEAD,null],[_.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=se.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Kt}},Ze=!1,Lt=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let s;if(t.material.flatShading)switch(t.material.side){case Ee:s=this.materialsFlatShadedDoubleSide;break;case Te:s=this.materialsFlatShadedBackSide;break;default:s=this.materialsFlatShaded;break}else switch(t.material.side){case Ee:s=this.materialsDoubleSide;break;case Te:s=this.materialsBackSide;break;default:s=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=s[2]:t.isInstancedMesh?t.material=s[1]:t.material=s[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof ae))return e.clone();const t=e.uniforms,s=new Map;for(const r in t){const n=t[r].value;n.isRenderTargetTexture&&(t[r].value=null,s.set(r,n))}const i=e.clone();for(const r of s)t[r[0]].value=r[1],i.uniforms[r[0]].value=r[1];return i}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const s of t)s.uniforms=Object.assign({},e.uniforms),s.side=Zs;t[2].skinning=!0,this.materialsBackSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.side=Te,i}),this.materialsDoubleSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.side=Ee,i}),this.materialsFlatShaded=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=Te,i}),this.materialsFlatShadedDoubleSide=t.map(s=>{const i=this.cloneMaterial(s);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=Ee,i})}}render(e,t,s){const i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Ze){const r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,s);for(const n of r)n[0].material=n[1];this.meshCount!==r.size&&r.clear()}else{const r=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,s),t.overrideMaterial=r}e.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Ze}static set workaroundEnabled(e){Ze=e}},j=-1,G=class extends vt{constructor(e,t=j,s=j,i=1){super(),this.resizable=e,this.baseSize=new C(1,1),this.preferredSize=new C(t,s),this.target=this.preferredSize,this.s=i,this.effectiveSize=new C,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,s=this.effectiveSize,i=this.scale;t.width!==j?s.width=t.width:t.height!==j?s.width=Math.round(t.height*(e.width/Math.max(e.height,1))):s.width=Math.round(e.width*i),t.height!==j?s.height=t.height:t.width!==j?s.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):s.height=Math.round(e.height*i)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(j),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return j}},S={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Sr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",_r="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",xr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",yr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Tr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Er="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",br="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",wr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Mr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Rr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Br="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Ur="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Ar="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",zr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",Cr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Pr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Ir="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Dr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Or="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Nr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Lr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Fr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Hr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",kr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Gr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",Vr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Wr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",$r="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Kr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",jr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Xr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",qr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Yr=new Map([[S.ADD,Sr],[S.ALPHA,_r],[S.AVERAGE,xr],[S.COLOR,yr],[S.COLOR_BURN,Tr],[S.COLOR_DODGE,Er],[S.DARKEN,br],[S.DIFFERENCE,wr],[S.DIVIDE,Mr],[S.DST,null],[S.EXCLUSION,Rr],[S.HARD_LIGHT,Br],[S.HARD_MIX,Ur],[S.HUE,Ar],[S.INVERT,zr],[S.INVERT_RGB,Cr],[S.LIGHTEN,Pr],[S.LINEAR_BURN,Ir],[S.LINEAR_DODGE,Dr],[S.LINEAR_LIGHT,Or],[S.LUMINOSITY,Nr],[S.MULTIPLY,Lr],[S.NEGATION,Fr],[S.NORMAL,Hr],[S.OVERLAY,kr],[S.PIN_LIGHT,Gr],[S.REFLECT,Vr],[S.SATURATION,Wr],[S.SCREEN,$r],[S.SOFT_LIGHT,Kr],[S.SRC,jr],[S.SUBTRACT,Xr],[S.VIVID_LIGHT,qr]]),Zr=class extends vt{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new w(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return Yr.get(this.blendFunction)}},Oe={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Qr=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Jr="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",en=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],tn=class extends ae{constructor(e=new wt){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new w(null),texelSize:new w(new wt),scale:new w(1),kernel:new w(0)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qr,vertexShader:Jr}),this.setTexelSize(e.x,e.y),this.kernelSize=Oe.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return en[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const s=1/e,i=1/t;this.uniforms.texelSize.value.set(s,i,s*.5,i*.5)}},sn=class extends k{constructor({kernelSize:e=Oe.MEDIUM,resolutionScale:t=.5,width:s=G.AUTO_SIZE,height:i=G.AUTO_SIZE,resolutionX:r=s,resolutionY:n=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Q(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new G(this,r,n,t);a.addEventListener("change",o=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new tn,this._blurMaterial.kernelSize=e,this.copyMaterial=new os}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,s,i,r){const n=this.scene,a=this.camera,o=this.renderTargetA,u=this.renderTargetB,l=this.blurMaterial,h=l.kernelSequence;let c=t;this.fullscreenMaterial=l;for(let d=0,g=h.length;d<g;++d){const p=d&1?u:o;l.kernel=h[d],l.inputBuffer=c.texture,e.setRenderTarget(p),e.render(n,a),c=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=c.texture,e.setRenderTarget(this.renderToScreen?null:s),e.render(n,a)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t);const i=s.width,r=s.height;this.renderTargetA.setSize(i,r),this.renderTargetB.setSize(i,r),this.blurMaterial.setSize(e,t)}initialize(e,t,s){s!==void 0&&(this.renderTargetA.texture.type=s,this.renderTargetB.texture.type=s,s!==re?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e!==null&&e.outputColorSpace===A&&(this.renderTargetA.texture.colorSpace=A,this.renderTargetB.texture.colorSpace=A))}static get AUTO_SIZE(){return G.AUTO_SIZE}},rn=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,nn=class extends ae{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Xt.replace(/\D+/g,"")},uniforms:{inputBuffer:new w(null),threshold:new w(0),smoothing:new w(1),range:new w(null)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:rn,vertexShader:as}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},an=class extends k{constructor({renderTarget:e,luminanceRange:t,colorOutput:s,resolutionScale:i=1,width:r=G.AUTO_SIZE,height:n=G.AUTO_SIZE,resolutionX:a=r,resolutionY:o=n}={}){super("LuminancePass"),this.fullscreenMaterial=new nn(s,t),this.needsSwap=!1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const u=this.resolution=new G(this,a,o,i);u.addEventListener("change",l=>this.setSize(u.baseWidth,u.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,s,i,r){const n=this.fullscreenMaterial;n.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height)}initialize(e,t,s){s!==void 0&&s!==re&&(this.renderTarget.texture.type=s,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},on=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,ln="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",un=class extends ae{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new w(null),texelSize:new w(new C)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:on,vertexShader:ln})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},cn=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,hn="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",fn=class extends ae{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new w(null),supportBuffer:new w(null),texelSize:new w(new C),radius:new w(.85)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:cn,vertexShader:hn})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},dn=class extends k{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new un,this.upsamplingMaterial=new fn,this.resolution=new C}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let s=0;s<e;++s){const i=t.clone();i.texture.name="Downsampling.Mipmap"+s,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(let s=1,i=e-1;s<i;++s){const r=t.clone();r.texture.name="Upsampling.Mipmap"+s,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,s,i,r){const{scene:n,camera:a}=this,{downsamplingMaterial:o,upsamplingMaterial:u}=this,{downsamplingMipmaps:l,upsamplingMipmaps:h}=this;let c=t;this.fullscreenMaterial=o;for(let d=0,g=l.length;d<g;++d){const p=l[d];o.setSize(c.width,c.height),o.inputBuffer=c.texture,e.setRenderTarget(p),e.render(n,a),c=p}this.fullscreenMaterial=u;for(let d=h.length-1;d>=0;--d){const g=h[d];u.setSize(c.width,c.height),u.inputBuffer=c.texture,u.supportBuffer=l[d].texture,e.setRenderTarget(g),e.render(n,a),c=g}}setSize(e,t){const s=this.resolution;s.set(e,t);let i=s.width,r=s.height;for(let n=0,a=this.downsamplingMipmaps.length;n<a;++n)i=Math.round(i*.5),r=Math.round(r*.5),this.downsamplingMipmaps[n].setSize(i,r),n<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[n].setSize(i,r)}initialize(e,t,s){if(s!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of i)r.texture.type=s;if(s!==re)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(e!==null&&e.outputColorSpace===A)for(const r of i)r.texture.colorSpace=A}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},vn=class extends vt{constructor(e,t,{attributes:s=se.NONE,blendFunction:i=S.NORMAL,defines:r=new Map,uniforms:n=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=s,this.fragmentShader=t,this.vertexShader=o,this.defines=r,this.uniforms=n,this.extensions=a,this.blendMode=new Zr(i),this.blendMode.addEventListener("change",u=>this.setChanged()),this._inputColorSpace=Kt,this._outputColorSpace=jt}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=De){}update(e,t,s){}setSize(e,t){}initialize(e,t,s){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Q||t instanceof qt||t instanceof Yt||t instanceof k)&&this[e].dispose()}}},pn=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,mn=class extends vn{constructor({blendFunction:e=S.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:s=.025,mipmapBlur:i=!1,intensity:r=1,radius:n=.85,levels:a=8,kernelSize:o=Oe.LARGE,resolutionScale:u=.5,width:l=G.AUTO_SIZE,height:h=G.AUTO_SIZE,resolutionX:c=l,resolutionY:d=h}={}){super("BloomEffect",pn,{blendFunction:e,uniforms:new Map([["map",new w(null)],["intensity",new w(r)]])}),this.renderTarget=new Q(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new sn({kernelSize:o}),this.luminancePass=new an({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=s,this.mipmapBlurPass=new dn,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=n,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const g=this.resolution=new G(this,c,d,u);g.addEventListener("change",p=>this.setSize(g.baseWidth,g.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,s){const i=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,r.renderTarget):this.blurPass.render(e,r.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,i)}setSize(e,t){const s=this.resolution;s.setBaseSize(e,t),this.renderTarget.setSize(s.width,s.height),this.blurPass.resolution.copy(s),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,s){this.blurPass.initialize(e,t,s),this.luminancePass.initialize(e,t,s),this.mipmapBlurPass.initialize(e,t,s),s!==void 0&&(this.renderTarget.texture.type=s,e!==null&&e.outputColorSpace===A&&(this.renderTarget.texture.colorSpace=A))}},gn=class extends k{constructor(e,t,s=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new ls,this.overrideMaterialManager=s===null?null:new Lt(s),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new Lt(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,s,i,r){const n=this.scene,a=this.camera,o=this.selection,u=a.layers.mask,l=n.background,h=e.shadowMap.autoUpdate,c=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(n.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(c),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,n,a):e.render(n,a),a.layers.mask=u,n.background=l,e.shadowMap.autoUpdate=h}},Sn=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,_n="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",xn=class extends ae{constructor(e,t,s,i,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Xt.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new w(null),depthBuffer:new w(null),resolution:new w(new C),texelSize:new w(new C),cameraNear:new w(.3),cameraFar:new w(1e3),aspect:new w(1),time:new w(0)},blending:de,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),e&&this.setShaderParts(e),t&&this.setDefines(t),s&&this.setUniforms(s),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=De){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=Sn.replace(_.FRAGMENT_HEAD,e.get(_.FRAGMENT_HEAD)||"").replace(_.FRAGMENT_MAIN_UV,e.get(_.FRAGMENT_MAIN_UV)||"").replace(_.FRAGMENT_MAIN_IMAGE,e.get(_.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=_n.replace(_.VERTEX_HEAD,e.get(_.VERTEX_HEAD)||"").replace(_.VERTEX_MAIN_SUPPORT,e.get(_.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Qs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const s=this.uniforms;s.resolution.value.set(e,t),s.texelSize.value.set(1/e,1/t),s.aspect.value=e/t}static get Section(){return _}};function Ft(e,t,s){for(const i of t){const r="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),n=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const a of s.entries())a[1]!==null&&s.set(a[0],a[1].replace(n,r))}}function yn(e,t,s){let i=t.getFragmentShader(),r=t.getVertexShader();const n=i!==void 0&&/mainImage/.test(i),a=i!==void 0&&/mainUv/.test(i);if(s.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(a&&s.attributes&se.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!n&&!a)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const o=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,u=s.shaderParts;let l=u.get(_.FRAGMENT_HEAD)||"",h=u.get(_.FRAGMENT_MAIN_UV)||"",c=u.get(_.FRAGMENT_MAIN_IMAGE)||"",d=u.get(_.VERTEX_HEAD)||"",g=u.get(_.VERTEX_MAIN_SUPPORT)||"";const p=new Set,f=new Set;if(a&&(h+=`	${e}MainUv(UV);
`,s.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const v=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);g+=`	${e}MainSupport(`,g+=v?`vUv);
`:`);
`;for(const y of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const T of y[1].split(/\s*,\s*/))s.varyings.add(T),p.add(T),f.add(T);for(const y of r.matchAll(o))f.add(y[1])}for(const v of i.matchAll(o))f.add(v[1]);for(const v of t.defines.keys())f.add(v.replace(/\([\w\s,]*\)/g,""));for(const v of t.uniforms.keys())f.add(v);f.delete("while"),f.delete("for"),f.delete("if"),t.uniforms.forEach((v,y)=>s.uniforms.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>s.defines.set(e+y.charAt(0).toUpperCase()+y.slice(1),v));const x=new Map([["fragment",i],["vertex",r]]);Ft(e,f,s.defines),Ft(e,f,x),i=x.get("fragment"),r=x.get("vertex");const m=t.blendMode;if(s.blendModes.set(m.blendFunction,m),n){t.inputColorSpace!==null&&t.inputColorSpace!==s.colorSpace&&(c+=t.inputColorSpace===A?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==jt?s.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(s.colorSpace=t.inputColorSpace);const v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;c+=`${e}MainImage(color0, UV, `,s.attributes&se.DEPTH&&v.test(i)&&(c+="depth, ",s.readDepth=!0),c+=`color1);
	`;const y=e+"BlendOpacity";s.uniforms.set(y,m.opacity),c+=`color0 = blend${m.blendFunction}(color0, color1, ${y});

	`,l+=`uniform float ${y};

`}if(l+=i+`
`,r!==null&&(d+=r+`
`),u.set(_.FRAGMENT_HEAD,l),u.set(_.FRAGMENT_MAIN_UV,h),u.set(_.FRAGMENT_MAIN_IMAGE,c),u.set(_.VERTEX_HEAD,d),u.set(_.VERTEX_MAIN_SUPPORT,g),t.extensions!==null)for(const v of t.extensions)s.extensions.add(v)}}var Tn=class extends k{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new xn(null,null,null,e),this.listener=s=>this.handleEvent(s),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,s)=>s.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new gr;let t=0;for(const a of this.effects)if(a.blendMode.blendFunction===S.DST)e.attributes|=a.getAttributes()&se.DEPTH;else{if(e.attributes&a.getAttributes()&se.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);yn("e"+t++,a,e)}let s=e.shaderParts.get(_.FRAGMENT_HEAD),i=e.shaderParts.get(_.FRAGMENT_MAIN_IMAGE),r=e.shaderParts.get(_.FRAGMENT_MAIN_UV);const n=/\bblend\b/g;for(const a of e.blendModes.values())s+=a.getShaderCode().replace(n,`blend${a.blendFunction}`)+`
`;e.attributes&se.DEPTH?(e.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===A&&(i+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(_.FRAGMENT_HEAD,s),e.shaderParts.set(_.FRAGMENT_MAIN_IMAGE,i),e.shaderParts.set(_.FRAGMENT_MAIN_UV,r);for(const[a,o]of e.shaderParts)o!==null&&e.shaderParts.set(a,o.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=De){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const s of this.effects)s.setDepthTexture(e,t)}render(e,t,s,i,r){for(const n of this.effects)n.update(e,t,i);if(!this.skipRendering||this.renderToScreen){const n=this.fullscreenMaterial;n.inputBuffer=t.texture,n.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:s),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const s of this.effects)s.setSize(e,t)}initialize(e,t,s){this.renderer=e;for(const i of this.effects)i.initialize(e,t,s);this.updateMaterial(),s!==void 0&&s!==re&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}};function En(e,t){N(t,!0);const s=ei(),i=()=>Rt(o,"$camera",s),r=()=>Rt(u,"$size",s),{scene:n,renderer:a,camera:o,size:u,autoRender:l,renderStage:h}=dt(),c=new mr(a);le(()=>{c.removeAllPasses(),c.addPass(new gn(n,i())),c.addPass(new Tn(i(),new mn({intensity:.8,luminanceThreshold:.15,height:1024,width:1024,luminanceSmoothing:.5,mipmapBlur:!0,kernelSize:Oe.MEDIUM})))}),le(()=>{const d=r().width*window.devicePixelRatio,g=r().height*window.devicePixelRatio;c.setSize(d,g)}),le(()=>{const d=l.current;return l.set(!1),()=>l.set(d)}),$t(d=>{c.render(d)},{stage:h,autoInvalidate:!1}),L()}var bn=I("<!> <!>",1),wn=I("<!> <!>",1);function Mn(e,t){N(t,!0);var s=wn(),i=R(s);En(i,{});var r=D(i,2);ar(r,{children:(n,a)=>{var o=bn(),u=R(o);lr(u,{});var l=D(u,2);ie(l,()=>t.children),M(n,o)},$$slots:{default:!0}}),M(e,s),L()}var Rn=I("<img>");function Bn(e,t){let s=_e(t,["$$slots","$$events","$$legacy"]);var i=Rn();let r;Ue(()=>r=mi(i,r,{...s,src:"zestyplus.png"})),gi(i),Ps(i),M(e,i)}var Un=()=>mt("/lines"),An=()=>mt("/about"),zn=I('<div class="absolute left-0 top-0 flex h-screen w-screen flex-col items-center justify-center"><!> <div class="flex gap-2"><button class="flex items-center gap-1 bg-slate-600 px-3 py-1 text-white"><span class="text-xs">get zesty</span> 🤌</button> <button class="flex items-center gap-1 bg-slate-600 px-3 py-1 text-white"><span class="text-xs">what the zest?</span> 🧐</button></div></div>'),Cn=I("<!> <!> <!> <!>",1),Pn=I('<div class="absolute left-0 top-0 h-screen w-screen"><!></div> <!>',1);function In(e,t){N(t,!0);const{startAnalyser:s}=si();le(()=>{Ni(),s()});var i=Pn(),r=R(i),n=O(r);Ai(n,{children:(l,h)=>{var c=H(),d=R(c);{var g=p=>{Mn(p,{children:(f,x)=>{var m=H(),v=R(m);ie(v,()=>t.children),M(f,m)},$$slots:{default:!0}})};Y(d,p=>{p(g,!1)})}M(l,c)},$$slots:{default:!0}}),P(r);var a=D(r,2);{var o=l=>{var h=zn(),c=O(h);Bn(c,{class:"w-1/2"});var d=D(c,2),g=O(d);g.__click=[Un];var p=D(g,2);p.__click=[An],P(d),P(h),M(l,h)},u=l=>{var h=Cn(),c=R(h);Li(c,{});var d=D(c,2);tr(d,{});var g=D(d,2);er(g,{});var p=D(g,2);ji(p,{}),M(l,h)};Y(a,l=>{Zt.route.id==="/"?l(o):l(u,!1)})}M(e,i),L()}Ie(["click"]);const Dn=Object.freeze(Object.defineProperty({__proto__:null,default:In},Symbol.toStringTag,{value:"Module"}));export{In as component,wi as universal};
