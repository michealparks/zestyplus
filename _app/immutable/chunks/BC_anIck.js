import{d as p,b as S,s as C}from"./Wk8iZnnz.js";import{c as y,o as w}from"./C5lbjxb5.js";const d={CostcoMode:"c",Wikipedia:"w",Debug:"d",QRCode:"q",Settings:"s",TrackInfo:"t",Fullscreen:"f",PreviousPage:"arrowleft",NextPage:"arrowright"},g=new Map,T=()=>{const e=t=>{const s=t.key.toLowerCase();g.get(s)?.()};p(()=>(window.addEventListener("keydown",e,{passive:!0}),()=>{window.addEventListener("keydown",e)}))},f=(e,t)=>{p(()=>(g.set(e,t),()=>g.delete(e)))},b=typeof window<"u"?window:void 0;function I(e){let t=e.activeElement;for(;t?.shadowRoot;){const s=t.shadowRoot.activeElement;if(s===t)break;t=s}return t}class E{#t;#e;constructor(t={}){const{window:s=b,document:i=s?.document}=t;s!==void 0&&(this.#t=i,this.#e=y(r=>{const n=w(s,"focusin",r),h=w(s,"focusout",r);return()=>{n(),h()}}))}get current(){return this.#e?.(),this.#t?I(this.#t):null}}new E;function x(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}function m(e,t,s,i,r,n){if(e===null||typeof e!="object")return e;const h=Object.getPrototypeOf(e);if(h!==null&&h!==Object.prototype&&!Array.isArray(e))return e;let o=s.get(e);return o||(o=new Proxy(e,{get:(c,a)=>(i?.(),m(Reflect.get(c,a),t,s,i,r,n)),set:(c,a,l)=>(r?.(),Reflect.set(c,a,l),n(t),!0)}),s.set(e,o)),o}class u{#t;#e;#a;#i;#o;#r;#w=new WeakMap;#s;#n;#u;#d;#f;constructor(t,s,i={}){const{storage:r="local",serializer:n={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:h=!0,connected:o=!0}=i,c="window"in i?i.window:b;if(this.#t=s,this.#e=t,this.#a=n,this.#s=o,this.#u=c,this.#d=h,this.#f=r,c===void 0)return;const a=x(r,c);this.#i=a;const l=a.getItem(t);l!==null?this.#t=this.#c(l):o&&this.#h(s),this.#l()}get current(){this.#o?.();let t;if(this.#s){const s=this.#i?.getItem(this.#e);t=s?this.#c(s):this.#t}else t=this.#t;return m(t,t,this.#w,this.#o?.bind(this),this.#r?.bind(this),this.#h.bind(this))}set current(t){this.#h(t),this.#r?.()}#g=t=>{t.key!==this.#e||t.newValue===null||(this.#t=this.#c(t.newValue),this.#r?.())};#c(t){try{return this.#a.deserialize(t)}catch(s){console.error(`Error when parsing "${t}" from persisted store "${this.#e}"`,s);return}}#h(t){if(!this.#s){this.#t=t;return}try{t!==void 0&&this.#i?.setItem(this.#e,this.#a.serialize(t))}catch(s){console.error(`Error when writing value from persisted store "${this.#e}" to ${this.#i}`,s)}}#l(){!this.#u||!this.#s||(this.#o=y(t=>(this.#r=t,this.#n=this.#s&&this.#d&&this.#f==="local"?w(this.#u,"storage",this.#g):void 0,()=>{this.#n?.(),this.#n=void 0,this.#r=void 0})))}#p(){this.#n?.(),this.#n=void 0,this.#o=void 0}get connected(){return this.#s}disconnect(){if(!this.#s)return;const t=this.#i?.getItem(this.#e);t&&(this.#t=this.#c(t)),this.#s=!1,this.#i?.removeItem(this.#e),this.#p()}connect(){this.#s||(this.#s=!0,this.#h(this.#t),this.#l())}}const k=Symbol("settings-context"),O=()=>{const e=new u("trackinfo-visible",!0),t=new u("show-playlist-qr-code",!1),s=new u("show-facts",!1),i=new u("show-debug",!1),r=new u("show-costco",!1),n=new u("show-wikipedia",!1);f(d.QRCode,()=>{t.current=!t.current}),f(d.TrackInfo,()=>e.current=!e.current),f(d.CostcoMode,()=>r.current=!r.current),f(d.Debug,()=>i.current=!i.current),f(d.Wikipedia,()=>n.current=!n.current),C(k,{showTrackInfo:e,showQR:t,showFacts:s,showDebug:i,showCostco:r,showWikipedia:n})},P=()=>S(k);export{d as K,O as a,P as b,b as d,T as p,f as u};
