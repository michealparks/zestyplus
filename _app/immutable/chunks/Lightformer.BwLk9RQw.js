import"./disclose-version.Bg9kRutz.js";import"./legacy.CtaTdtmd.js";import{d as pt,p as qt,k as H,f as B,a as Rt,$ as K,m as Gt,s as $,u as tt,a3 as Et,a2 as It,as as Xt}from"./index-client.D_7LkImg.js";import{a as N,t as at,c as At}from"./template.AcjnxTEE.js";import{i as xt}from"./if.DtYMiTuA.js";import{Z as te,V as h,v as ee,Q as D,_ as ne,X as Wt,$ as St,q as Ut,a0 as ie,d as T,a1 as E,m as Qt,F as Yt,M as a,a2 as ut,a3 as R,a4 as oe,a5 as et,a6 as se,D as Bt,a7 as ae,a8 as re,k as Tt,u as Nt,a9 as le,e as ce,o as he,T as L,s as Vt,c as pe,aa as Zt,G as ue}from"./T.po24HVTg.js";import"./index.TNnlVa_5.js";import{b as Jt,p as O,c as Kt,a as dt,s as Ht,r as de}from"./props.BhoiTsxR.js";import{u as me}from"./useEnvironment.svelte.DKnT4xFR.js";import{w as Ct}from"./index.7ttzKC12.js";import{u as fe}from"./useControlsContext.B6ZDUX2E.js";const W=new te,S=new h,G=new h,u=new D,zt={X:new h(1,0,0),Y:new h(0,1,0),Z:new h(0,0,1)},bt={type:"change"},jt={type:"mouseDown",mode:null},Dt={type:"mouseUp",mode:null},Lt={type:"objectChange"};class we extends ee{constructor(e,n=null){super(void 0,n);const o=new Pe(this);this._root=o;const i=new xe;this._gizmo=i,o.add(i);const r=new Se;this._plane=r,o.add(r);const t=this;function s(m,_){let f=_;Object.defineProperty(t,m,{get:function(){return f!==void 0?f:_},set:function(v){f!==v&&(f=v,r[m]=v,i[m]=v,t.dispatchEvent({type:m+"-changed",value:v}),t.dispatchEvent(bt))}}),t[m]=_,r[m]=_,i[m]=_}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0),s("minX",-1/0),s("maxX",1/0),s("minY",-1/0),s("maxY",1/0),s("minZ",-1/0),s("maxZ",1/0);const d=new h,Z=new h,I=new D,M=new D,X=new h,z=new D,x=new h,w=new h,b=new h,g=0,y=new h;s("worldPosition",d),s("worldPositionStart",Z),s("worldQuaternion",I),s("worldQuaternionStart",M),s("cameraPosition",X),s("cameraQuaternion",z),s("pointStart",x),s("pointEnd",w),s("rotationAxis",b),s("rotationAngle",g),s("eye",y),this._offset=new h,this._startNorm=new h,this._endNorm=new h,this._cameraScale=new h,this._parentPosition=new h,this._parentQuaternion=new D,this._parentQuaternionInv=new D,this._parentScale=new h,this._worldScaleStart=new h,this._worldQuaternionInv=new D,this._worldScale=new h,this._positionStart=new h,this._quaternionStart=new D,this._scaleStart=new h,this._getPointer=ye.bind(this),this._onPointerDown=be.bind(this),this._onPointerHover=_e.bind(this),this._onPointerMove=ge.bind(this),this._onPointerUp=ve.bind(this),n!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&W.setFromCamera(e,this.camera);const n=gt(this._gizmo.picker[this.mode],W);n?this.axis=n.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&W.setFromCamera(e,this.camera);const n=gt(this._plane,W,!0);n&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(n.point).sub(this.worldPositionStart)),this.dragging=!0,jt.mode=this.mode,this.dispatchEvent(jt)}}pointerMove(e){const n=this.axis,o=this.mode,i=this.object;let r=this.space;if(o==="scale"?r="local":(n==="E"||n==="XYZE"||n==="XYZ")&&(r="world"),i===void 0||n===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&W.setFromCamera(e,this.camera);const t=gt(this._plane,W,!0);if(t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),o==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&n!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),n.indexOf("X")===-1&&(this._offset.x=0),n.indexOf("Y")===-1&&(this._offset.y=0),n.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&n!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(u.copy(this._quaternionStart).invert()),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(S.setFromMatrixPosition(i.parent.matrixWorld)),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(S.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if(o==="scale"){if(n.search("XYZ")!==-1){let s=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(s*=-1),G.set(s,s,s)}else S.copy(this.pointStart),G.copy(this.pointEnd),S.applyQuaternion(this._worldQuaternionInv),G.applyQuaternion(this._worldQuaternionInv),G.divide(S),n.search("X")===-1&&(G.x=1),n.search("Y")===-1&&(G.y=1),n.search("Z")===-1&&(G.z=1);i.scale.copy(this._scaleStart).multiply(G),this.scaleSnap&&(n.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const s=20/this.worldPosition.distanceTo(S.setFromMatrixPosition(this.camera.matrixWorld));let d=!1;n==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(S.copy(this.rotationAxis).cross(this.eye))*s):(n==="X"||n==="Y"||n==="Z")&&(this.rotationAxis.copy(zt[n]),S.copy(zt[n]),r==="local"&&S.applyQuaternion(this.worldQuaternion),S.cross(this.eye),S.length()===0?d=!0:this.rotationAngle=this._offset.dot(S.normalize())*s),(n==="E"||d)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&n!=="E"&&n!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(u.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(u.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(bt),this.dispatchEvent(Lt)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Dt.mode=this.mode,this.dispatchEvent(Dt)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(bt),this.dispatchEvent(Lt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return W}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function ye(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function _e(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function be(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function ge(l){this.enabled&&this.pointerMove(this._getPointer(l))}function ve(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function gt(l,e,n){const o=e.intersectObject(l,!0);for(let i=0;i<o.length;i++)if(o[i].object.visible||n)return o[i];return!1}const mt=new ne,p=new h(0,1,0),Ot=new h(0,0,0),kt=new Wt,ft=new D,yt=new D,j=new h,Ft=new Wt,ot=new h(1,0,0),U=new h(0,1,0),st=new h(0,0,1),wt=new h,nt=new h,it=new h;class Pe extends St{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const n=this.controls;n.object!==void 0&&(n.object.updateMatrixWorld(),n.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):n.object.parent.matrixWorld.decompose(n._parentPosition,n._parentQuaternion,n._parentScale),n.object.matrixWorld.decompose(n.worldPosition,n.worldQuaternion,n._worldScale),n._parentQuaternionInv.copy(n._parentQuaternion).invert(),n._worldQuaternionInv.copy(n.worldQuaternion).invert()),n.camera.updateMatrixWorld(),n.camera.matrixWorld.decompose(n.cameraPosition,n.cameraQuaternion,n._cameraScale),n.camera.isOrthographicCamera?n.camera.getWorldDirection(n.eye).negate():n.eye.copy(n.cameraPosition).sub(n.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class xe extends St{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Ut({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=new ie({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=e.clone();o.opacity=.15;const i=n.clone();i.opacity=.5;const r=e.clone();r.color.setHex(16711680);const t=e.clone();t.color.setHex(65280);const s=e.clone();s.color.setHex(255);const d=e.clone();d.color.setHex(16711680),d.opacity=.5;const Z=e.clone();Z.color.setHex(65280),Z.opacity=.5;const I=e.clone();I.color.setHex(255),I.opacity=.5;const M=e.clone();M.opacity=.25;const X=e.clone();X.color.setHex(16776960),X.opacity=.25,e.clone().color.setHex(16776960);const x=e.clone();x.color.setHex(7895160);const w=new T(0,.04,.1,12);w.translate(0,.05,0);const b=new E(.08,.08,.08);b.translate(0,.04,0);const g=new Qt;g.setAttribute("position",new Yt([0,0,0,1,0,0],3));const y=new T(.0075,.0075,.5,3);y.translate(0,.25,0);function m(A,F){const Q=new et(A,.0075,3,64,F*Math.PI*2);return Q.rotateY(Math.PI/2),Q.rotateX(Math.PI/2),Q}function _(){const A=new Qt;return A.setAttribute("position",new Yt([0,0,0,1,1,1],3)),A}const f={X:[[new a(w,r),[.5,0,0],[0,0,-Math.PI/2]],[new a(w,r),[-.5,0,0],[0,0,Math.PI/2]],[new a(y,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new a(w,t),[0,.5,0]],[new a(w,t),[0,-.5,0],[Math.PI,0,0]],[new a(y,t)]],Z:[[new a(w,s),[0,0,.5],[Math.PI/2,0,0]],[new a(w,s),[0,0,-.5],[-Math.PI/2,0,0]],[new a(y,s),null,[Math.PI/2,0,0]]],XYZ:[[new a(new ut(.1,0),M.clone()),[0,0,0]]],XY:[[new a(new E(.15,.15,.01),I.clone()),[.15,.15,0]]],YZ:[[new a(new E(.15,.15,.01),d.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new E(.15,.15,.01),Z.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new a(new T(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new a(new T(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new a(new T(.2,0,.6,4),o),[0,.3,0]],[new a(new T(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new a(new T(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new a(new T(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new a(new ut(.2,0),o)]],XY:[[new a(new E(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new a(new E(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new E(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},V={START:[[new a(new ut(.01,2),i),null,null,null,"helper"]],END:[[new a(new ut(.01,2),i),null,null,null,"helper"]],DELTA:[[new R(_(),i),null,null,null,"helper"]],X:[[new R(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new R(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new R(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},J={XYZE:[[new a(m(.5,1),x),null,[0,Math.PI/2,0]]],X:[[new a(m(.5,.5),r)]],Y:[[new a(m(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new a(m(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new a(m(.75,1),X),null,[0,Math.PI/2,0]]]},rt={AXIS:[[new R(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},_t={XYZE:[[new a(new oe(.25,10,8),o)]],X:[[new a(new et(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new a(new et(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new a(new et(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new a(new et(.75,.1,2,24),o)]]},c={X:[[new a(b,r),[.5,0,0],[0,0,-Math.PI/2]],[new a(y,r),[0,0,0],[0,0,-Math.PI/2]],[new a(b,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new a(b,t),[0,.5,0]],[new a(y,t)],[new a(b,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new a(b,s),[0,0,.5],[Math.PI/2,0,0]],[new a(y,s),[0,0,0],[Math.PI/2,0,0]],[new a(b,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new a(new E(.15,.15,.01),I),[.15,.15,0]]],YZ:[[new a(new E(.15,.15,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new E(.15,.15,.01),Z),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new a(new E(.1,.1,.1),M.clone())]]},P={X:[[new a(new T(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new a(new T(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new a(new T(.2,0,.6,4),o),[0,.3,0]],[new a(new T(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new a(new T(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new a(new T(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new a(new E(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new a(new E(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new E(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new a(new E(.2,.2,.2),o),[0,0,0]]]},k={X:[[new R(g,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new R(g,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new R(g,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(A){const F=new St;for(const Q in A)for(let q=A[Q].length;q--;){const Y=A[Q][q][0].clone(),lt=A[Q][q][1],ct=A[Q][q][2],ht=A[Q][q][3],$t=A[Q][q][4];Y.name=Q,Y.tag=$t,lt&&Y.position.set(lt[0],lt[1],lt[2]),ct&&Y.rotation.set(ct[0],ct[1],ct[2]),ht&&Y.scale.set(ht[0],ht[1],ht[2]),Y.updateMatrix();const Mt=Y.geometry.clone();Mt.applyMatrix4(Y.matrix),Y.geometry=Mt,Y.renderOrder=1/0,Y.position.set(0,0,0),Y.rotation.set(0,0,0),Y.scale.set(1,1,1),F.add(Y)}return F}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(f)),this.add(this.gizmo.rotate=C(J)),this.add(this.gizmo.scale=C(c)),this.add(this.picker.translate=C(v)),this.add(this.picker.rotate=C(_t)),this.add(this.picker.scale=C(P)),this.add(this.helper.translate=C(V)),this.add(this.helper.rotate=C(rt)),this.add(this.helper.scale=C(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const o=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:yt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const t=i[r];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let s;if(this.camera.isOrthographicCamera?s=(this.camera.top-this.camera.bottom)/this.camera.zoom:s=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(s*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.visible=!!this.axis,this.axis==="X"&&(u.setFromEuler(mt.set(0,0,0)),t.quaternion.copy(o).multiply(u),Math.abs(p.copy(ot).applyQuaternion(o).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(u.setFromEuler(mt.set(0,0,Math.PI/2)),t.quaternion.copy(o).multiply(u),Math.abs(p.copy(U).applyQuaternion(o).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(u.setFromEuler(mt.set(0,Math.PI/2,0)),t.quaternion.copy(o).multiply(u),Math.abs(p.copy(st).applyQuaternion(o).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(u.setFromEuler(mt.set(0,Math.PI/2,0)),p.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(kt.lookAt(Ot,p,U)),t.quaternion.multiply(u),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),S.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),S.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(S),t.visible=this.dragging):(t.quaternion.copy(o),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(o),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(p.copy(ot).applyQuaternion(o).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(p.copy(U).applyQuaternion(o).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(p.copy(st).applyQuaternion(o).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(p.copy(st).applyQuaternion(o).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(p.copy(ot).applyQuaternion(o).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(p.copy(U).applyQuaternion(o).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&(ft.copy(o),p.copy(this.eye).applyQuaternion(u.copy(o).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(kt.lookAt(this.eye,Ot,U)),t.name==="X"&&(u.setFromAxisAngle(ot,Math.atan2(-p.y,p.z)),u.multiplyQuaternions(ft,u),t.quaternion.copy(u)),t.name==="Y"&&(u.setFromAxisAngle(U,Math.atan2(p.x,p.z)),u.multiplyQuaternions(ft,u),t.quaternion.copy(u)),t.name==="Z"&&(u.setFromAxisAngle(st,Math.atan2(p.y,p.x)),u.multiplyQuaternions(ft,u),t.quaternion.copy(u))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(d){return t.name===d}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(e)}}class Se extends a{constructor(){super(new se(1e5,1e5,2,2),new Ut({visible:!1,wireframe:!0,side:Bt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let n=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(n="local"),wt.copy(ot).applyQuaternion(n==="local"?this.worldQuaternion:yt),nt.copy(U).applyQuaternion(n==="local"?this.worldQuaternion:yt),it.copy(st).applyQuaternion(n==="local"?this.worldQuaternion:yt),p.copy(nt),this.mode){case"translate":case"scale":switch(this.axis){case"X":p.copy(this.eye).cross(wt),j.copy(wt).cross(p);break;case"Y":p.copy(this.eye).cross(nt),j.copy(nt).cross(p);break;case"Z":p.copy(this.eye).cross(it),j.copy(it).cross(p);break;case"XY":j.copy(it);break;case"YZ":j.copy(wt);break;case"XZ":p.copy(it),j.copy(nt);break;case"XYZ":case"E":j.set(0,0,0);break}break;case"rotate":default:j.set(0,0,0)}j.length()===0?this.quaternion.copy(this.cameraQuaternion):(Ft.lookAt(S.set(0,0,0),j,p),this.quaternion.setFromRotationMatrix(Ft)),super.updateMatrixWorld(e)}}const Me=1,vt=1e3,Ee=256,Ie=(l=()=>vt,e=()=>vt,n=()=>Ee)=>{const o=new ae(n()),i=new re(Me,vt,o);return pt(()=>{const r=n();o.setSize(r,r)}),pt(()=>{const r=l();for(const t of i.children)Tt(t,"PerspectiveCamera")&&(t.near=r,t.updateProjectionMatrix())}),pt(()=>{const r=e();for(const t of i.children)Tt(t,"PerspectiveCamera")&&(t.far=r,t.updateProjectionMatrix())}),pt(()=>()=>{o.dispose()}),{camera:i,renderTarget:o}};var Xe=at("<!> <!>",1);function Ae(l,e){qt(e,!0);const n=Jt(),o=()=>Kt(g,"$started",n),i=Nt();let r=O(e,"far",3,1e3),t=O(e,"frames",3,1/0),s=O(e,"near",3,.1),d=O(e,"resolution",3,256),Z=O(e,"scene",19,()=>i.scene);const{scene:I}=le(),{camera:M,renderTarget:X}=Ie(()=>s(),()=>r(),()=>d());me({texture:X.texture,get scene(){return Z()},get isBackground(){return e.isBackground}});const z=()=>{M.update(i.renderer,I)};let x=0;const{start:w,stop:b,started:g}=ce(()=>{var _;x<t()?(z(),x+=1):(b(),(_=e.onupdatestop)==null||_.call(e))},{autoStart:!1}),y=()=>{var _,f;o()&&(b(),(_=e.onupdatestop)==null||_.call(e)),x=0,w(),(f=e.onupdatestart)==null||f.call(e)};he(()=>[r(),s(),t(),d()],y);var m=Gt(()=>e.visible?void 0:!1);return L(l,{is:I,get attach(){return H(m)},children:(_,f)=>{var v=Xe(),V=B(v);L(V,{is:M});var J=$(V,2);Vt(J,()=>e.children??K,()=>({camera:M,renderTarget:X,restart:y,update:z})),N(_,v)},$$slots:{default:!0}}),Rt({camera:M,renderTarget:X,update:z,restart:y})}var Qe=at("<!> <!>",1);function Ye(l,e){qt(e,!0);const n=Jt(),o=()=>Kt(Z,"$camera",n);let i=O(e,"autoPauseOrbitControls",3,!0),r=O(e,"autoPauseTrackballControls",3,!0),t=O(e,"controls",15),s=O(e,"group",15),d=de(e,["$$slots","$$events","$$legacy","autoPauseOrbitControls","autoPauseTrackballControls","object","controls","group","children"]);const{camera:Z,dom:I,invalidate:M,scene:X}=Nt(),{orbitControls:z,trackballControls:x}=fe(),w=pe(!1),b=Ct(i()??!0);tt(()=>b.set(i()??!0));const g=Ct(r()??!0);tt(()=>g.set(r()??!0)),Zt([z,w,b],([c,P,k])=>{if(!(!c||!c.enabled&&P))return c.enabled=!(P&&k),()=>{c.enabled=!0}}),Zt([x,w,g],([c,P,k])=>{if(!(!c||!c.enabled&&P))return c.enabled=!(P&&k),()=>{c.enabled=!0}});const y=new ue;let m=Gt(()=>new we(o(),I));tt(()=>{var c;return(c=H(m))==null||c.attach(e.object??y),()=>{var P;return(P=H(m))==null?void 0:P.detach()}});const _=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ","visible","onmouseDown","onmouseUp","onobjectChange"];let f=Et(dt({})),v=Et(dt({}));tt(()=>{It(f,dt({})),It(v,dt({})),Object.keys(d).forEach(c=>{tt(()=>{_.includes(c)?H(f)[c]=d[c]:H(v)[c]=d[c]})})});const V=c=>{var P;M(),H(m).dragging&&!w.current?w.set(!0):!H(m).dragging&&w.current&&w.set(!1),(P=e.onchange)==null||P.call(e,c)};var J=Qe(),rt=B(J);L(rt,Ht({get is(){return H(m)},onchange:V},()=>H(f),{attach:({ref:c})=>{const P=c.getHelper();return X.add(P),()=>{X.remove(P)}},dispose:!1,oncreate:c=>()=>c.dispose(),get ref(){return t()},set ref(c){t(c)}}));var _t=$(rt,2);L(_t,Ht({is:y},()=>H(v),{get ref(){return s()},set ref(c){s(c)},children:(c,P)=>{var k=At(),C=B(k);{var A=F=>{var Q=At(),q=B(Q);Vt(q,()=>e.children,()=>({ref:y})),N(F,Q)};xt(C,F=>{e.children&&F(A)})}N(c,k)},$$slots:{default:!0}})),N(l,J),Rt()}const Pt=(l,e=K,n=K,o=K,i=K,r=K)=>{{const t=(s,d)=>{let Z=()=>d==null?void 0:d().ref;var I=Ze(),M=B(I);{var X=x=>{Ye(x,{get object(){return Z()}})};xt(M,x=>{r()&&x(X)})}var z=$(M,2);L.Mesh(z,{lookAt:[0,0,0],children:(x,w)=>{var b=Te(),g=B(b);{var y=f=>{var v=Xt(()=>[o()/2]);L.CircleGeometry(f,{get args(){return H(v)}})},m=f=>{var v=Xt(()=>[o(),o()]);L.PlaneGeometry(f,{get args(){return H(v)}})};xt(g,f=>{n()==="circle"?f(y):f(m,!1)})}var _=$(g,2);L.MeshBasicMaterial(_,{get color(){return e()},side:Bt}),N(x,b)},$$slots:{default:!0}}),N(s,I)};L.Group(l,{get position(){return i()},children:t,$$slots:{default:!0}})}};var Te=at("<!> <!>",1),Ze=at("<!> <!>",1),He=at("<!> <!> <!>",1);function We(l){let e=!1;Ae(l,{visible:e,children:(n,o)=>{var i=He(),r=B(i);Pt(r,()=>"#FF4F4F",()=>"plane",()=>20,()=>[0,0,-20],()=>e);var t=$(r,2);Pt(t,()=>"#FFD0CB",()=>"circle",()=>5,()=>[0,5,0],()=>e);var s=$(t,2);Pt(s,()=>"#2223FF",()=>"plane",()=>8,()=>[-3,0,4],()=>e),N(n,i)},$$slots:{default:!0}})}export{We as default};
