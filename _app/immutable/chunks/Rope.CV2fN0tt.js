import"./disclose-version.Bg9kRutz.js";import{ab as W,p as q,d as _,k as c,f as w,a as H,a5 as L,a6 as Q,m as b}from"./index-client.DzQlphmH.js";import{c as R,a as j}from"./template.CgCchT00.js";import{e as U,i as X}from"./each.C8O1i2N9.js";import{c as A}from"./svelte-component.D0WKzo0g.js";import{p,a as I}from"./props.DHXOHPV0.js";import{n as Z,V as f,u as $,N as tt,d as D}from"./T.D9_Xg1XW.js";import{c as et,Y as rt,i as nt}from"./createCollidersFromChildren.CGFyc-A4.js";import{d as st,g as ot,w as J}from"./index.DdXxZHS9.js";import{C as at}from"./Collider.CI68qLMK.js";const it=i=>{const t=J(void 0),u=J(void 0),l=et(),s=st([t,u],([e,r])=>{if(e&&r)return[e,r]}),m=J(void 0),d=s.subscribe(e=>{e&&m.set(i(...e,l))});return W(()=>{d();const e=ot(m);e&&(e instanceof rt?l.world.removeMultibodyJoint(e,!0):l.world.removeImpulseJoint(e,!0))}),{joint:m,rigidBodyA:t,rigidBodyB:u}},V=i=>Z(i,"Vector3"),dt=(i,t,u)=>it((l,s,{world:m,rapier:d})=>{const e=V(i)?i:new f(...i),r=V(t)?t:new f(...t),g=d.JointData.rope(u,e,r);return m.createImpulseJoint(g,l,s,!0)});function jt(i,t){q(t,!0);let u=p(t,"startRigidBody",15),l=p(t,"lastRigidBody",15),s=p(t,"positions",15),m=b(()=>t.length/(t.segments-1)),d=L(!1);const e=b(()=>Array.from({length:t.segments-1},()=>dt([0,0,0],[0,0,0],c(m))));s(new Float32Array(t.segments));const r=I([]);_(()=>{u(r.at(0)),l(r.at(-1))});const g=I([]),k=new f().fromArray(t.ropeStart),z=new f().fromArray(t.ropeEnd),E=o=>{const n=o/(t.segments-1);return k.clone().lerp(z,n)};_(()=>{r.length!==t.segments||g.length!==t.segments||c(d)||(c(e).forEach((o,n)=>{o.rigidBodyA.set(r[n]),o.rigidBodyB.set(r[n+1])}),Q(d,!0))}),I(Array.from({length:t.segments},()=>new f(0,0,0)));const y=new f;$(()=>{var o;if(c(d))for(let n=0,a=0,B=g.length;n<B;n+=1,a+=3)(o=g[n])==null||o.getWorldPosition(y),s(s()[a+0]=y.x,!0),s(s()[a+1]=y.y,!0),s(s()[a+2]=y.z,!0)}),tt(()=>[c(d),t.ropeStart,t.ropeEnd],([o])=>{var n;o&&((n=u())==null||n.setNextKinematicTranslation({x:t.ropeStart[0],y:t.ropeStart[1],z:t.ropeStart[2]}))});var P=R(),T=w(P);U(T,17,()=>({length:t.segments}),X,(o,n,a)=>{var B=R(),C=w(B);A(C,()=>D.Group,(N,O)=>{O(N,{oncreate:v=>{v.position.copy(E(a))},children:(v,ut)=>{nt(v,{get linearDamping(){return t.damping},get angularDamping(){return t.damping},type:a===0?"kinematicPosition":"dynamic",get rigidBody(){return r[a]},set rigidBody(h){r[a]=h},children:(h,lt)=>{var Y=b(()=>[t.ballRadius]);at(h,{shape:"ball",get args(){return c(Y)},children:(x,mt)=>{var S=R(),F=w(S);A(F,()=>D.Object3D,(G,K)=>{K(G,{get ref(){return g[a]},set ref(M){g[a]=M}})}),j(x,S)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),j(o,B)}),j(i,P),H()}export{jt as default};
