import{b as j,t as O,c as K}from"../chunks/disclose-version.CY5IDNoG.js";import{p as T,y as x,t as W,z as w,G as Q,w as l,ah as k,ai as P,F as N}from"../chunks/runtime.XPaRurxh.js";import{c as I}from"../chunks/svelte-component.De3lsk1i.js";import{p as L,c as B,b as dt,r as lt}from"../chunks/props.Dz65N0hT.js";import{m as gt,V as D,ao as ut,D as mt,a as z,T as R,B as Z,aT as ct,n as ft,at as ht,aO as yt,aX as vt,Y as bt,av as $,J as Bt}from"../chunks/T.y93Wq12a.js";import{e as Rt,i as pt}from"../chunks/each.BoW94gwA.js";import{c as nt,Y as _t,i as wt,W as At}from"../chunks/createCollidersFromChildren.DijvmNJY.js";import{a as st}from"../chunks/index-client.D5mbYn_g.js";import{d as St,g as kt,w as Y}from"../chunks/index.Bku8qPL5.js";import{C as rt}from"../chunks/Collider.BjQZ75VX.js";import"../chunks/index.Cv2FY5Xh.js";import{O as Pt}from"../chunks/OrbitControls.gSqUzVJP.js";import"../chunks/legacy.PQa5ncrZ.js";const It=m=>{const t=Y(void 0),a=Y(void 0),d=nt(),s=St([t,a],([e,o])=>{if(e&&o)return[e,o]}),i=Y(void 0),r=s.subscribe(e=>{e&&i.set(m(...e,d))});return st(()=>{r();const e=kt(i);e&&(e instanceof _t?d.world.removeMultibodyJoint(e,!0):d.world.removeImpulseJoint(e,!0))}),{joint:i,rigidBodyA:t,rigidBodyB:a}},tt=m=>gt(m,"Vector3"),Dt=(m,t,a)=>It((d,s,{world:i,rapier:r})=>{const e=tt(m)?m:new D(...m),o=tt(t)?t:new D(...t),g=r.JointData.rope(a,e,o);return i.createImpulseJoint(g,d,s,!0)});var jt=O("<!> <!>",1);function xt(m,t){T(t,!0);let a=L(t,"ref",27,()=>B(new ut)),d=lt(t,["$$slots","$$events","$$legacy","ref"]);const{world:s,debug:i}=nt(),r=new mt;i.set(!0),z(()=>{const e=s.debugRender(),o=new Z(e.vertices,3),g=new Z(e.colors,4);r.setAttribute("position",o),r.setAttribute("color",g)}),st(()=>{i.set(!1)}),R(m,dt({get is(){return a()},frustumCulled:!1,renderOrder:1/0},()=>d,{children:(e,o)=>{var g=jt(),p=x(g);R(p,{is:r});var S=w(p,2);I(S,()=>R.LineBasicMaterial,(c,h)=>{h(c,{vertexColors:!0})}),j(e,g)},$$slots:{default:!0}})),W()}function U(m,t){T(t,!0);let a=L(t,"startRigidBody",15),d=L(t,"lastRigidBody",15),s=L(t,"positions",15),i=N(()=>t.length/(t.segments-1)),r=k(!1);const e=N(()=>Array.from({length:t.segments-1},()=>Dt([0,0,0],[0,0,0],l(i))));s(new Float32Array(t.segments));const o=B([]);Q(()=>{a(o.at(0)),d(o.at(-1))});const g=B([]),p=new D().fromArray(t.ropeStart),S=new D().fromArray(t.ropeEnd),c=u=>{const y=u/(t.segments-1);return p.clone().lerp(S,y)};Q(()=>{o.length!==t.segments||g.length!==t.segments||l(r)||(l(e).forEach((u,y)=>{u.rigidBodyA.set(o[y]),u.rigidBodyB.set(o[y+1])}),P(r,!0))}),B(Array.from({length:t.segments},()=>new D(0,0,0)));const h=new D;z(()=>{var u;if(l(r))for(let y=0,n=0,v=g.length;y<v;y+=1,n+=3)(u=g[y])==null||u.getWorldPosition(h),s(s()[n+0]=h.x,!0),s(s()[n+1]=h.y,!0),s(s()[n+2]=h.z,!0)}),ct(()=>[l(r),t.ropeStart,t.ropeEnd],([u])=>{var y;u&&((y=a())==null||y.setNextKinematicTranslation({x:t.ropeStart[0],y:t.ropeStart[1],z:t.ropeStart[2]}))});var b=K(),A=x(b);Rt(A,17,()=>({length:t.segments}),pt,(u,y,n)=>{var v=K(),_=x(v);I(_,()=>R.Group,(C,E)=>{E(C,{oncreate:M=>{M.position.copy(c(n))},children:(M,G)=>{wt(M,{get linearDamping(){return t.damping},get angularDamping(){return t.damping},type:n===0?"kinematicPosition":"dynamic",get rigidBody(){return o[n]},set rigidBody(H){o[n]=H},children:(H,V)=>{var F=N(()=>[t.ballRadius]);rt(H,{shape:"ball",get args(){return l(F)},children:(f,X)=>{var J=K(),q=x(J);I(q,()=>R.Object3D,(ot,it)=>{it(ot,{get ref(){return g[n]},set ref(at){g[n]=at}})}),j(f,J)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),j(u,v)}),j(m,b),W()}const Mt=(m,t,a)=>{const d=[];let s=new $;d.push(s),s.position.y=-m;for(let i=0;i<t;i++){const r=new $;r.position.y=a,d.push(r),s.add(r),s=r}return d};var Ht=O("<!> <!>",1);function et(m,t){T(t,!0);const a=t.segmentHeight*t.segments,d=a*.5,s=Mt(d,t.segments,t.segmentHeight),i=new ft,r=new ht(s);i.add(s[0]),i.bind(r);const e=new yt(t.radius,t.radius,a,t.radialSegments,t.heightSegments,!0),o=[],g=[],{position:p}=e.attributes,S=new D;for(let c=0,h;c<p.count;c++){S.fromBufferAttribute(p,c);const b=S.y+d,A=Math.floor(b/t.segmentHeight),u=b%t.segmentHeight/t.segmentHeight;o.push(A,A+1,0,0),g.push(1-u,u,0,0)}e.setAttribute("skinIndex",new vt(o,4)),e.setAttribute("skinWeight",new bt(g,4)),z(()=>{if(t.positions!==void 0)for(let c=0,h=0,b=s.length;c<b;c+=1,h+=3)r.bones[c].position.set(t.positions[h+0],t.positions[h+1],t.positions[h+2]),r.bones[c].rotation.x=.2}),R(m,{is:i,children:(c,h)=>{var b=Ht(),A=x(b);R(A,{is:e});var u=w(A,2);I(u,()=>R.MeshStandardMaterial,(y,n)=>{n(y,{side:Bt})}),j(c,b)},$$slots:{default:!0}}),W()}var Ct=O("<!> <!> <!> <!> <!> <!> <!>",1),Et=O("<!> <!> <!> <!>",1);function Xt(m,t){T(t,!0);let a=20,d=5,s=2,i=B([0,4,1]),r=k(void 0),e=k(void 0),o=k(void 0),g=k(void 0),p=k(void 0),S=k(void 0),c=k(void 0);setInterval(()=>{var n;Math.random()>.2&&((n=l(o))==null||n.applyImpulse({x:(Math.random()-.5)*.1,y:.1,z:(Math.random()-.5)*.1},!0))},100),z(()=>{var v,_;if(l(o)===void 0)return;const n=l(o).translation();(v=l(g))==null||v.setNextKinematicTranslation(n),(_=l(p))==null||_.setNextKinematicTranslation(n)});var h=Et(),b=x(h);I(b,()=>R.AmbientLight,(n,v)=>{v(n,{})});var A=w(b,2);I(A,()=>R.DirectionalLight,(n,v)=>{v(n,{position:[10,10,10]})});var u=w(A,2);I(u,()=>R.PerspectiveCamera,(n,v)=>{v(n,{makeDefault:!0,position:[0,0,20],oncreate:_=>_.lookAt(0,0,0),children:(_,C)=>{Pt(_,{})},$$slots:{default:!0}})});var y=w(u,2);At(y,{gravity:[0,-1,0],children:(n,v)=>{var _=Ct(),C=x(_);xt(C,{});var E=w(C,2);U(E,{ballRadius:.1,ropeStart:[0,0,0],get ropeEnd(){return i},length:d,segments:a,damping:s,get positions(){return l(r)},set positions(f){P(r,B(f))},get lastRigidBody(){return l(o)},set lastRigidBody(f){P(o,B(f))}});var M=w(E,2);et(M,{radius:.3,segments:a,heightSegments:a*10,segmentHeight:d/a,get positions(){return l(r)}});var G=w(M,2);U(G,{ballRadius:.1,ropeStart:[0,0,0],get ropeEnd(){return i},length:3,segments:8,damping:s,get positions(){return l(e)},set positions(f){P(e,B(f))},get startRigidBody(){return l(g)},set startRigidBody(f){P(g,B(f))},get lastRigidBody(){return l(S)},set lastRigidBody(f){P(S,B(f))}});var H=w(G,2);et(H,{radius:.3,segments:8,heightSegments:8*10,segmentHeight:d/a,get positions(){return l(e)}});var V=w(H,2);U(V,{ballRadius:.1,ropeStart:[0,0,0],get ropeEnd(){return i},length:3,segments:8,damping:s,get startRigidBody(){return l(p)},set startRigidBody(f){P(p,B(f))},get lastRigidBody(){return l(c)},set lastRigidBody(f){P(c,B(f))}});var F=w(V,2);I(F,()=>R.Group,(f,X)=>{X(f,{position:[0,-2,0],children:(J,q)=>{rt(J,{type:"static",shape:"cuboid",args:[10,2,10]})},$$slots:{default:!0}})}),j(n,_)},$$slots:{default:!0}}),j(m,h),W()}export{Xt as component};
