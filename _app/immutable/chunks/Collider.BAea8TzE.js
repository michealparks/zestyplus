import"./disclose-version.Bg9kRutz.js";import{p as F,a9 as Q,aa as M,u as s,ab as O,f as L,a2 as z,a as E}from"./index-client.CAJtLLOW.js";import{c as V,a as j}from"./template.CuXd8n4y.js";import{O as S,V as l,Q as m,h as _,J as k,K as G,L as H,s as J}from"./T.Dho_lh33.js";import{p as K}from"./props.BHX9ZFdi.js";import{u as q,a as B,b as N,c as U,d as X,R as Y,o as Z,A as w,e as p,f as $,g as ee,h as te}from"./createCollidersFromChildren.DAmjNsIo.js";const ne=(i,e)=>{const t=Array.from(i);for(let o=0;o<i.length/3;o++)t[o*3]*=e.x,t[o*3+1]*=e.y,t[o*3+2]*=e.z;return t},oe=(i,e,t)=>{const o=e.slice();if(i==="heightfield")return o;if(i==="trimesh"||i==="convexHull")return o[0]=new Float32Array(ne(o[0],t)),o;const c=[t.x,t.y,t.z];return o.map((r,a)=>(c[a]??1)*r)};function ue(i,e){F(e,!0);let t=K(e,"collider",15);const o=new S,{updateRef:c}=q(e.oncreate),r=B(),a=N(),u=!!r,d=U(),{world:g}=d,C=X(),y={oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit};Q(async()=>{await M();const n=o.getWorldScale(new l),b=oe(e.shape,e.args,n),I=Y[e.shape](...b);if(t(g.createCollider(I,r)),t().setActiveCollisionTypes(Z.ALL),c(t()),d.addColliderToContext(t(),o,y),C.registerColliders([t()]),u){const h=new l,f=new m;a==null||a.getWorldPosition(h),a==null||a.getWorldQuaternion(f),f.invert();const T=o.getWorldPosition(new l).sub(h),D=o.getWorldQuaternion(new m).premultiply(f);t().setTranslationWrtParent(T),t().setRotationWrtParent(D)}else t().setTranslation(o.getWorldPosition(new l)),t().setRotation(o.getWorldQuaternion(new m))}),s(()=>{var n;(n=t())==null||n.setRestitution(e.restitution??0)}),s(()=>{var n;(n=t())==null||n.setRestitutionCombineRule(e.restitutionCombineRule??w.Average)}),s(()=>{var n;(n=t())==null||n.setFriction(e.friction??.7)}),s(()=>{var n;(n=t())==null||n.setFrictionCombineRule(e.frictionCombineRule??w.Average)}),s(()=>{var n;return(n=t())==null?void 0:n.setSensor(e.sensor??!1)}),s(()=>{var n;return(n=t())==null?void 0:n.setContactForceEventThreshold(e.contactForceEventThreshold??0)}),s(()=>{var n;e.density!==void 0&&((n=t())==null||n.setDensity(e.density))}),s(()=>{t()&&e.mass&&(e.centerOfMass&&e.principalAngularInertia&&e.angularInertiaLocalFrame?t().setMassProperties(e.mass,{x:e.centerOfMass[0],y:e.centerOfMass[1],z:e.centerOfMass[2]},{x:e.principalAngularInertia[0],y:e.principalAngularInertia[1],z:e.principalAngularInertia[2]},p(e.angularInertiaLocalFrame)):t().setMass(e.mass))}),s(()=>{var n;t()&&$(t(),y,(n=r==null?void 0:r.userData)==null?void 0:n.events)});const v=()=>{t()&&(t().setTranslation(ee(o)),t().setRotation(te(o)))},{start:x,stop:R}=_(()=>{v()},{autoStart:!u&&e.type==="dynamic"});s(()=>{!u&&e.type==="dynamic"?x():R()}),O(()=>{t()&&(d.removeColliderFromContext(t()),C.removeColliders([t()]),g.removeCollider(t(),!0),t(void 0))});const P=k();G(o),H(P,n=>(n==null||n.add(o),()=>{n==null||n.remove(o)}));var A=V(),W=L(A);return J(W,()=>e.children??z,()=>({collider:t()})),j(i,A),E({refresh:v})}export{ue as C};
