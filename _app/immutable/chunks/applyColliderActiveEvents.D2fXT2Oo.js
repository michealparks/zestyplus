import{g as f,aF as m,b as v,p as F,u as s,f as L,a as z,aE as K,$ as Q}from"./index-client.D_7LkImg.js";import{g as U}from"./index.7ttzKC12.js";import"./disclose-version.Bg9kRutz.js";import{c as q,a as H}from"./template.AcjnxTEE.js";import{$ as J,ab as X,ac as Y,aa as Z,s as p,V as $}from"./T.po24HVTg.js";import{p as r}from"./props.BhoiTsxR.js";import{i as ee,p as C,b as te,g as ne,a as oe,s as ie,E as h}from"./createCollidersFromChildren.Cm4lVrJe.js";const ae=()=>f("threlte-rapier-context"),D=(t,e)=>{t.forEach(n=>{n&&n.collider&&n.collider.isValid()&&n.collider.setCollisionGroups(e)})},xe=()=>{const t=new Map,e=f("threlte-rapier-collision-group");if(!e)return{registerColliders:c=>{},removeColliders:c=>{}};let n=U(e);const i=e.subscribe(c=>{n=c,D(t,c)});return m(i),{registerColliders:c=>{c.forEach(d=>{t.has(d.handle)||t.set(d.handle,{collider:d,initialCollisionGroup:d.collisionGroups()})}),D(t,n)},removeColliders:c=>{c.forEach(d=>{const y=t.get(d.handle);y&&d&&d.isValid()&&d.setCollisionGroups(y.initialCollisionGroup),t.delete(d.handle)})}}},Re=()=>f("threlte-rapier-rigidbody"),S=Symbol("threlte-rapier-rigidbody-object3d"),Ce=()=>f(S),se=t=>{v(S,t)},re=t=>{const e=[];let n;const i=()=>{if(e.forEach(c=>c()),e.length=0,n===void 0)return;const l=t==null?void 0:t(n);l&&e.push(l)},u=l=>{n=l,i()};return m(()=>{e.forEach(l=>l())}),{updateRef:u}},T={position:["setTranslation","setNextKinematicTranslation"],rotation:["setRotation","setNextKinematicRotation"]},le=(t,e)=>{const n={};T.position.forEach(i=>{n[i]=t[i].bind(t);const u=(...l)=>(e.userData.physics.resetPosition=!0,n[i](...l));t[i]=u}),T.rotation.forEach(i=>{n[i]=t[i].bind(t);const u=(...l)=>(e.userData.physics.resetRotation=!0,n[i](...l));t[i]=u})};function he(t,e){F(e,!0);const{world:n,rapier:i,addRigidBodyToContext:u,removeRigidBodyFromContext:l}=ae();let c=r(e,"type",3,"dynamic"),d=r(e,"canSleep",3,!0),y=r(e,"gravityScale",3,1),k=r(e,"ccd",3,!1),E=r(e,"angularDamping",3,0),V=r(e,"linearDamping",3,0),w=r(e,"lockRotations",3,!1),B=r(e,"lockTranslations",3,!1),O=r(e,"enabledRotations",19,()=>[!0,!0,!0]),M=r(e,"enabledTranslations",19,()=>[!0,!0,!0]),P=r(e,"dominance",3,0),G=r(e,"enabled",3,!0),j=r(e,"userData",19,()=>({})),I=r(e,"rigidBody",15);const{updateRef:N}=re(e.oncreate),a=new J;ee(a),a.userData.isSleeping=!1;const _=new i.RigidBodyDesc(C(c())).setCanSleep(d());let o=n.createRigidBody(_);le(o,a),I(o),(async()=>{await K(),a.updateMatrix(),a.updateWorldMatrix(!0,!1);const g=a.parent?te(a.parent):new $(1,1,1),x=ne(a).multiply(g),R=oe(a);ie(a,x,R),o.setTranslation(x,!0),o.setRotation(R,!0),N(o)})(),a.userData.rigidBody=o,s(()=>o.setBodyType(C(c()),!0)),s(()=>{e.linearVelocity&&o.setLinvel({x:e.linearVelocity[0],y:e.linearVelocity[1],z:e.linearVelocity[2]},!0)}),s(()=>{e.angularVelocity&&o.setAngvel({x:e.angularVelocity[0],y:e.angularVelocity[1],z:e.angularVelocity[2]},!0)}),s(()=>o.setGravityScale(y(),!0)),s(()=>o.enableCcd(k())),s(()=>o.setDominanceGroup(P())),s(()=>o.lockRotations(w(),!0)),s(()=>o.lockTranslations(B(),!0)),s(()=>o.setEnabledRotations(...O(),!0)),s(()=>o.setEnabledTranslations(...M(),!0)),s(()=>o.setAngularDamping(E())),s(()=>o.setLinearDamping(V())),s(()=>o.setEnabled(G())),s(()=>{o.userData={events:{oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit,onsleep:e.onsleep,onwake:e.onwake},...j()}}),v("threlte-rapier-rigidbody",o),se(a),u(o,a,{oncollisionenter:e.oncollisionenter,oncollisionexit:e.oncollisionexit,oncontact:e.oncontact,onsensorenter:e.onsensorenter,onsensorexit:e.onsensorexit,onsleep:e.onsleep,onwake:e.onwake}),m(()=>{l(o),n.removeRigidBody(o)});const A=X();Y(a),Z(A,g=>(g==null||g.add(a),()=>{g==null||g.remove(a)}));var b=q(),W=L(b);p(W,()=>e.children??Q,()=>({rigidBody:o})),H(t,b),z()}const De=(t,e={},n={})=>{let i=0;(e.oncollisionenter||e.oncollisionexit||n.oncollisionenter||n.oncollisionexit||e.onsensorenter||e.onsensorexit||n.onsensorenter||n.onsensorexit)&&(i=i|h.COLLISION_EVENTS),(e.oncontact||n.oncontact)&&(i=i|h.CONTACT_FORCE_EVENTS),i>0&&t.setActiveEvents(i)};export{he as R,re as a,Re as b,Ce as c,xe as d,De as e,ae as u};
