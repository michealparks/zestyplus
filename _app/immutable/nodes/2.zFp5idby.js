var qe=e=>{throw TypeError(e)};var Ge=(e,t,r)=>t.has(e)||qe("Cannot "+r);var C=(e,t,r)=>(Ge(e,t,"read from private field"),r?r.call(e):t.get(e)),G=(e,t,r)=>t.has(e)?qe("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),ne=(e,t,r,i)=>(Ge(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),Be=(e,t,r)=>(Ge(e,t,"access private method"),r);import{c as Q,b as A,t as H,d as Ft}from"../chunks/disclose-version.CY5IDNoG.js";import{Q as Lt,aO as Gt,aP as kt,M as Vt,I as $t,r as et,ay as Wt,O as jt,E as te,aQ as Kt,ak as tt,al as rt,a4 as Qt,p as j,y as O,t as K,w as T,ah as W,ae as I,ag as D,ai as P,G as k,F as Ce,z as F,ad as fe,A as $e,v as mt,x as Ie,af as Xt}from"../chunks/runtime.XPaRurxh.js";import{i as V}from"../chunks/if.uA99IKIX.js";import{s as Ne}from"../chunks/snippet.CMdN7rSJ.js";import{b as We}from"../chunks/this.BoPDCSn0.js";import{r as gt,b as Yt,c as Z,s as Zt,a as it}from"../chunks/props.Dz65N0hT.js";import{c as Jt}from"../chunks/cache.DWgAQEbZ.js";import{a_ as qt,aW as er,a$ as tr,b0 as rr,b1 as ir,b2 as sr,b3 as nr,b4 as ar,b5 as xt,i as L,b6 as ue,aa as N,b7 as or,b8 as lr,b9 as ur,ba as cr,bb as ie,bc as z,bd as Oe,be as st,bf as hr,d as fr,ag as De,k as Ue,J as ze,j as he,aE as dr,bg as Ze,a8 as St,bh as yt,R as Tt,bi as xe,ar as vr,D as pr,B as nt,al as Et,aF as _t,C as mr,a3 as at,u as gr,a as xr}from"../chunks/T.y93Wq12a.js";import{c as Sr}from"../chunks/user.ph0EtUhJ.js";import{o as ye,e as wt}from"../chunks/events.Ds60R_ez.js";import{o as Mt}from"../chunks/entry.DrrniBgS.js";import{u as me,t as ot,K as ge,s as lt}from"../chunks/keybindings.svelte.CR6yiour.js";import{a as Rt,u as yr}from"../chunks/auth.svelte.CNkesG8U.js";import"../chunks/legacy.PQa5ncrZ.js";import{i as He}from"../chunks/lifecycle.CxaT9aiB.js";import{a as Tr,s as Te}from"../chunks/render.D7HJPnec.js";import{e as bt,i as Er}from"../chunks/each.BoW94gwA.js";import{a as je}from"../chunks/attributes.BRGMoFZU.js";function _r(e,t,r){if(r){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}const wr=()=>performance.now(),q={tick:e=>requestAnimationFrame(e),now:()=>wr(),tasks:new Set};function Bt(){const e=q.now();q.tasks.forEach(t=>{t.c(e)||(q.tasks.delete(t),t.f())}),q.tasks.size!==0&&q.tick(Bt)}function Mr(e){let t;return q.tasks.size===0&&q.tick(Bt),{promise:new Promise(r=>{q.tasks.add(t={c:e,f:r})}),abort(){q.tasks.delete(t)}}}function Ae(e,t){e.dispatchEvent(new CustomEvent(t))}function Rr(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function ut(e){const t={},r=e.split(";");for(const i of r){const[a,u]=i.split(":");if(!a||u===void 0)break;const c=Rr(a.trim());t[c]=u.trim()}return t}const br=e=>e;function Ut(e,t,r,i){var a=(e&Kt)!==0,u="both",c,p=t.inert,l=t.style.overflow,s,f;function n(){var y=Qt,w=et;tt(null),rt(null);try{return c??(c=r()(t,(i==null?void 0:i())??{},{direction:u}))}finally{tt(y),rt(w)}}var o={is_global:a,in(){t.inert=p,Ae(t,"introstart"),s=Ke(t,n(),f,1,()=>{Ae(t,"introend"),s==null||s.abort(),s=c=void 0,t.style.overflow=l})},out(y){t.inert=!0,Ae(t,"outrostart"),f=Ke(t,n(),s,0,()=>{Ae(t,"outroend"),y==null||y()})},stop:()=>{s==null||s.abort(),f==null||f.abort()}},v=et;if((v.transitions??(v.transitions=[])).push(o),Tr){var d=a;if(!d){for(var h=v.parent;h&&h.f&Lt;)for(;(h=h.parent)&&!(h.f&Gt););d=!h||(h.f&kt)!==0}d&&Vt(()=>{$t(()=>o.in())})}}function Ke(e,t,r,i,a){var u=i===1;if(Wt(t)){var c,p=!1;return jt(()=>{if(!p){var y=t({direction:u?"in":"out"});c=Ke(e,y,r,i,a)}}),{abort:()=>{p=!0,c==null||c.abort()},deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:()=>c.t()}}if(r==null||r.deactivate(),!(t!=null&&t.duration))return a(),{abort:te,deactivate:te,reset:te,t:()=>i};const{delay:l=0,css:s,tick:f,easing:n=br}=t;var o=[];if(u&&r===void 0&&(f&&f(0,1),s)){var v=ut(s(0,1));o.push(v,v)}var d=()=>1-i,h=e.animate(o,{duration:l});return h.onfinish=()=>{var y=(r==null?void 0:r.t())??1-i;r==null||r.abort();var w=i-y,g=t.duration*Math.abs(w),S=[];if(g>0){var m=!1;if(s)for(var x=Math.ceil(g/16.666666666666668),E=0;E<=x;E+=1){var b=y+w*n(E/x),B=ut(s(b,1-b));S.push(B),m||(m=B.overflow==="hidden")}m&&(e.style.overflow="hidden"),d=()=>{var M=h.currentTime;return y+w*n(M/g)},f&&Mr(()=>{if(h.playState!=="running")return!1;var M=d();return f(M,1-M),!0})}h=e.animate(S,{duration:g,fill:"forwards"}),h.onfinish=()=>{d=()=>i,f==null||f(i,1-i),a()}},{abort:()=>{h&&(h.cancel(),h.effect=null,h.onfinish=te)},deactivate:()=>{a=te},reset:()=>{i===0&&(f==null||f(1,0))},t:()=>d()}}const Br=e=>{qt(e),Jt();const{scene:t}=er();tr(t),rr(t),ir(),sr(e),nr(),ar(e),Sr()};function Ur(e,t){j(t,!0);let r=gt(t,["$$slots","$$events","$$legacy","children"]);Br(r);var i=Q(),a=O(i);Ne(a,()=>t.children),A(e,i),K()}var zr=H('<div class="svelte-1osucwe"><canvas class="svelte-1osucwe"><!></canvas></div>');function Ar(e,t){j(t,!0);let r=gt(t,["$$slots","$$events","$$legacy","children"]),i=W(void 0),a=W(void 0);var u=zr(),c=I(u),p=I(c);{var l=s=>{Ur(s,Yt({get dom(){return T(a)},get canvas(){return T(i)}},()=>r,{children:(f,n)=>{var o=Q(),v=O(o);Ne(v,()=>t.children??te),A(f,o)},$$slots:{default:!0}}))};V(p,s=>{T(i)&&T(a)&&s(l)})}D(c),We(c,s=>P(i,s),()=>T(i)),D(u),We(u,s=>P(a,s),()=>T(a)),A(e,u),K()}const Je=window;function Cr(e){let t=e.activeElement;for(;t!=null&&t.shadowRoot;){const r=t.shadowRoot.activeElement;if(r===t)break;t=r}return t}var de,Ee;class Dr{constructor(t={}){G(this,de);G(this,Ee);const{window:r=Je,document:i=r==null?void 0:r.document}=t;r!==void 0&&(ne(this,de,i),ne(this,Ee,xt(a=>{const u=ye(r,"focusin",a),c=ye(r,"focusout",a);return()=>{u(),c()}})))}get current(){var t;return(t=C(this,Ee))==null||t.call(this),C(this,de)?Cr(C(this,de)):null}}de=new WeakMap,Ee=new WeakMap;new Dr;function Pr(e){return typeof e=="function"}function Se(e,t){if(Pr(e)){const r=e;return r()??t??r()}return e??t??e}function Ir(e,t=250){let r=W(null);function i(...a){if(T(r))T(r).timeout&&clearTimeout(T(r).timeout);else{let u,c;const p=new Promise((l,s)=>{u=l,c=s});P(r,Z({timeout:null,runner:null,promise:p,resolve:u,reject:c}))}return T(r).runner=async()=>{if(!T(r))return;const u=T(r);P(r,null);try{u.resolve(await e.apply(this,a))}catch(c){u.reject(c)}},T(r).timeout=setTimeout(T(r).runner,typeof t=="function"?t():t),T(r).promise}return i.cancel=async()=>{(!T(r)||T(r).timeout===null)&&(await new Promise(a=>setTimeout(a,0)),!T(r)||T(r).timeout===null)||(clearTimeout(T(r).timeout),T(r).reject("Cancelled"),P(r,null))},i.runScheduledNow=async()=>{var a,u;(!T(r)||!T(r).timeout)&&(await new Promise(c=>setTimeout(c,0)),!T(r)||!T(r).timeout)||(clearTimeout(T(r).timeout),T(r).timeout=null,await((u=(a=T(r)).runner)==null?void 0:u.call(a)))},Object.defineProperty(i,"pending",{enumerable:!0,get(){var a;return!!((a=T(r))!=null&&a.timeout)}}),i}function ct(e,t,r,i){k(()=>{const a=Se(e),u=Se(t);if(a!=null)if(Array.isArray(u))for(const c of u)k(()=>ye(a,c,r,i));else return ye(a,u,r,i)})}const Nr=["keypress","mousemove","touchmove","click","scroll"],Or={events:Nr,initialState:!1,timeout:6e4};var ae,_e;class Hr{constructor(t){G(this,ae,W(!1));G(this,_e,W(Z(Date.now())));const r={...Or,...t},i=r.window??Je,a=r.document??(i==null?void 0:i.document),u=Ce(()=>Se(r.timeout)),c=Ce(()=>Se(r.events)),p=Ce(()=>Se(r.detectVisibilityChanges));C(this,ae).v=Z(r.initialState);const l=Ir(()=>{P(C(this,ae),!0)},()=>T(u));l();const s=()=>{P(C(this,ae),!1),P(C(this,_e),Z(Date.now())),l()};ct(()=>i,T(c),()=>{s()},{passive:!0}),k(()=>{!T(p)||!a||ct(a,["visibilitychange"],()=>{a.hidden||s()})})}get lastActive(){return T(C(this,_e))}get current(){return T(C(this,ae))}}ae=new WeakMap,_e=new WeakMap;function Fr(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}var oe,re,ve,pe,we,Pe,ce,Qe,zt;class Fe{constructor(t,r,i={}){G(this,ce);G(this,oe,W());G(this,re);G(this,ve);G(this,pe);G(this,we);G(this,Pe,t=>{t.key!==C(this,re)||t.newValue===null||Be(this,ce,Qe).call(this,t.newValue)});const{storage:a="local",serializer:u={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:c=!0,window:p=Je}=i;if(C(this,oe).v=Z(r),ne(this,re,t),ne(this,ve,u),p===void 0)return;const l=Fr(a,p);ne(this,pe,l);const s=l.getItem(t);s!==null&&Be(this,ce,Qe).call(this,s),c&&a==="local"&&ne(this,we,xt(()=>ye(p,"storage",C(this,Pe))))}get current(){var t;return(t=C(this,we))==null||t.call(this),T(C(this,oe))}set current(t){P(C(this,oe),Z(t)),Be(this,ce,zt).call(this,t)}}oe=new WeakMap,re=new WeakMap,ve=new WeakMap,pe=new WeakMap,we=new WeakMap,Pe=new WeakMap,ce=new WeakSet,Qe=function(t){try{P(C(this,oe),Z(C(this,ve).deserialize(t)))}catch(r){console.error(`Error when parsing "${t}" from persisted store "${C(this,re)}"`,r)}},zt=function(t){var r;try{(r=C(this,pe))==null||r.setItem(C(this,re),C(this,ve).serialize(t))}catch(i){console.error(`Error when writing value from persisted store "${C(this,re)}" to ${C(this,pe)}`,i)}};var Me;class Lr{constructor(){G(this,Me,W())}get current(){return T(C(this,Me))}set current(t){P(C(this,Me),Z(t))}}Me=new WeakMap;const At=new Lr;let ht=!1;const Gr={NO_TRACK_PLAYING:204},kr=async e=>{const t="https://api.spotify.com/v1/me/player/currently-playing";try{const r=await fetch(t,{headers:{Authorization:`Bearer ${e.access}`,"Content-Type":"application/json"}});if(r.status===Gr.NO_TRACK_PLAYING){console.log("No track is currently playing.");return}if(!r.ok){console.error(`fetchCurrentlyPlayingTrack: ${r.status} - ${r.statusText}`);return}return r.json()}catch(r){console.error("Error fetching currently playing track:",r)}},Xe=async e=>{const t=await kr(e);if(At.current=t,t===void 0){setTimeout(Xe,3e3,e);return}const r=t.item.duration_ms-t.progress_ms+1e3;setTimeout(Xe,r,e)},Ct=()=>{const{token:e,authenticated:t}=Rt();return ht||(k(()=>{t.current==="logged-in"&&Xe(e)}),ht=!0),{track:At}};/**
 * postprocessing v6.36.6 build Tue Dec 31 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var ke=1/1e3,Vr=1e3,$r=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*ke}get fixedDelta(){return this._fixedDelta*ke}set fixedDelta(e){this._fixedDelta=e*Vr}get elapsed(){return this._elapsed*ke}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Wr=(()=>{const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),r=new pr;return r.setAttribute("position",new nt(e,3)),r.setAttribute("uv",new nt(t,2)),r})(),X=class Ye{static get fullscreenGeometry(){return Wr}constructor(t="Pass",r=new st,i=new hr){this.name=t,this.renderer=null,this.scene=r,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const r=this.fullscreenMaterial;r!==null&&(r.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let r=this.screen;r!==null?r.material=t:(r=new fr(Ye.fullscreenGeometry,t),r.frustumCulled=!1,this.scene===null&&(this.scene=new st),this.scene.add(r),this.screen=r)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,r=Oe){}render(t,r,i,a,u){throw new Error("Render method not implemented!")}setSize(t,r){}initialize(t,r,i){}dispose(){for(const t of Object.keys(this)){const r=this[t];(r instanceof ie||r instanceof Et||r instanceof _t||r instanceof Ye)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},jr=class extends X{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,r,i,a){const u=e.state.buffers.stencil;u.setLocked(!1),u.setTest(!1)}},Kr=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Dt="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Pt=class extends he{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new z(null),opacity:new z(1)},blending:xe,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Kr,vertexShader:Dt})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Qr=class extends X{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Pt,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new ie(1,1,{minFilter:De,magFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,r,i,a){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,r){r!==void 0&&(this.renderTarget.texture.type=r,r!==ue?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e!==null&&e.outputColorSpace===N&&(this.renderTarget.texture.colorSpace=N))}},ft=new mr,It=class extends X{constructor(e=!0,t=!0,r=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=r,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,r){this.color=e,this.depth=t,this.stencil=r}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,r,i,a){const u=this.overrideClearColor,c=this.overrideClearAlpha,p=e.getClearAlpha(),l=u!==null,s=c>=0;l?(e.getClearColor(ft),e.setClearColor(u,s?c:p)):s&&e.setClearAlpha(c),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(ft,p):s&&e.setClearAlpha(p)}},Xr=class extends X{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new It(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,r,i,a){const u=e.getContext(),c=e.state.buffers,p=this.scene,l=this.camera,s=this.clearPass,f=this.inverted?0:1,n=1-f;c.color.setMask(!1),c.depth.setMask(!1),c.color.setLocked(!0),c.depth.setLocked(!0),c.stencil.setTest(!0),c.stencil.setOp(u.REPLACE,u.REPLACE,u.REPLACE),c.stencil.setFunc(u.ALWAYS,f,4294967295),c.stencil.setClear(n),c.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?s.render(e,null):(s.render(e,t),s.render(e,r))),this.renderToScreen?(e.setRenderTarget(null),e.render(p,l)):(e.setRenderTarget(t),e.render(p,l),e.setRenderTarget(r),e.render(p,l)),c.color.setLocked(!1),c.depth.setLocked(!1),c.stencil.setLocked(!1),c.stencil.setFunc(u.EQUAL,1,4294967295),c.stencil.setOp(u.KEEP,u.KEEP,u.KEEP),c.stencil.setLocked(!0)}},Yr=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:a}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,r,a,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Qr,this.depthTexture=null,this.passes=[],this.timer=new $r,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new L),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===ue&&e.outputColorSpace===N&&(this.inputBuffer.texture.colorSpace=N,this.outputBuffer.texture.colorSpace=N,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const a of this.passes)a.initialize(e,r,i)}}replaceRenderer(e,t=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new or;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=lr,e.type=ur):e.type=cr,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i){const a=this.renderer,u=a===null?new L:a.getDrawingBufferSize(new L),c={minFilter:De,magFilter:De,stencilBuffer:t,depthBuffer:e,type:r},p=new ie(u.width,u.height,c);return i>0&&(p.ignoreDepthForMultisampleCopy=!1,p.samples=i),r===ue&&a!==null&&a.outputColorSpace===N&&(p.texture.colorSpace=N),p.texture.name="EffectComposer.Buffer",p.texture.generateMipmaps=!1,p}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const r=this.passes,i=this.renderer,a=i.getDrawingBufferSize(new L),u=i.getContext().getContextAttributes().alpha,c=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(a.width,a.height),e.initialize(i,u,c),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?r.splice(t,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const p=this.createDepthTexture();for(e of r)e.setDepthTexture(p)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,r=t.indexOf(e);if(r!==-1&&t.splice(r,1).length>0){if(this.depthTexture!==null){const u=(p,l)=>p||l.needsDepthTexture;t.reduce(u,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,r=this.copyPass;let i=this.inputBuffer,a=this.outputBuffer,u=!1,c,p,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const s of this.passes)s.enabled&&(s.render(t,i,a,e,u),s.needsSwap&&(u&&(r.renderToScreen=s.renderToScreen,c=t.getContext(),p=t.state.buffers.stencil,p.setFunc(c.NOTEQUAL,1,4294967295),r.render(t,i,a,e,u),p.setFunc(c.EQUAL,1,4294967295)),l=i,i=a,a=l),s instanceof Xr?u=!0:s instanceof jr&&(u=!1))}setSize(e,t,r){const i=this.renderer,a=i.getSize(new L);(e===void 0||t===void 0)&&(e=a.width,t=a.height),(a.width!==e||a.height!==t)&&i.setSize(e,t,r);const u=i.getDrawingBufferSize(new L);this.inputBuffer.setSize(u.width,u.height),this.outputBuffer.setSize(u.width,u.height);for(const c of this.passes)c.setSize(u.width,u.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),X.fullscreenGeometry.dispose()}},le={NONE:0,DEPTH:1,CONVOLUTION:2},U={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Zr=class{constructor(){this.shaderParts=new Map([[U.FRAGMENT_HEAD,null],[U.FRAGMENT_MAIN_UV,null],[U.FRAGMENT_MAIN_IMAGE,null],[U.VERTEX_HEAD,null],[U.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=le.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=St}},Ve=!1,dt=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let r;if(t.material.flatShading)switch(t.material.side){case ze:r=this.materialsFlatShadedDoubleSide;break;case Ue:r=this.materialsFlatShadedBackSide;break;default:r=this.materialsFlatShaded;break}else switch(t.material.side){case ze:r=this.materialsDoubleSide;break;case Ue:r=this.materialsBackSide;break;default:r=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=r[2]:t.isInstancedMesh?t.material=r[1]:t.material=r[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof he))return e.clone();const t=e.uniforms,r=new Map;for(const a in t){const u=t[a].value;u.isRenderTargetTexture&&(t[a].value=null,r.set(a,u))}const i=e.clone();for(const a of r)t[a[0]].value=a[1],i.uniforms[a[0]].value=a[1];return i}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const r of t)r.uniforms=Object.assign({},e.uniforms),r.side=dr;t[2].skinning=!0,this.materialsBackSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.side=Ue,i}),this.materialsDoubleSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.side=ze,i}),this.materialsFlatShaded=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=Ue,i}),this.materialsFlatShadedDoubleSide=t.map(r=>{const i=this.cloneMaterial(r);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=ze,i})}}render(e,t,r){const i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Ve){const a=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,r);for(const u of a)u[0].material=u[1];this.meshCount!==a.size&&a.clear()}else{const a=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,r),t.overrideMaterial=a}e.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Ve}static set workaroundEnabled(e){Ve=e}},ee=-1,Y=class extends Ze{constructor(e,t=ee,r=ee,i=1){super(),this.resizable=e,this.baseSize=new L(1,1),this.preferredSize=new L(t,r),this.target=this.preferredSize,this.s=i,this.effectiveSize=new L,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,r=this.effectiveSize,i=this.scale;t.width!==ee?r.width=t.width:t.height!==ee?r.width=Math.round(t.height*(e.width/Math.max(e.height,1))):r.width=Math.round(e.width*i),t.height!==ee?r.height=t.height:t.width!==ee?r.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r.height=Math.round(e.height*i)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(ee),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ee}},R={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Jr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",qr="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",ei="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",ti="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ri="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",ii="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",ni="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",ai="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",oi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",li="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",ci="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",hi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",fi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",di="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",vi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",pi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",mi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",gi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",xi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Si="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",yi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Ti="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Ei="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",_i="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",wi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Mi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Ri="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",bi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Bi="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Ui="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",zi=new Map([[R.ADD,Jr],[R.ALPHA,qr],[R.AVERAGE,ei],[R.COLOR,ti],[R.COLOR_BURN,ri],[R.COLOR_DODGE,ii],[R.DARKEN,si],[R.DIFFERENCE,ni],[R.DIVIDE,ai],[R.DST,null],[R.EXCLUSION,oi],[R.HARD_LIGHT,li],[R.HARD_MIX,ui],[R.HUE,ci],[R.INVERT,hi],[R.INVERT_RGB,fi],[R.LIGHTEN,di],[R.LINEAR_BURN,vi],[R.LINEAR_DODGE,pi],[R.LINEAR_LIGHT,mi],[R.LUMINOSITY,gi],[R.MULTIPLY,xi],[R.NEGATION,Si],[R.NORMAL,yi],[R.OVERLAY,Ti],[R.PIN_LIGHT,Ei],[R.REFLECT,_i],[R.SATURATION,wi],[R.SCREEN,Mi],[R.SOFT_LIGHT,Ri],[R.SRC,bi],[R.SUBTRACT,Bi],[R.VIVID_LIGHT,Ui]]),Ai=class extends Ze{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new z(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return zi.get(this.blendFunction)}},Le={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Ci=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Di="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Pi=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Ii=class extends he{constructor(e=new at){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new z(null),texelSize:new z(new at),scale:new z(1),kernel:new z(0)},blending:xe,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ci,vertexShader:Di}),this.setTexelSize(e.x,e.y),this.kernelSize=Le.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return Pi[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const r=1/e,i=1/t;this.uniforms.texelSize.value.set(r,i,r*.5,i*.5)}},Ni=class extends X{constructor({kernelSize:e=Le.MEDIUM,resolutionScale:t=.5,width:r=Y.AUTO_SIZE,height:i=Y.AUTO_SIZE,resolutionX:a=r,resolutionY:u=i}={}){super("KawaseBlurPass"),this.renderTargetA=new ie(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const c=this.resolution=new Y(this,a,u,t);c.addEventListener("change",p=>this.setSize(c.baseWidth,c.baseHeight)),this._blurMaterial=new Ii,this._blurMaterial.kernelSize=e,this.copyMaterial=new Pt}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,r,i,a){const u=this.scene,c=this.camera,p=this.renderTargetA,l=this.renderTargetB,s=this.blurMaterial,f=s.kernelSequence;let n=t;this.fullscreenMaterial=s;for(let o=0,v=f.length;o<v;++o){const d=o&1?l:p;s.kernel=f[o],s.inputBuffer=n.texture,e.setRenderTarget(d),e.render(u,c),n=d}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=n.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(u,c)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t);const i=r.width,a=r.height;this.renderTargetA.setSize(i,a),this.renderTargetB.setSize(i,a),this.blurMaterial.setSize(e,t)}initialize(e,t,r){r!==void 0&&(this.renderTargetA.texture.type=r,this.renderTargetB.texture.type=r,r!==ue?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e!==null&&e.outputColorSpace===N&&(this.renderTargetA.texture.colorSpace=N,this.renderTargetB.texture.colorSpace=N))}static get AUTO_SIZE(){return Y.AUTO_SIZE}},Oi=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,Hi=class extends he{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Tt.replace(/\D+/g,"")},uniforms:{inputBuffer:new z(null),threshold:new z(0),smoothing:new z(1),range:new z(null)},blending:xe,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Oi,vertexShader:Dt}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Fi=class extends X{constructor({renderTarget:e,luminanceRange:t,colorOutput:r,resolutionScale:i=1,width:a=Y.AUTO_SIZE,height:u=Y.AUTO_SIZE,resolutionX:c=a,resolutionY:p=u}={}){super("LuminancePass"),this.fullscreenMaterial=new Hi(r,t),this.needsSwap=!1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new ie(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new Y(this,c,p,i);l.addEventListener("change",s=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,r,i,a){const u=this.fullscreenMaterial;u.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height)}initialize(e,t,r){r!==void 0&&r!==ue&&(this.renderTarget.texture.type=r,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Li=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Gi="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",ki=class extends he{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new z(null),texelSize:new z(new L)},blending:xe,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Li,vertexShader:Gi})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Vi=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,$i="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Wi=class extends he{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new z(null),supportBuffer:new z(null),texelSize:new z(new L),radius:new z(.85)},blending:xe,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Vi,vertexShader:$i})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},ji=class extends X{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new ie(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new ki,this.upsamplingMaterial=new Wi,this.resolution=new L}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let r=0;r<e;++r){const i=t.clone();i.texture.name="Downsampling.Mipmap"+r,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(let r=1,i=e-1;r<i;++r){const a=t.clone();a.texture.name="Upsampling.Mipmap"+r,this.upsamplingMipmaps.push(a)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,r,i,a){const{scene:u,camera:c}=this,{downsamplingMaterial:p,upsamplingMaterial:l}=this,{downsamplingMipmaps:s,upsamplingMipmaps:f}=this;let n=t;this.fullscreenMaterial=p;for(let o=0,v=s.length;o<v;++o){const d=s[o];p.setSize(n.width,n.height),p.inputBuffer=n.texture,e.setRenderTarget(d),e.render(u,c),n=d}this.fullscreenMaterial=l;for(let o=f.length-1;o>=0;--o){const v=f[o];l.setSize(n.width,n.height),l.inputBuffer=n.texture,l.supportBuffer=s[o].texture,e.setRenderTarget(v),e.render(u,c),n=v}}setSize(e,t){const r=this.resolution;r.set(e,t);let i=r.width,a=r.height;for(let u=0,c=this.downsamplingMipmaps.length;u<c;++u)i=Math.round(i*.5),a=Math.round(a*.5),this.downsamplingMipmaps[u].setSize(i,a),u<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[u].setSize(i,a)}initialize(e,t,r){if(r!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const a of i)a.texture.type=r;if(r!==ue)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(e!==null&&e.outputColorSpace===N)for(const a of i)a.texture.colorSpace=N}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},Ki=class extends Ze{constructor(e,t,{attributes:r=le.NONE,blendFunction:i=R.NORMAL,defines:a=new Map,uniforms:u=new Map,extensions:c=null,vertexShader:p=null}={}){super(),this.name=e,this.renderer=null,this.attributes=r,this.fragmentShader=t,this.vertexShader=p,this.defines=a,this.uniforms=u,this.extensions=c,this.blendMode=new Ai(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=St,this._outputColorSpace=yt}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Oe){}update(e,t,r){}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof ie||t instanceof Et||t instanceof _t||t instanceof X)&&this[e].dispose()}}},Qi=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,Xi=class extends Ki{constructor({blendFunction:e=R.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:r=.025,mipmapBlur:i=!1,intensity:a=1,radius:u=.85,levels:c=8,kernelSize:p=Le.LARGE,resolutionScale:l=.5,width:s=Y.AUTO_SIZE,height:f=Y.AUTO_SIZE,resolutionX:n=s,resolutionY:o=f}={}){super("BloomEffect",Qi,{blendFunction:e,uniforms:new Map([["map",new z(null)],["intensity",new z(a)]])}),this.renderTarget=new ie(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Ni({kernelSize:p}),this.luminancePass=new Fi({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=r,this.mipmapBlurPass=new ji,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=u,this.mipmapBlurPass.levels=c,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const v=this.resolution=new Y(this,n,o,l);v.addEventListener("change",d=>this.setSize(v.baseWidth,v.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,r){const i=this.renderTarget,a=this.luminancePass;a.enabled?(a.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,a.renderTarget):this.blurPass.render(e,a.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,i)}setSize(e,t){const r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height),this.blurPass.resolution.copy(r),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,r){this.blurPass.initialize(e,t,r),this.luminancePass.initialize(e,t,r),this.mipmapBlurPass.initialize(e,t,r),r!==void 0&&(this.renderTarget.texture.type=r,e!==null&&e.outputColorSpace===N&&(this.renderTarget.texture.colorSpace=N))}},Yi=class extends X{constructor(e,t,r=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new It,this.overrideMaterialManager=r===null?null:new dt(r),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new dt(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,r,i,a){const u=this.scene,c=this.camera,p=this.selection,l=c.layers.mask,s=u.background,f=e.shadowMap.autoUpdate,n=this.renderToScreen?null:t;p!==null&&c.layers.set(p.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(u.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(n),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,u,c):e.render(u,c),c.layers.mask=l,u.background=s,e.shadowMap.autoUpdate=f}},Zi=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Ji="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",qi=class extends he{constructor(e,t,r,i,a=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Tt.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new z(null),depthBuffer:new z(null),resolution:new z(new L),texelSize:new z(new L),cameraNear:new z(.3),cameraFar:new z(1e3),aspect:new z(1),time:new z(0)},blending:xe,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:a}),e&&this.setShaderParts(e),t&&this.setDefines(t),r&&this.setUniforms(r),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Oe){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=Zi.replace(U.FRAGMENT_HEAD,e.get(U.FRAGMENT_HEAD)||"").replace(U.FRAGMENT_MAIN_UV,e.get(U.FRAGMENT_MAIN_UV)||"").replace(U.FRAGMENT_MAIN_IMAGE,e.get(U.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Ji.replace(U.VERTEX_HEAD,e.get(U.VERTEX_HEAD)||"").replace(U.VERTEX_MAIN_SUPPORT,e.get(U.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof vr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const r=this.uniforms;r.resolution.value.set(e,t),r.texelSize.value.set(1/e,1/t),r.aspect.value=e/t}static get Section(){return U}};function vt(e,t,r){for(const i of t){const a="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),u=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const c of r.entries())c[1]!==null&&r.set(c[0],c[1].replace(u,a))}}function es(e,t,r){let i=t.getFragmentShader(),a=t.getVertexShader();const u=i!==void 0&&/mainImage/.test(i),c=i!==void 0&&/mainUv/.test(i);if(r.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(c&&r.attributes&le.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!u&&!c)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const p=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=r.shaderParts;let s=l.get(U.FRAGMENT_HEAD)||"",f=l.get(U.FRAGMENT_MAIN_UV)||"",n=l.get(U.FRAGMENT_MAIN_IMAGE)||"",o=l.get(U.VERTEX_HEAD)||"",v=l.get(U.VERTEX_MAIN_SUPPORT)||"";const d=new Set,h=new Set;if(c&&(f+=`	${e}MainUv(UV);
`,r.uvTransformation=!0),a!==null&&/mainSupport/.test(a)){const g=/mainSupport *\([\w\s]*?uv\s*?\)/.test(a);v+=`	${e}MainSupport(`,v+=g?`vUv);
`:`);
`;for(const S of a.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const m of S[1].split(/\s*,\s*/))r.varyings.add(m),d.add(m),h.add(m);for(const S of a.matchAll(p))h.add(S[1])}for(const g of i.matchAll(p))h.add(g[1]);for(const g of t.defines.keys())h.add(g.replace(/\([\w\s,]*\)/g,""));for(const g of t.uniforms.keys())h.add(g);h.delete("while"),h.delete("for"),h.delete("if"),t.uniforms.forEach((g,S)=>r.uniforms.set(e+S.charAt(0).toUpperCase()+S.slice(1),g)),t.defines.forEach((g,S)=>r.defines.set(e+S.charAt(0).toUpperCase()+S.slice(1),g));const y=new Map([["fragment",i],["vertex",a]]);vt(e,h,r.defines),vt(e,h,y),i=y.get("fragment"),a=y.get("vertex");const w=t.blendMode;if(r.blendModes.set(w.blendFunction,w),u){t.inputColorSpace!==null&&t.inputColorSpace!==r.colorSpace&&(n+=t.inputColorSpace===N?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==yt?r.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(r.colorSpace=t.inputColorSpace);const g=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;n+=`${e}MainImage(color0, UV, `,r.attributes&le.DEPTH&&g.test(i)&&(n+="depth, ",r.readDepth=!0),n+=`color1);
	`;const S=e+"BlendOpacity";r.uniforms.set(S,w.opacity),n+=`color0 = blend${w.blendFunction}(color0, color1, ${S});

	`,s+=`uniform float ${S};

`}if(s+=i+`
`,a!==null&&(o+=a+`
`),l.set(U.FRAGMENT_HEAD,s),l.set(U.FRAGMENT_MAIN_UV,f),l.set(U.FRAGMENT_MAIN_IMAGE,n),l.set(U.VERTEX_HEAD,o),l.set(U.VERTEX_MAIN_SUPPORT,v),t.extensions!==null)for(const g of t.extensions)r.extensions.add(g)}}var ts=class extends X{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new qi(null,null,null,e),this.listener=r=>this.handleEvent(r),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,r)=>r.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new Zr;let t=0;for(const c of this.effects)if(c.blendMode.blendFunction===R.DST)e.attributes|=c.getAttributes()&le.DEPTH;else{if(e.attributes&c.getAttributes()&le.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${c.name})`);es("e"+t++,c,e)}let r=e.shaderParts.get(U.FRAGMENT_HEAD),i=e.shaderParts.get(U.FRAGMENT_MAIN_IMAGE),a=e.shaderParts.get(U.FRAGMENT_MAIN_UV);const u=/\bblend\b/g;for(const c of e.blendModes.values())r+=c.getShaderCode().replace(u,`blend${c.blendFunction}`)+`
`;e.attributes&le.DEPTH?(e.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===N&&(i+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(a=`vec2 transformedUv = vUv;
`+a,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(U.FRAGMENT_HEAD,r),e.shaderParts.set(U.FRAGMENT_MAIN_IMAGE,i),e.shaderParts.set(U.FRAGMENT_MAIN_UV,a);for(const[c,p]of e.shaderParts)p!==null&&e.shaderParts.set(c,p.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Oe){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const r of this.effects)r.setDepthTexture(e,t)}render(e,t,r,i,a){for(const u of this.effects)u.update(e,t,i);if(!this.skipRendering||this.renderToScreen){const u=this.fullscreenMaterial;u.inputBuffer=t.texture,u.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const r of this.effects)r.setSize(e,t)}initialize(e,t,r){this.renderer=e;for(const i of this.effects)i.initialize(e,t,r);this.updateMaterial(),r!==void 0&&r!==ue&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}};function rs(e,t){j(t,!0);const r=Zt(),i=()=>it(p,"$camera",r),a=()=>it(l,"$size",r),{scene:u,renderer:c,camera:p,size:l,autoRender:s,renderStage:f}=gr(),n=new Yr(c);k(()=>{n.removeAllPasses(),n.addPass(new Yi(u,i())),n.addPass(new ts(i(),new Xi({intensity:.8,luminanceThreshold:.15,height:1024,width:1024,luminanceSmoothing:.5,mipmapBlur:!0,kernelSize:Le.MEDIUM})))}),k(()=>{const o=a().width*window.devicePixelRatio,v=a().height*window.devicePixelRatio;n.setSize(o,v)}),k(()=>{const o=s.current;return s.set(!1),()=>s.set(o)}),xr(o=>{n.render(o)},{stage:f,autoInvalidate:!1}),K()}var is=H("<!> <!>",1);function ss(e,t){j(t,!0);var r=is(),i=O(r);rs(i,{});var a=F(i,2);Ne(a,()=>t.children),A(e,r),K()}function ns(e,t){j(t,!1),Mt(r=>{if(document.startViewTransition)return new Promise(i=>{document.startViewTransition(async()=>{i(),await r.complete})})}),me(ge.PreviousPage,()=>ot(-1)),me(ge.NextPage,()=>ot(1)),He(),K()}const as=e=>e;function Nt(e,{delay:t=0,duration:r=400,easing:i=as}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:r,easing:i,css:u=>`opacity: ${u*a}`}}const pt=(e,t=te,r=te)=>{var i=os();i.__click=function(...u){var c;(c=r())==null||c.apply(this,u)};var a=F(I(i));D(i),fe(()=>Te(a,` ${t()??""}`)),A(e,i)};var os=H('<button class="flex gap-1 bg-zinc-900 px-2 py-1 text-xs text-slate-100"><svg id="icon-spotify" viewBox="0 0 24 28" class="h-4 fill-slate-100"><path d="M17.609 18.906c0-0.438-0.172-0.609-0.469-0.797-2.016-1.203-4.359-1.797-6.984-1.797-1.531 0-3 0.203-4.484 0.531-0.359 0.078-0.656 0.313-0.656 0.812 0 0.391 0.297 0.766 0.766 0.766 0.141 0 0.391-0.078 0.578-0.125 1.219-0.25 2.5-0.422 3.797-0.422 2.297 0 4.469 0.562 6.203 1.609 0.187 0.109 0.313 0.172 0.516 0.172 0.391 0 0.734-0.313 0.734-0.75zM19.109 15.547c0-0.422-0.156-0.719-0.547-0.953-2.391-1.422-5.422-2.203-8.563-2.203-2.016 0-3.391 0.281-4.734 0.656-0.5 0.141-0.75 0.484-0.75 1s0.422 0.938 0.938 0.938c0.219 0 0.344-0.063 0.578-0.125 1.094-0.297 2.406-0.516 3.922-0.516 2.969 0 5.672 0.781 7.625 1.937 0.172 0.094 0.344 0.203 0.594 0.203 0.531 0 0.938-0.422 0.938-0.938zM20.797 11.672c0-0.578-0.25-0.875-0.625-1.094-2.703-1.578-6.406-2.312-9.938-2.312-2.078 0-3.984 0.234-5.688 0.734-0.438 0.125-0.844 0.5-0.844 1.156 0 0.641 0.484 1.141 1.125 1.141 0.234 0 0.453-0.078 0.625-0.125 1.516-0.422 3.156-0.578 4.797-0.578 3.25 0 6.625 0.719 8.797 2.016 0.219 0.125 0.375 0.187 0.625 0.187 0.594 0 1.125-0.469 1.125-1.125zM24 14c0 6.625-5.375 12-12 12s-12-5.375-12-12 5.375-12 12-12 12 5.375 12 12z"></path></svg> </button>'),ls=H("<div><!></div>");function us(e,t){j(t,!1);const{authenticated:r,login:i,logout:a}=Rt();He();var u=ls(),c=I(u);{var p=s=>{var f=Ft("...");A(s,f)},l=s=>{var f=Q(),n=O(f);{var o=d=>{var h=$e(()=>()=>a());pt(d,()=>"Logout Spotify",()=>T(h))},v=d=>{var h=Q(),y=O(h);{var w=g=>{var S=$e(()=>()=>i());pt(g,()=>"Connect Spotify",()=>T(S))};V(y,g=>{r.current==="logged-out"&&g(w)},!0)}A(d,h)};V(n,d=>{r.current==="logged-in"?d(o):d(v,!1)},!0)}A(s,f)};V(c,s=>{r.current==="pending"?s(p):s(l,!1)})}D(u),A(e,u),K()}wt(["click"]);var cs=(e,t)=>Ie(t,T(t).current=!T(t).current),hs=H('<button class="absolute right-2 top-2 z-10 h-6 w-6 p-1" aria-label="Open settings"><svg class="h-full fill-white" viewBox="0 0 32 32"><path d="M13,16c0,1.65,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S13,14.34,13,16z"></path><path d="M13,26c0,1.65,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S13,24.34,13,26z"></path><path d="M13,6c0,1.654,1.34,3,3,3s3-1.34,3-3s-1.34-3-3-3S13,4.34,13,6z"></path></svg></button>'),fs=(e,t)=>{e.target===e.currentTarget&&Ie(t,T(t).current=!1)},ds=H('<button aria-label="Exit settings" class="absolute left-0 top-0 z-20 grid h-screen w-screen cursor-default bg-black opacity-80"></button> <div class="pointer-events-none absolute left-0 top-0 z-20 grid h-screen w-screen place-content-center"><div class="pointer-events-auto h-44 w-80 rounded-sm bg-white p-2 shadow-xl"><div class="-mt-10 mb-4 flex w-full justify-center"><img alt="" width="200" src="/zestyplus2.png"></div> <div class="flex justify-center"><!></div></div></div>',1),vs=H("<!> <!>",1);function ps(e,t){j(t,!1);const r=mt(new Fe("settings-open",!1)),i=new Hr({timeout:3e3});me(ge.Settings,()=>Ie(r,T(r).current=!T(r).current)),He();var a=vs(),u=O(a);{var c=s=>{var f=hs();f.__click=[cs,r],Ut(3,f,()=>Nt),A(s,f)};V(u,s=>{i.current||s(c)})}var p=F(u,2);{var l=s=>{var f=ds(),n=O(f);n.__click=[fs,r];var o=F(n,2),v=I(o),d=F(I(v),2),h=I(d);us(h,{}),D(d),D(v),D(o),A(s,f)};V(p,s=>{T(r).current&&s(l)})}A(e,a),K()}wt(["click"]);var ms=H('<span class="svelte-101a3xu"> </span>'),gs=H('<div class="absolute bottom-0 left-0 flex items-end gap-1.5 p-4 text-white"><div class="h-[120px] w-[120px] overflow-hidden rounded-lg shadow-2xl"><img class="select-none" width="120" height="120"></div> <div class="flex flex-col gap-1 px-2 py-2"><p class="text-lg font-bold leading-none"> </p> <p class="text-xs leading-none opacity-75"></p></div></div>');function xs(e,t){j(t,!1);const{track:r}=Ct(),i=mt(new Fe("trackinfo-visible",!0));me(ge.TrackInfo,()=>Ie(i,T(i).current=!T(i).current)),He();var a=Q(),u=O(a);{var c=p=>{var l=gs();const s=$e(()=>{const{item:y}=r.current;return{item:y}});var f=I(l),n=I(f);D(f);var o=F(f,2),v=I(o),d=I(v,!0);D(v);var h=F(v,2);bt(h,5,()=>T(s).item.artists,y=>y.name,(y,w)=>{var g=ms(),S=I(g,!0);D(g),fe(()=>Te(S,T(w).name)),A(y,g)}),D(h),D(o),D(l),fe(()=>{je(n,"alt",T(s).item.album.name),je(n,"src",T(s).item.album.images[0].url),Te(d,T(s).item.name)}),Ut(3,l,()=>Nt,()=>({duration:200})),A(p,l)};V(u,p=>{T(i).current&&r.current&&p(c)})}A(e,a),K()}const Ss=(e,t)=>{const r=e.getTime()-Date.now();if(r>0){const i=setTimeout(t,r);return()=>clearTimeout(i)}else return console.error("Target time is in the past. Check system clock."),()=>{}},ys=(e=1)=>{const t=new Date().getFullYear()+1,r=new Date(t,0,1,0,0,0);return new Date(r.getTime()-6e4*e)},Ts=e=>{const t=Math.floor(e/1e3),r=Math.floor(t/60).toString(),i=(t%60).toString().padStart(2,"0");return`${r}:${i}`};var Es=H('<div class="z-1 pointer-events-none absolute grid h-full w-full place-content-center text-8xl text-white svelte-xkzlrh"><div class="flex gap-2 svelte-xkzlrh">🫲 <div class="w-48 svelte-xkzlrh"> </div> 🫱</div></div>'),_s=H('<div class="emoji absolute svelte-xkzlrh"> </div>'),ws=H('<div class="z-1 pointer-events-none absolute h-full w-full place-content-center text-8xl text-white svelte-xkzlrh"></div>');function Ms(e,t){j(t,!0);const r=["👺","😱","🤩","🥳","😘","🤌","👏","🫶","💥","🍾","🎺","🎻","🎉","🎊","🪩","🙂‍↕️","🤝","🤙","🫂","🤸","💸","📈","🎈","🧘‍♀️","🏄‍♂️","🫵"];let i=Z([]),a=-1,u=W("idle"),c=W(""),p=W(!1);const l=()=>{const y=new Date().getTime(),w=a-y;P(c,Z(Ts(w))),y<=a?requestAnimationFrame(l):P(u,"celebrating")},s=()=>{P(u,"counting"),requestAnimationFrame(l)},f=()=>{const h={emoji:r.at((Math.random()*r.length|0)-1)??"",x:Math.random()*100,y:Math.random()*100};i.push(h),i.length>50&&i.shift()};k(()=>{const h=ys(10);return a=h.getTime(),Ss(h,s)}),k(()=>{if(T(u)==="celebrating"){setInterval(f,500);const h=1e3*60*3;setTimeout(()=>{P(p,!0),setTimeout(()=>{P(u,"idle")},h)},h)}});var n=Q(),o=O(n);{var v=h=>{var y=Es(),w=I(y),g=F(I(w)),S=I(g,!0);D(g),Xt(),D(w),D(y),fe(()=>Te(S,T(c))),A(h,y)},d=h=>{var y=Q(),w=O(y);{var g=S=>{var m=ws();bt(m,21,()=>i,Er,(x,E)=>{let b=()=>T(E).emoji,B=()=>T(E).x,M=()=>T(E).y;var _=_s(),$=I(_,!0);D(_),fe(()=>{je(_,"style",`left: ${B()??""}%; top: ${M()??""}%`),Te($,b())}),A(x,_)}),D(m),fe(()=>_r(m,"fading",T(p))),A(S,m)};V(w,S=>{T(u)==="celebrating"&&S(g)},!0)}A(h,y)};V(o,h=>{T(u)==="counting"?h(v):h(d,!1)})}A(e,n),K()}let Ot=null;class Ht{}Ht.render=function(e,t){Ot(e,t)};self.QrCreator=Ht;(function(e){function t(p,l,s,f){var n={},o=e(s,l);o.u(p),o.J(),f=f||0;var v=o.h(),d=o.h()+2*f;return n.text=p,n.level=l,n.version=s,n.O=d,n.a=function(h,y){return h-=f,y-=f,0>h||h>=v||0>y||y>=v?!1:o.a(h,y)},n}function r(p,l,s,f,n,o,v,d,h,y){function w(g,S,m,x,E,b,B){g?(p.lineTo(S+b,m+B),p.arcTo(S,m,x,E,o)):p.lineTo(S,m)}v?p.moveTo(l+o,s):p.moveTo(l,s),w(d,f,s,f,n,-o,0),w(h,f,n,l,n,0,-o),w(y,l,n,l,s,o,0),w(v,l,s,f,s,0,o)}function i(p,l,s,f,n,o,v,d,h,y){function w(g,S,m,x){p.moveTo(g+m,S),p.lineTo(g,S),p.lineTo(g,S+x),p.arcTo(g,S,g+m,S,o)}v&&w(l,s,o,o),d&&w(f,s,-o,o),h&&w(f,n,-o,-o),y&&w(l,n,o,-o)}function a(p,l){var s=l.fill;if(typeof s=="string")p.fillStyle=s;else{var f=s.type,n=s.colorStops;if(s=s.position.map(v=>Math.round(v*l.size)),f==="linear-gradient")var o=p.createLinearGradient.apply(p,s);else if(f==="radial-gradient")o=p.createRadialGradient.apply(p,s);else throw Error("Unsupported fill");n.forEach(([v,d])=>{o.addColorStop(v,d)}),p.fillStyle=o}}function u(p,l){e:{var s=l.text,f=l.v,n=l.N,o=l.K,v=l.P;for(n=Math.max(1,n||1),o=Math.min(40,o||40);n<=o;n+=1)try{var d=t(s,f,n,v);break e}catch{}d=void 0}if(!d)return null;for(s=p.getContext("2d"),l.background&&(s.fillStyle=l.background,s.fillRect(l.left,l.top,l.size,l.size)),f=d.O,o=l.size/f,s.beginPath(),v=0;v<f;v+=1)for(n=0;n<f;n+=1){var h=s,y=l.left+n*o,w=l.top+v*o,g=v,S=n,m=d.a,x=y+o,E=w+o,b=g-1,B=g+1,M=S-1,_=S+1,$=Math.floor(Math.min(.5,Math.max(0,l.R))*o),J=m(g,S),se=m(b,M),Re=m(b,S);b=m(b,_);var be=m(g,_);_=m(B,_),S=m(B,S),B=m(B,M),g=m(g,M),y=Math.round(y),w=Math.round(w),x=Math.round(x),E=Math.round(E),J?r(h,y,w,x,E,$,!Re&&!g,!Re&&!be,!S&&!be,!S&&!g):i(h,y,w,x,E,$,Re&&g&&se,Re&&be&&b,S&&be&&_,S&&g&&B)}return a(s,l),s.fill(),p}var c={minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:200,fill:"#000",background:null,text:"no text",radius:.5,quiet:0};Ot=function(p,l){var s={};Object.assign(s,c,p),s.N=s.minVersion,s.K=s.maxVersion,s.v=s.ecLevel,s.left=s.left,s.top=s.top,s.size=s.size,s.fill=s.fill,s.background=s.background,s.text=s.text,s.R=s.radius,s.P=s.quiet,l instanceof HTMLCanvasElement?((l.width!==s.size||l.height!==s.size)&&(l.width=s.size,l.height=s.size),l.getContext("2d").clearRect(0,0,l.width,l.height),u(l,s)):(p=document.createElement("canvas"),p.width=s.size,p.height=s.size,s=u(p,s),l.appendChild(s))}})(function(){function e(l){var s=r.s(l);return{S:function(){return 4},b:function(){return s.length},write:function(f){for(var n=0;n<s.length;n+=1)f.put(s[n],8)}}}function t(){var l=[],s=0,f={B:function(){return l},c:function(n){return(l[Math.floor(n/8)]>>>7-n%8&1)==1},put:function(n,o){for(var v=0;v<o;v+=1)f.m((n>>>o-v-1&1)==1)},f:function(){return s},m:function(n){var o=Math.floor(s/8);l.length<=o&&l.push(0),n&&(l[o]|=128>>>s%8),s+=1}};return f}function r(l,s){function f(g,S){for(var m=-1;7>=m;m+=1)if(!(-1>=g+m||d<=g+m))for(var x=-1;7>=x;x+=1)-1>=S+x||d<=S+x||(v[g+m][S+x]=0<=m&&6>=m&&(x==0||x==6)||0<=x&&6>=x&&(m==0||m==6)||2<=m&&4>=m&&2<=x&&4>=x)}function n(g,S){for(var m=d=4*l+17,x=Array(m),E=0;E<m;E+=1){x[E]=Array(m);for(var b=0;b<m;b+=1)x[E][b]=null}for(v=x,f(0,0),f(d-7,0),f(0,d-7),m=u.G(l),x=0;x<m.length;x+=1)for(E=0;E<m.length;E+=1){b=m[x];var B=m[E];if(v[b][B]==null)for(var M=-2;2>=M;M+=1)for(var _=-2;2>=_;_+=1)v[b+M][B+_]=M==-2||M==2||_==-2||_==2||M==0&&_==0}for(m=8;m<d-8;m+=1)v[m][6]==null&&(v[m][6]=m%2==0);for(m=8;m<d-8;m+=1)v[6][m]==null&&(v[6][m]=m%2==0);for(m=u.w(o<<3|S),x=0;15>x;x+=1)E=!g&&(m>>x&1)==1,v[6>x?x:8>x?x+1:d-15+x][8]=E,v[8][8>x?d-x-1:9>x?15-x:14-x]=E;if(v[d-8][8]=!g,7<=l){for(m=u.A(l),x=0;18>x;x+=1)E=!g&&(m>>x&1)==1,v[Math.floor(x/3)][x%3+d-8-3]=E;for(x=0;18>x;x+=1)E=!g&&(m>>x&1)==1,v[x%3+d-8-3][Math.floor(x/3)]=E}if(h==null){for(g=p.I(l,o),m=t(),x=0;x<y.length;x+=1)E=y[x],m.put(4,4),m.put(E.b(),u.f(4,l)),E.write(m);for(x=E=0;x<g.length;x+=1)E+=g[x].j;if(m.f()>8*E)throw Error("code length overflow. ("+m.f()+">"+8*E+")");for(m.f()+4<=8*E&&m.put(0,4);m.f()%8!=0;)m.m(!1);for(;!(m.f()>=8*E)&&(m.put(236,8),!(m.f()>=8*E));)m.put(17,8);var $=0;for(E=x=0,b=Array(g.length),B=Array(g.length),M=0;M<g.length;M+=1){var J=g[M].j,se=g[M].o-J;for(x=Math.max(x,J),E=Math.max(E,se),b[M]=Array(J),_=0;_<b[M].length;_+=1)b[M][_]=255&m.B()[_+$];for($+=J,_=u.C(se),J=i(b[M],_.b()-1).l(_),B[M]=Array(_.b()-1),_=0;_<B[M].length;_+=1)se=_+J.b()-B[M].length,B[M][_]=0<=se?J.c(se):0}for(_=m=0;_<g.length;_+=1)m+=g[_].o;for(m=Array(m),_=$=0;_<x;_+=1)for(M=0;M<g.length;M+=1)_<b[M].length&&(m[$]=b[M][_],$+=1);for(_=0;_<E;_+=1)for(M=0;M<g.length;M+=1)_<B[M].length&&(m[$]=B[M][_],$+=1);h=m}for(g=h,m=-1,x=d-1,E=7,b=0,S=u.F(S),B=d-1;0<B;B-=2)for(B==6&&--B;;){for(M=0;2>M;M+=1)v[x][B-M]==null&&(_=!1,b<g.length&&(_=(g[b]>>>E&1)==1),S(x,B-M)&&(_=!_),v[x][B-M]=_,--E,E==-1&&(b+=1,E=7));if(x+=m,0>x||d<=x){x-=m,m=-m;break}}}var o=a[s],v=null,d=0,h=null,y=[],w={u:function(g){g=e(g),y.push(g),h=null},a:function(g,S){if(0>g||d<=g||0>S||d<=S)throw Error(g+","+S);return v[g][S]},h:function(){return d},J:function(){for(var g=0,S=0,m=0;8>m;m+=1){n(!0,m);var x=u.D(w);(m==0||g>x)&&(g=x,S=m)}n(!1,S)}};return w}function i(l,s){if(typeof l.length>"u")throw Error(l.length+"/"+s);var f=function(){for(var o=0;o<l.length&&l[o]==0;)o+=1;for(var v=Array(l.length-o+s),d=0;d<l.length-o;d+=1)v[d]=l[d+o];return v}(),n={c:function(o){return f[o]},b:function(){return f.length},multiply:function(o){for(var v=Array(n.b()+o.b()-1),d=0;d<n.b();d+=1)for(var h=0;h<o.b();h+=1)v[d+h]^=c.i(c.g(n.c(d))+c.g(o.c(h)));return i(v,0)},l:function(o){if(0>n.b()-o.b())return n;for(var v=c.g(n.c(0))-c.g(o.c(0)),d=Array(n.b()),h=0;h<n.b();h+=1)d[h]=n.c(h);for(h=0;h<o.b();h+=1)d[h]^=c.i(c.g(o.c(h))+v);return i(d,0).l(o)}};return n}r.s=function(l){for(var s=[],f=0;f<l.length;f++){var n=l.charCodeAt(f);128>n?s.push(n):2048>n?s.push(192|n>>6,128|n&63):55296>n||57344<=n?s.push(224|n>>12,128|n>>6&63,128|n&63):(f++,n=65536+((n&1023)<<10|l.charCodeAt(f)&1023),s.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63))}return s};var a={L:1,M:0,Q:3,H:2},u=function(){function l(n){for(var o=0;n!=0;)o+=1,n>>>=1;return o}var s=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],f={w:function(n){for(var o=n<<10;0<=l(o)-l(1335);)o^=1335<<l(o)-l(1335);return(n<<10|o)^21522},A:function(n){for(var o=n<<12;0<=l(o)-l(7973);)o^=7973<<l(o)-l(7973);return n<<12|o},G:function(n){return s[n-1]},F:function(n){switch(n){case 0:return function(o,v){return(o+v)%2==0};case 1:return function(o){return o%2==0};case 2:return function(o,v){return v%3==0};case 3:return function(o,v){return(o+v)%3==0};case 4:return function(o,v){return(Math.floor(o/2)+Math.floor(v/3))%2==0};case 5:return function(o,v){return o*v%2+o*v%3==0};case 6:return function(o,v){return(o*v%2+o*v%3)%2==0};case 7:return function(o,v){return(o*v%3+(o+v)%2)%2==0};default:throw Error("bad maskPattern:"+n)}},C:function(n){for(var o=i([1],0),v=0;v<n;v+=1)o=o.multiply(i([1,c.i(v)],0));return o},f:function(n,o){if(n!=4||1>o||40<o)throw Error("mode: "+n+"; type: "+o);return 10>o?8:16},D:function(n){for(var o=n.h(),v=0,d=0;d<o;d+=1)for(var h=0;h<o;h+=1){for(var y=0,w=n.a(d,h),g=-1;1>=g;g+=1)if(!(0>d+g||o<=d+g))for(var S=-1;1>=S;S+=1)0>h+S||o<=h+S||(g!=0||S!=0)&&w==n.a(d+g,h+S)&&(y+=1);5<y&&(v+=3+y-5)}for(d=0;d<o-1;d+=1)for(h=0;h<o-1;h+=1)y=0,n.a(d,h)&&(y+=1),n.a(d+1,h)&&(y+=1),n.a(d,h+1)&&(y+=1),n.a(d+1,h+1)&&(y+=1),(y==0||y==4)&&(v+=3);for(d=0;d<o;d+=1)for(h=0;h<o-6;h+=1)n.a(d,h)&&!n.a(d,h+1)&&n.a(d,h+2)&&n.a(d,h+3)&&n.a(d,h+4)&&!n.a(d,h+5)&&n.a(d,h+6)&&(v+=40);for(h=0;h<o;h+=1)for(d=0;d<o-6;d+=1)n.a(d,h)&&!n.a(d+1,h)&&n.a(d+2,h)&&n.a(d+3,h)&&n.a(d+4,h)&&!n.a(d+5,h)&&n.a(d+6,h)&&(v+=40);for(h=y=0;h<o;h+=1)for(d=0;d<o;d+=1)n.a(d,h)&&(y+=1);return v+=Math.abs(100*y/o/o-50)/5*10}};return f}(),c=function(){for(var l=Array(256),s=Array(256),f=0;8>f;f+=1)l[f]=1<<f;for(f=8;256>f;f+=1)l[f]=l[f-4]^l[f-5]^l[f-6]^l[f-8];for(f=0;255>f;f+=1)s[l[f]]=f;return{g:function(n){if(1>n)throw Error("glog("+n+")");return s[n]},i:function(n){for(;0>n;)n+=255;for(;256<=n;)n-=255;return l[n]}}}(),p=function(){function l(n,o){switch(o){case a.L:return s[4*(n-1)];case a.M:return s[4*(n-1)+1];case a.Q:return s[4*(n-1)+2];case a.H:return s[4*(n-1)+3]}}var s=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],f={I:function(n,o){var v=l(n,o);if(typeof v>"u")throw Error("bad rs block @ typeNumber:"+n+"/errorCorrectLevel:"+o);n=v.length/3,o=[];for(var d=0;d<n;d+=1)for(var h=v[3*d],y=v[3*d+1],w=v[3*d+2],g=0;g<h;g+=1){var S=w,m={};m.o=y,m.j=S,o.push(m)}return o}};return f}();return r}());const Rs=QrCreator;var bs=H('<div class="z-1 inline-flex w-24 p-4 svelte-x226nl"></div>');function Bs(e,t){j(t,!0);const r=new Fe("show-playlist-qr-code",!1),{track:i}=Ct();let a=W(void 0),u=Ce(()=>{var s,f,n;return(n=(f=(s=i.current)==null?void 0:s.context)==null?void 0:f.external_urls)==null?void 0:n.spotify});k(()=>{T(a)!==void 0&&T(u)!==void 0&&Rs.render({text:T(u),radius:0,ecLevel:"H",fill:"#fff",background:null,size:128},T(a))}),me(ge.QRCode,()=>r.current=!r.current);var c=Q(),p=O(c);{var l=s=>{var f=bs();We(f,n=>P(a,n),()=>T(a)),A(s,f)};V(p,s=>{r.current&&T(u)&&s(l)})}A(e,c),K()}var Us=H('<div class="costco h-screen svelte-1qo5hw6"><img class="costco absolute left-0 scale-[2.5] opacity-20 svelte-1qo5hw6" src="costco.png" alt=""></div>');function zs(e,t){j(t,!0);let r=W(!1),i=1e3*20;k(()=>{function p(){Math.random()>0?(P(r,!0),setTimeout(()=>{P(r,!1),setTimeout(p,i)},20*1e3)):setTimeout(p,i)}p()});var a=Q(),u=O(a);{var c=p=>{var l=Us();A(p,l)};V(u,p=>{T(r)&&p(c)})}A(e,a),K()}var As=H('<div class="absolute left-0 top-0 h-screen w-screen"><!></div> <!> <!> <!> <!> <!> <!>',1);function Js(e,t){j(t,!0);const{startAnalyser:r}=yr();k(()=>void r());let i=-1;k(()=>{clearTimeout(i),i=lt()}),Mt(()=>{clearTimeout(i),i=lt()});let a=new Fe("costco-mode",!1);me(ge.CostcoMode,()=>a.current=!a.current);var u=As(),c=O(u),p=I(c);Ar(p,{children:(h,y)=>{var w=Q(),g=O(w);{var S=m=>{ss(m,{children:(x,E)=>{var b=Q(),B=O(b);Ne(B,()=>t.children),A(x,b)},$$slots:{default:!0}})};V(g,m=>{m(S,!1)})}A(h,w)},$$slots:{default:!0}}),D(c);var l=F(c,2);ns(l,{});var s=F(l,2);ps(s,{});var f=F(s,2);xs(f,{});var n=F(f,2);Ms(n,{});var o=F(n,2);Bs(o,{});var v=F(o,2);{var d=h=>{zs(h,{})};V(v,h=>{a.current&&h(d)})}A(e,u),K()}export{Js as component};
