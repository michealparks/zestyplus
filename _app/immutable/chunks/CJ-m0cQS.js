import"./DsnmJJEf.js";import{a4 as $,a5 as nt,u as et,h as P,Z as Tt,$ as pt,a0 as q,a6 as K,a1 as F,_ as It,a2 as Xt,a3 as it,b as wt,ac as Zt,aq as vt}from"./E4cMcrld.js";import{i as zt}from"./BKdKABQE.js";import{c as st}from"./B2tXmoWB.js";import{b as $t}from"./C-8VaPx3.js";import{p as Z,b as Wt,s as Bt,r as te,a as Ht}from"./DdtPJMXq.js";import{g0 as Qt,g5 as ot,aM as ee,aO as ne,g1 as Ct,g6 as ie,fZ as oe,f_ as R,dF as se,V as h,bg as O,f8 as ae,_ as At,ai as Ut,aq as re,bf as Y,ah as A,ae as Lt,af as jt,x as r,eM as yt,es as B,fB as at,bi as le,E as ce,M as Nt,b7 as he,q as Vt,ao as pe}from"./CpNDQYbB.js";import"./Cm1KWnRq.js";import{s as Jt}from"./DwTxxjll.js";import{u as ue}from"./CvHOVtnq.js";const de=l=>{const{invalidate:e}=Qt();ot(()=>[l.scene],([i])=>{const{background:s,environment:t}=i;return()=>{i.background=s,i.environment=t}});let n=nt(void 0),o=nt(void 0);ot(()=>[l.scene],([i])=>{$(n,i.background,!0),$(o,i.environment,!0)}),et(()=>{if(!(l.texture===void 0||!l.isBackground))return l.scene.background=l.texture,e(),()=>{P(n)!==void 0&&(l.scene.background=P(n),e())}}),et(()=>{if(l.texture!==void 0)return l.scene.environment=l.texture,e(),()=>{P(o)!==void 0&&(l.scene.environment=P(o),e())}})},me=1,Pt=1e3,fe=256,we=(l=()=>Pt,e=()=>Pt,n=()=>fe)=>{const o=new ee(n()),i=new ne(me,Pt,o);return et(()=>{const s=n();o.setSize(s,s)}),et(()=>{const s=l();for(const t of i.children)Ct(t,"PerspectiveCamera")&&(t.near=s,t.updateProjectionMatrix())}),et(()=>{const s=e();for(const t of i.children)Ct(t,"PerspectiveCamera")&&(t.far=s,t.updateProjectionMatrix())}),et(()=>()=>{o.dispose()}),{camera:i,renderTarget:o}};var ye=pt("<!> <!>",1);function _e(l,e){Tt(e,!0);const n=()=>Bt(g,"$started",o),[o,i]=Wt(),s=Qt();let t=Z(e,"far",3,1e3),a=Z(e,"frames",3,1/0),f=Z(e,"isBackground",3,!1),m=Z(e,"near",3,.1),y=Z(e,"resolution",3,256),T=Z(e,"scene",19,()=>s.scene);const{scene:S}=ie(),{camera:E,renderTarget:L}=we(()=>m(),()=>t(),()=>y());de({texture:L.texture,get scene(){return T()},get isBackground(){return f()}});const x=()=>{E.update(s.renderer,S)};let u=0;const{start:w,stop:_,started:g}=oe(()=>{u<a()?(x(),u+=1):(_(),e.onupdatestop?.())},{autoStart:!1}),b=()=>{n()&&(_(),e.onupdatestop?.()),u=0,w(),e.onupdatestart?.()};ot(()=>[t(),m(),a(),y()],b);var I={camera:E,renderTarget:L,update:x,restart:b};{let G=It(()=>e.visible?void 0:!1);R(l,{get is(){return S},get attach(){return P(G)},children:(W,H)=>{var c=ye(),v=q(c);R(v,{get is(){return E}});var X=it(v,2);Jt(X,()=>e.children??K,()=>({camera:E,renderTarget:L,restart:b,update:x})),F(W,c)},$$slots:{default:!0}})}var z=Xt(I);return i(),z}const V=new ae,M=new h,U=new h,d=new O,kt={X:new h(1,0,0),Y:new h(0,1,0),Z:new h(0,0,1)},St={type:"change"},Dt={type:"mouseDown",mode:null},Ot={type:"mouseUp",mode:null},qt={type:"objectChange"};class ge extends se{constructor(e,n=null){super(void 0,n);const o=new Me(this);this._root=o;const i=new Ee;this._gizmo=i,o.add(i);const s=new Ie;this._plane=s,o.add(s);const t=this;function a(g,b){let I=b;Object.defineProperty(t,g,{get:function(){return I!==void 0?I:b},set:function(z){I!==z&&(I=z,s[g]=z,i[g]=z,t.dispatchEvent({type:g+"-changed",value:z}),t.dispatchEvent(St))}}),t[g]=b,s[g]=b,i[g]=b}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const f=new h,m=new h,y=new O,T=new O,S=new h,E=new O,L=new h,x=new h,u=new h,w=0,_=new h;a("worldPosition",f),a("worldPositionStart",m),a("worldQuaternion",y),a("worldQuaternionStart",T),a("cameraPosition",S),a("cameraQuaternion",E),a("pointStart",L),a("pointEnd",x),a("rotationAxis",u),a("rotationAngle",w),a("eye",_),this._offset=new h,this._startNorm=new h,this._endNorm=new h,this._cameraScale=new h,this._parentPosition=new h,this._parentQuaternion=new O,this._parentQuaternionInv=new O,this._parentScale=new h,this._worldScaleStart=new h,this._worldQuaternionInv=new O,this._worldScale=new h,this._positionStart=new h,this._quaternionStart=new O,this._scaleStart=new h,this._getPointer=be.bind(this),this._onPointerDown=xe.bind(this),this._onPointerHover=ve.bind(this),this._onPointerMove=Pe.bind(this),this._onPointerUp=Se.bind(this),n!==null&&this.connect(n)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&V.setFromCamera(e,this.camera);const n=Mt(this._gizmo.picker[this.mode],V);n?this.axis=n.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&V.setFromCamera(e,this.camera);const n=Mt(this._plane,V,!0);n&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(n.point).sub(this.worldPositionStart)),this.dragging=!0,Dt.mode=this.mode,this.dispatchEvent(Dt)}}pointerMove(e){const n=this.axis,o=this.mode,i=this.object;let s=this.space;if(o==="scale"?s="local":(n==="E"||n==="XYZE"||n==="XYZ")&&(s="world"),i===void 0||n===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&V.setFromCamera(e,this.camera);const t=Mt(this._plane,V,!0);if(t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),o==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&n!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),n.indexOf("X")===-1&&(this._offset.x=0),n.indexOf("Y")===-1&&(this._offset.y=0),n.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&n!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(i.position.applyQuaternion(d.copy(this._quaternionStart).invert()),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),s==="world"&&(i.parent&&i.position.add(M.setFromMatrixPosition(i.parent.matrixWorld)),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(M.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if(o==="scale"){if(n.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),U.set(a,a,a)}else M.copy(this.pointStart),U.copy(this.pointEnd),M.applyQuaternion(this._worldQuaternionInv),U.applyQuaternion(this._worldQuaternionInv),U.divide(M),n.search("X")===-1&&(U.x=1),n.search("Y")===-1&&(U.y=1),n.search("Z")===-1&&(U.z=1);i.scale.copy(this._scaleStart).multiply(U),this.scaleSnap&&(n.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(M.setFromMatrixPosition(this.camera.matrixWorld));let f=!1;n==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(M.copy(this.rotationAxis).cross(this.eye))*a):(n==="X"||n==="Y"||n==="Z")&&(this.rotationAxis.copy(kt[n]),M.copy(kt[n]),s==="local"&&M.applyQuaternion(this.worldQuaternion),M.cross(this.eye),M.length()===0?f=!0:this.rotationAngle=this._offset.dot(M.normalize())*a),(n==="E"||f)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&n!=="E"&&n!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(d.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(St),this.dispatchEvent(qt)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Ot.mode=this.mode,this.dispatchEvent(Ot)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(St),this.dispatchEvent(qt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return V}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}setColors(e,n,o,i){const s=this._gizmo.materialLib;s.xAxis.color.set(e),s.yAxis.color.set(n),s.zAxis.color.set(o),s.active.color.set(i),s.xAxisTransparent.color.set(e),s.yAxisTransparent.color.set(n),s.zAxisTransparent.color.set(o),s.activeTransparent.color.set(i),s.xAxis._color&&s.xAxis._color.set(e),s.yAxis._color&&s.yAxis._color.set(n),s.zAxis._color&&s.zAxis._color.set(o),s.active._color&&s.active._color.set(i),s.xAxisTransparent._color&&s.xAxisTransparent._color.set(e),s.yAxisTransparent._color&&s.yAxisTransparent._color.set(n),s.zAxisTransparent._color&&s.zAxisTransparent._color.set(o),s.activeTransparent._color&&s.activeTransparent._color.set(i)}}function be(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function ve(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function xe(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function Pe(l){this.enabled&&this.pointerMove(this._getPointer(l))}function Se(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function Mt(l,e,n){const o=e.intersectObject(l,!0);for(let i=0;i<o.length;i++)if(o[i].object.visible||n)return o[i];return!1}const _t=new ce,p=new h(0,1,0),Ft=new h(0,0,0),Rt=new Nt,gt=new O,xt=new O,D=new h,Gt=new Nt,ct=new h(1,0,0),J=new h(0,1,0),ht=new h(0,0,1),bt=new h,rt=new h,lt=new h;class Me extends At{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const n=this.controls;n.object!==void 0&&(n.object.updateMatrixWorld(),n.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):n.object.parent.matrixWorld.decompose(n._parentPosition,n._parentQuaternion,n._parentScale),n.object.matrixWorld.decompose(n.worldPosition,n.worldQuaternion,n._worldScale),n._parentQuaternionInv.copy(n._parentQuaternion).invert(),n._worldQuaternionInv.copy(n.worldQuaternion).invert()),n.camera.updateMatrixWorld(),n.camera.matrixWorld.decompose(n.cameraPosition,n.cameraQuaternion,n._cameraScale),n.camera.isOrthographicCamera?n.camera.getWorldDirection(n.eye).negate():n.eye.copy(n.cameraPosition).sub(n.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class Ee extends At{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Ut({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=new re({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=e.clone();o.opacity=.15;const i=n.clone();i.opacity=.5;const s=e.clone();s.color.setHex(16711680);const t=e.clone();t.color.setHex(65280);const a=e.clone();a.color.setHex(255);const f=e.clone();f.color.setHex(16711680),f.opacity=.5;const m=e.clone();m.color.setHex(65280),m.opacity=.5;const y=e.clone();y.color.setHex(255),y.opacity=.5;const T=e.clone();T.opacity=.25;const S=e.clone();S.color.setHex(16776960),S.opacity=.25;const E=e.clone();E.color.setHex(16776960);const L=e.clone();L.color.setHex(7895160),this.materialLib={xAxis:s,yAxis:t,zAxis:a,active:E,xAxisTransparent:f,yAxisTransparent:m,zAxisTransparent:y,activeTransparent:S};const x=new Y(0,.04,.1,12);x.translate(0,.05,0);const u=new A(.08,.08,.08);u.translate(0,.04,0);const w=new Lt;w.setAttribute("position",new jt([0,0,0,1,0,0],3));const _=new Y(.0075,.0075,.5,3);_.translate(0,.25,0);function g(j,ut){const k=new at(j,.0075,3,64,ut*Math.PI*2);return k.rotateY(Math.PI/2),k.rotateX(Math.PI/2),k}function b(){const j=new Lt;return j.setAttribute("position",new jt([0,0,0,1,1,1],3)),j}const I={X:[[new r(x,s),[.5,0,0],[0,0,-Math.PI/2]],[new r(x,s),[-.5,0,0],[0,0,Math.PI/2]],[new r(_,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new r(x,t),[0,.5,0]],[new r(x,t),[0,-.5,0],[Math.PI,0,0]],[new r(_,t)]],Z:[[new r(x,a),[0,0,.5],[Math.PI/2,0,0]],[new r(x,a),[0,0,-.5],[-Math.PI/2,0,0]],[new r(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new r(new yt(.1,0),T),[0,0,0]]],XY:[[new r(new A(.15,.15,.01),y),[.15,.15,0]]],YZ:[[new r(new A(.15,.15,.01),f),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r(new A(.15,.15,.01),m),[.15,0,.15],[-Math.PI/2,0,0]]]},z={X:[[new r(new Y(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new r(new Y(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new r(new Y(.2,0,.6,4),o),[0,.3,0]],[new r(new Y(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new r(new Y(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new r(new Y(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new r(new yt(.2,0),o)]],XY:[[new r(new A(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new r(new A(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r(new A(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},G={START:[[new r(new yt(.01,2),i),null,null,null,"helper"]],END:[[new r(new yt(.01,2),i),null,null,null,"helper"]],DELTA:[[new B(b(),i),null,null,null,"helper"]],X:[[new B(w,i),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new B(w,i),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new B(w,i),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},W={XYZE:[[new r(g(.5,1),L),null,[0,Math.PI/2,0]]],X:[[new r(g(.5,.5),s)]],Y:[[new r(g(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new r(g(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new r(g(.75,1),S),null,[0,Math.PI/2,0]]]},H={AXIS:[[new B(w,i),[-1e3,0,0],null,[1e6,1,1],"helper"]]},c={XYZE:[[new r(new le(.25,10,8),o)]],X:[[new r(new at(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new r(new at(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new r(new at(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new r(new at(.75,.1,2,24),o)]]},v={X:[[new r(u,s),[.5,0,0],[0,0,-Math.PI/2]],[new r(_,s),[0,0,0],[0,0,-Math.PI/2]],[new r(u,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new r(u,t),[0,.5,0]],[new r(_,t)],[new r(u,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new r(u,a),[0,0,.5],[Math.PI/2,0,0]],[new r(_,a),[0,0,0],[Math.PI/2,0,0]],[new r(u,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new r(new A(.15,.15,.01),y),[.15,.15,0]]],YZ:[[new r(new A(.15,.15,.01),f),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r(new A(.15,.15,.01),m),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new r(new A(.1,.1,.1),T)]]},X={X:[[new r(new Y(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new r(new Y(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new r(new Y(.2,0,.6,4),o),[0,.3,0]],[new r(new Y(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new r(new Y(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new r(new Y(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new r(new A(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new r(new A(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r(new A(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new r(new A(.2,.2,.2),o),[0,0,0]]]},N={X:[[new B(w,i),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new B(w,i),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new B(w,i),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(j){const ut=new At;for(const k in j)for(let tt=j[k].length;tt--;){const Q=j[k][tt][0].clone(),dt=j[k][tt][1],mt=j[k][tt][2],ft=j[k][tt][3],Kt=j[k][tt][4];Q.name=k,Q.tag=Kt,dt&&Q.position.set(dt[0],dt[1],dt[2]),mt&&Q.rotation.set(mt[0],mt[1],mt[2]),ft&&Q.scale.set(ft[0],ft[1],ft[2]),Q.updateMatrix();const Yt=Q.geometry.clone();Yt.applyMatrix4(Q.matrix),Q.geometry=Yt,Q.renderOrder=1/0,Q.position.set(0,0,0),Q.rotation.set(0,0,0),Q.scale.set(1,1,1),ut.add(Q)}return ut}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(I)),this.add(this.gizmo.rotate=C(W)),this.add(this.gizmo.scale=C(v)),this.add(this.picker.translate=C(z)),this.add(this.picker.rotate=C(c)),this.add(this.picker.scale=C(X)),this.add(this.helper.translate=C(G)),this.add(this.helper.rotate=C(H)),this.add(this.helper.scale=C(N)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const o=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:xt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let s=0;s<i.length;s++){const t=i[s];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(a*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.visible=!!this.axis,this.axis==="X"&&(d.setFromEuler(_t.set(0,0,0)),t.quaternion.copy(o).multiply(d),Math.abs(p.copy(ct).applyQuaternion(o).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(d.setFromEuler(_t.set(0,0,Math.PI/2)),t.quaternion.copy(o).multiply(d),Math.abs(p.copy(J).applyQuaternion(o).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(d.setFromEuler(_t.set(0,Math.PI/2,0)),t.quaternion.copy(o).multiply(d),Math.abs(p.copy(ht).applyQuaternion(o).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(d.setFromEuler(_t.set(0,Math.PI/2,0)),p.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(Rt.lookAt(Ft,p,J)),t.quaternion.multiply(d),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),M.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),M.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(M),t.visible=this.dragging):(t.quaternion.copy(o),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(o),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(p.copy(ct).applyQuaternion(o).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(p.copy(J).applyQuaternion(o).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(p.copy(ht).applyQuaternion(o).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(p.copy(ht).applyQuaternion(o).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(p.copy(ct).applyQuaternion(o).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(p.copy(J).applyQuaternion(o).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&(gt.copy(o),p.copy(this.eye).applyQuaternion(d.copy(o).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(Rt.lookAt(this.eye,Ft,J)),t.name==="X"&&(d.setFromAxisAngle(ct,Math.atan2(-p.y,p.z)),d.multiplyQuaternions(gt,d),t.quaternion.copy(d)),t.name==="Y"&&(d.setFromAxisAngle(J,Math.atan2(p.x,p.z)),d.multiplyQuaternions(gt,d),t.quaternion.copy(d)),t.name==="Z"&&(d.setFromAxisAngle(ht,Math.atan2(p.y,p.x)),d.multiplyQuaternions(gt,d),t.quaternion.copy(d))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis?(t.material.color.copy(this.materialLib.active.color),t.material.opacity=1):this.axis.split("").some(function(f){return t.name===f})&&(t.material.color.copy(this.materialLib.active.color),t.material.opacity=1))}super.updateMatrixWorld(e)}}class Ie extends r{constructor(){super(new he(1e5,1e5,2,2),new Ut({visible:!1,wireframe:!0,side:Vt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let n=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(n="local"),bt.copy(ct).applyQuaternion(n==="local"?this.worldQuaternion:xt),rt.copy(J).applyQuaternion(n==="local"?this.worldQuaternion:xt),lt.copy(ht).applyQuaternion(n==="local"?this.worldQuaternion:xt),p.copy(rt),this.mode){case"translate":case"scale":switch(this.axis){case"X":p.copy(this.eye).cross(bt),D.copy(bt).cross(p);break;case"Y":p.copy(this.eye).cross(rt),D.copy(rt).cross(p);break;case"Z":p.copy(this.eye).cross(lt),D.copy(lt).cross(p);break;case"XY":D.copy(lt);break;case"YZ":D.copy(bt);break;case"XZ":p.copy(lt),D.copy(rt);break;case"XYZ":case"E":D.set(0,0,0);break}break;default:D.set(0,0,0)}D.length()===0?this.quaternion.copy(this.cameraQuaternion):(Gt.lookAt(M.set(0,0,0),D,p),this.quaternion.setFromRotationMatrix(Gt)),super.updateMatrixWorld(e)}}var Ae=pt("<!> <!>",1);function Te(l,e){Tt(e,!0);const n=()=>Bt(y,"$camera",o),[o,i]=Wt();let s=Z(e,"autoPauseOrbitControls",3,!0),t=Z(e,"autoPauseTrackballControls",3,!0),a=Z(e,"controls",15),f=Z(e,"group",15),m=te(e,["$$slots","$$events","$$legacy","autoPauseOrbitControls","autoPauseTrackballControls","object","controls","group","children"]);const{camera:y,dom:T,invalidate:S,scene:E}=Qt(),{orbitControls:L,trackballControls:x}=ue();let u=nt(!1);ot(()=>[L,P(u),s()],([c,v,X])=>{if(!(!c||!c.enabled&&v))return c.enabled=!(v&&X),()=>{c.enabled=!0}}),ot(()=>[x,P(u),t()],([c,v,X])=>{if(!(!c||!c.enabled&&v))return c.enabled=!(v&&X),()=>{c.enabled=!0}});const w=new ge(y.current,T),_=new pe;wt(()=>{w.camera=n()}),wt(()=>(w?.attach(e.object??_),()=>w?.detach()));const g=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ","visible","onmouseDown","onmouseUp","onobjectChange"];let b=nt(Zt({})),I=nt(Zt({}));wt(()=>{$(b,{},!0),$(I,{},!0),Object.keys(m).forEach(c=>{wt(()=>{g.includes(c)?P(b)[c]=m[c]:P(I)[c]=m[c]})})});const z=c=>{S(),w.dragging&&!P(u)?$(u,!0):!w.dragging&&P(u)&&$(u,!1),e.onchange?.(c)};var G=Ae(),W=q(G);R(W,Ht({get is(){return w},onchange:z},()=>P(b),{attach:({ref:c})=>{const v=c.getHelper();return E.add(v),()=>{E.remove(v)}},dispose:!1,oncreate:c=>()=>c.dispose(),get ref(){return a()},set ref(c){a(c)}}));var H=it(W,2);R(H,Ht({get is(){return _}},()=>P(I),{get ref(){return f()},set ref(c){f(c)},children:(c,v)=>{var X=vt(),N=q(X);Jt(N,()=>e.children??K,()=>({ref:_})),F(c,X)},$$slots:{default:!0}})),F(l,G),Xt(),i()}const Et=(l,e=K,n=K,o=K,i=K,s=K)=>{var t=vt(),a=q(t);{const f=(m,y)=>{let T=()=>y?.().ref;var S=Qe(),E=q(S);{var L=u=>{Te(u,{get object(){return T()}})};zt(E,u=>{s()&&u(L)})}var x=it(E,2);st(x,()=>R.Mesh,(u,w)=>{w(u,{oncreate:_=>_.lookAt(0,0,0),children:(_,g)=>{var b=Xe(),I=q(b);{var z=H=>{var c=vt(),v=q(c);{let X=It(()=>[o()/2]);st(v,()=>R.CircleGeometry,(N,C)=>{C(N,{get args(){return P(X)}})})}F(H,c)},G=H=>{var c=vt(),v=q(c);{let X=It(()=>[o(),o()]);st(v,()=>R.PlaneGeometry,(N,C)=>{C(N,{get args(){return P(X)}})})}F(H,c)};zt(I,H=>{n()==="circle"?H(z):H(G,!1)})}var W=it(I,2);st(W,()=>R.MeshBasicMaterial,(H,c)=>{c(H,{get color(){return e()},get side(){return Vt}})}),F(_,b)},$$slots:{default:!0}})}),F(m,S)};st(a,()=>R.Group,(m,y)=>{y(m,{get position(){return i()},children:f,$$slots:{default:!0}})})}F(l,t)};var Xe=pt("<!> <!>",1),Qe=pt("<!> <!>",1),Ye=pt("<!> <!> <!>",1);function Fe(l,e){Tt(e,!0);let n=Z(e,"color1",3,"#FF4F4F"),o=Z(e,"color2",3,"#FFD0CB"),i=Z(e,"color3",3,"#2223FF"),s=Z(e,"debug",3,!1),t=nt(void 0);ot(()=>[n(),o(),i()],()=>P(t)?.update()),$t(_e(l,{get visible(){return s()},children:(a,f)=>{var m=Ye(),y=q(m);Et(y,n,()=>"plane",()=>4,()=>[2,-10,-20],s);var T=it(y,2);Et(T,o,()=>"circle",()=>8,()=>[3,-5,0],s);var S=it(T,2);Et(S,i,()=>"plane",()=>10,()=>[-3,-2,4],s),F(a,m)},$$slots:{default:!0}}),a=>$(t,a),()=>P(t)),Xt()}export{Fe as L};
