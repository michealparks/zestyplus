import{g as xe,u as ce,a4 as Z,a5 as ie,h as u,s as Se}from"./E4cMcrld.js";const le=Symbol("analyser-context"),He=()=>{let t=ie(void 0),r,m;const h=1024,g=512,x=-90,_=-10,V=.8,S=.35,z=.08,R=.06,G=10;let M=new Uint8Array,T=new Float32Array,a=new Float32Array,J=new Float32Array(g),F=new Float32Array(g),K=new Float32Array,Q=0,te=0,k=0,H=0,L=0,P=0,W=0,A=0,re=0,ne=0,B=0,E=0,oe=!1,ae=0,C=0,U=0,D=0,se=!1,X=0,o={bass:0,lowMid:0,mid:0,highMid:0,treble:0,air:0},Y=0,j=0,q=[],s={bass:{a:0,b:0},lowMid:{a:0,b:0},mid:{a:0,b:0},highMid:{a:0,b:0},treble:{a:0,b:0},air:{a:0,b:0}};const v=n=>Math.max(0,Math.min(1,n)),me=(n,l,c)=>n+(l-n)*c,pe=n=>v((n-x)/(_-x)),d=n=>Y?Math.max(0,Math.min(a.length-1,Math.round(n/Y))):0,b=(n,l,c)=>{if(c<l)return 0;let f=0,p=0;for(let y=l;y<=c;y++)f+=n[y],p++;return p?f/p:0},we=(n,l=.02,c=1.6)=>{const f=Math.max(0,n-l)/(1-l);return Math.pow(v(f),1/c)},fe=()=>{if(!u(t)||!r)return;j=r.sampleRate,Y=j/u(t).fftSize;const n=20,l=Math.min(16e3,j/2),c=Math.log(n),f=Math.log(l);q=new Array(g);for(let p=0;p<g;p++){const y=Math.exp(c+p/g*(f-c)),I=Math.exp(c+(p+1)/g*(f-c)),e=d(y),i=d(I);q[p]={a:e,b:Math.max(e,i)}}s.bass={a:d(20),b:d(150)},s.lowMid={a:d(150),b:d(400)},s.mid={a:d(400),b:d(1200)},s.highMid={a:d(1200),b:d(3e3)},s.treble={a:d(3e3),b:d(8e3)},s.air={a:d(8e3),b:d(16e3)}},be=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({audio:{backgroundBlur:!1,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});r=new AudioContext;const l=r.createMediaStreamSource(n);Z(t,r.createAnalyser()),u(t).fftSize=h,u(t).smoothingTimeConstant=V,u(t).minDecibels=x,u(t).maxDecibels=_,l.connect(u(t));const c=u(t).frequencyBinCount;M=new Uint8Array(u(t).fftSize),T=new Float32Array(c),a=new Float32Array(c),K=new Float32Array(c),J=new Float32Array(g),F=new Float32Array(g),fe()}catch(n){console.error("Error accessing microphone:",n)}},ye=()=>{if(!u(t)||!r)return;u(t).getFloatFrequencyData(T);for(let e=0;e<T.length;e++)a[e]=pe(T[e]);for(let e=0;e<q.length;e++){const{a:i,b:w}=q[e],N=b(a,i,w);J[e]=b(a,i,w),F[e]=me(F[e],N,.25)}o.bass=b(a,s.bass.a,s.bass.b),o.lowMid=b(a,s.lowMid.a,s.lowMid.b),o.mid=b(a,s.mid.a,s.mid.b),o.highMid=b(a,s.highMid.a,s.highMid.b),o.treble=b(a,s.treble.a,s.treble.b),o.air=b(a,s.air.a,s.air.b),u(t).getByteTimeDomainData(M);let n=0,l=0;for(let e=0,i=M.length;e<i;e++){const w=(M[e]-128)/128,N=Math.abs(w);N>l&&(l=N),n+=w*w}Q=Math.sqrt(n/M.length),te=l;const c=Q,f=c>k?S:z;k+=(c-k)*f,H+=(k-H)*.03,L=Math.max(0,k-H);{const e=o.bass*.4+o.lowMid*.8+o.mid*1+o.highMid*.9+o.treble*.7+o.air*.4;P+=(e-P)*.2}W=we(P),X=W>R?G:Math.max(0,X-1),se=X>0;let p=0;for(let e=0;e<a.length;e++){const i=a[e]-K[e];i>0&&(p+=i),K[e]=a[e]}A=p/a.length;{B+=(A-B)*.05,E+=(Math.abs(A-B)-E)*.05;const e=B+2*E;oe=A>e,ae=v((A-e)/(1e-4+3*E))}let y=0,I=0;for(let e=0;e<a.length;e++){const i=a[e],w=e*(j/h);y+=w*i,I+=i}re=I>0?y/I:0;{const e=(o.bass+o.lowMid+o.mid)/3,i=(o.highMid+o.treble+o.air)/3;ne=v((i-e)*.75+.5)*2-1}{const e=o.bass*.9+L*.6,i=o.highMid*.9+L*.4,w=o.treble*.9+o.air*.7;C+=(e-C)*.3,U+=(i-U)*.3,D+=(w-D)*.25,C=v(C),U=v(U),D=v(D)}};ce(()=>(be(),()=>{try{m?.getTracks().forEach(n=>n.stop())}catch{}try{r?.close()}catch{}m=void 0,r=void 0,Z(t,void 0)})),ce(()=>{if(u(t)){const n=setInterval(ye,33.333333333333336);return()=>clearInterval(n)}}),Se(le,{get current(){return u(t)},get spectrumDb(){return T},get spectrum01(){return a},get log01(){return J},get logSmooth01(){return F},get bands(){return o},get rms(){return Q},get peak(){return te},get level(){return k},get slowLevel(){return H},get punch(){return L},get loudness(){return P},get energyCurve(){return W},get flux(){return A},get onset(){return oe},get onsetStrength(){return ae},get centroidHz(){return re},get tilt(){return ne},get kick(){return C},get snare(){return U},get hat(){return D},get active(){return se}})},Le=()=>xe(le),$="c80e549f03864691a94b026c06619501",ee="https://zesty.plus",Me="https://accounts.spotify.com/authorize",ue="https://accounts.spotify.com/api/token",ve=["user-read-private","user-read-email","user-read-playback-state","user-read-currently-playing"].join(" "),O={get access(){return localStorage.getItem("access_token")??""},get refresh(){return localStorage.getItem("refresh_token")??""},get expiresIn(){return localStorage.getItem("refresh_in")??""},get expires(){return localStorage.getItem("expires")??""}},he=t=>{const{access_token:r,refresh_token:m,expires_in:h}=t;localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",m),localStorage.setItem("expires_in",h);const g=Date.now(),x=new Date(g+Number(h)*1e3);localStorage.setItem("expires",x.toString())},ke=async()=>{const r=(S=>{const z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return crypto.getRandomValues(new Uint8Array(S)).reduce((G,M)=>G+z[M%z.length],"")})(64),m=async S=>{const R=new TextEncoder().encode(S);return window.crypto.subtle.digest("SHA-256",R)},h=S=>btoa(String.fromCharCode(...new Uint8Array(S))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),g=await m(r),x=h(g),_=new URL(Me);window.localStorage.setItem("code_verifier",r);const V={response_type:"code",client_id:$,scope:ve,code_challenge_method:"S256",code_challenge:x,redirect_uri:ee};_.search=new URLSearchParams(V).toString(),window.location.href=_.toString()},Ae=async t=>{const r=localStorage.getItem("code_verifier");return await(await fetch(ue,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:$,grant_type:"authorization_code",code:t,redirect_uri:ee,code_verifier:r??""})})).json()},_e=async()=>{const r=await(await fetch(ue,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:$,grant_type:"refresh_token",refresh_token:O.refresh??""})})).json();if(r.error)return!0;he(r)},ze=async()=>(await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${O.access}`}})).json(),Te=async t=>new Promise(r=>{setTimeout(r,t)}),ge=async()=>{const r=new URLSearchParams(window.location.search).get("code");if(r){const m=await Ae(r);he(m);const h=new URL(window.location.href);h.searchParams.delete("code");const g=h.search?h.href:h.href.replace("?","");window.history.replaceState({},document.title,g)}if(O.access){const m=await ze();return m.error?.status===401?await _e()?{state:"logged-out"}:(await Te(2e3),ge()):{state:"logged-in",userData:m}}return{state:"logged-out"}},Ce=()=>ke(),Ue=async()=>{localStorage.clear(),window.location.href=ee};class De{#e=ie("pending");get current(){return u(this.#e)}set current(r){Z(this.#e,r,!0)}}const de=new De;ge().then(({state:t})=>{de.current=t});const Ie={token:O,authenticated:de,login:Ce,logout:Ue},Pe=()=>Ie;export{Le as a,He as p,Pe as u};
