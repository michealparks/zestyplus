import{L as q}from"./CxTOoE5I.js";import{ec as k,af as I,aa as C,a9 as B,fS as J,dl as P,a1 as O,V as g,x as $,n as K,g as M,et as Q,M as X,A as Y}from"./C_yIfSnU.js";const F=new P,A=new g;class U extends k{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new I(t,3)),this.setAttribute("uv",new I(i,2))}applyMatrix4(t){const i=this.attributes.instanceStart,n=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(t),n.applyMatrix4(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let i;t instanceof Float32Array?i=t:Array.isArray(t)&&(i=new Float32Array(t));const n=new C(i,6,1);return this.setAttribute("instanceStart",new B(n,3,0)),this.setAttribute("instanceEnd",new B(n,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let i;t instanceof Float32Array?i=t:Array.isArray(t)&&(i=new Float32Array(t));const n=new C(i,6,1);return this.setAttribute("instanceColorStart",new B(n,3,0)),this.setAttribute("instanceColorEnd",new B(n,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new J(t.geometry)),this}fromLineSegments(t){const i=t.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new P);const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;t!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(t),F.setFromBufferAttribute(i),this.boundingBox.union(F))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new O),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(t!==void 0&&i!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let e=0;for(let o=0,l=t.count;o<l;o++)A.fromBufferAttribute(t,o),e=Math.max(e,n.distanceToSquared(A)),A.fromBufferAttribute(i,o),e=Math.max(e,n.distanceToSquared(A));this.boundingSphere.radius=Math.sqrt(e),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}const G=new g,N=new g,r=new M,a=new M,h=new M,z=new g,T=new X,c=new Q,j=new g,L=new P,_=new O,p=new M,v=new M;let m,w;function D(u,t,i){return p.set(0,0,-t,1).applyMatrix4(u.projectionMatrix),p.multiplyScalar(1/p.w),p.x=w/i.width,p.y=w/i.height,p.applyMatrix4(u.projectionMatrixInverse),p.multiplyScalar(1/p.w),Math.abs(Math.max(p.x,p.y))}function Z(u,t){const i=u.matrixWorld,n=u.geometry,e=n.attributes.instanceStart,o=n.attributes.instanceEnd,l=Math.min(n.instanceCount,e.count);for(let s=0,y=l;s<y;s++){c.start.fromBufferAttribute(e,s),c.end.fromBufferAttribute(o,s),c.applyMatrix4(i);const x=new g,d=new g;m.distanceSqToSegment(c.start,c.end,d,x),d.distanceTo(x)<w*.5&&t.push({point:d,pointOnLine:x,distance:m.origin.distanceTo(d),object:u,face:null,faceIndex:s,uv:null,uv1:null})}}function tt(u,t,i){const n=t.projectionMatrix,e=u.matrixWorld,o=u._resolution,l=u.geometry,s=l.attributes.instanceStart,y=l.attributes.instanceEnd,x=Math.min(l.instanceCount,s.count),d=-t.near;m.at(1,h),h.w=1,h.applyMatrix4(t.matrixWorldInverse),h.applyMatrix4(n),h.multiplyScalar(1/h.w),h.x*=o.x/2,h.y*=o.y/2,h.z=0,z.copy(h),T.multiplyMatrices(t.matrixWorldInverse,e);for(let f=0,V=x;f<V;f++){if(r.fromBufferAttribute(s,f),a.fromBufferAttribute(y,f),r.w=1,a.w=1,r.applyMatrix4(T),a.applyMatrix4(T),r.z>d&&a.z>d)continue;if(r.z>d){const S=r.z-a.z,b=(r.z-d)/S;r.lerp(a,b)}else if(a.z>d){const S=a.z-r.z,b=(a.z-d)/S;a.lerp(r,b)}r.applyMatrix4(n),a.applyMatrix4(n),r.multiplyScalar(1/r.w),a.multiplyScalar(1/a.w),r.x*=o.x/2,r.y*=o.y/2,a.x*=o.x/2,a.y*=o.y/2,c.start.copy(r),c.start.z=0,c.end.copy(a),c.end.z=0;const W=c.closestPointToPointParameter(z,!0);c.at(W,j);const E=Y.lerp(r.z,a.z,W),R=E>=-1&&E<=1,H=z.distanceTo(j)<w*.5;if(R&&H){c.start.fromBufferAttribute(s,f),c.end.fromBufferAttribute(y,f),c.start.applyMatrix4(e),c.end.applyMatrix4(e);const S=new g,b=new g;m.distanceSqToSegment(c.start,c.end,b,S),i.push({point:b,pointOnLine:S,distance:m.origin.distanceTo(b),object:u,face:null,faceIndex:f,uv:null,uv1:null})}}}class et extends ${constructor(t=new U,i=new q({color:Math.random()*16777215})){super(t,i),this.isLineSegments2=!0,this.type="LineSegments2",this._resolution=new K}computeLineDistances(){const t=this.geometry,i=t.attributes.instanceStart,n=t.attributes.instanceEnd,e=new Float32Array(2*i.count);for(let l=0,s=0,y=i.count;l<y;l++,s+=2)G.fromBufferAttribute(i,l),N.fromBufferAttribute(n,l),e[s]=s===0?0:e[s-1],e[s+1]=e[s]+G.distanceTo(N);const o=new C(e,2,1);return t.setAttribute("instanceDistanceStart",new B(o,1,0)),t.setAttribute("instanceDistanceEnd",new B(o,1,1)),this}onBeforeRender(t){t.getViewport(v),this._resolution.set(v.z,v.w)}raycast(t,i){const n=this.material.worldUnits,e=t.camera;e===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=t.params.Line2!==void 0&&t.params.Line2.threshold||0;m=t.ray;const l=this.matrixWorld,s=this.geometry;w=this.material.linewidth+o,s.boundingSphere===null&&s.computeBoundingSphere(),_.copy(s.boundingSphere).applyMatrix4(l);let x;if(n)x=w*.5;else{const f=Math.max(e.near,_.distanceToPoint(m.origin));x=D(e,f,this._resolution)}if(_.radius+=x,m.intersectsSphere(_)===!1)return;s.boundingBox===null&&s.computeBoundingBox(),L.copy(s.boundingBox).applyMatrix4(l);let d;if(n)d=w*.5;else{const f=Math.max(e.near,L.distanceToPoint(m.origin));d=D(e,f,this._resolution)}L.expandByScalar(d),m.intersectsBox(L)!==!1&&(n?Z(this,i):tt(this,e,i))}}class nt extends U{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const i=t.length-3,n=new Float32Array(2*i);for(let e=0;e<i;e+=3)n[2*e]=t[e],n[2*e+1]=t[e+1],n[2*e+2]=t[e+2],n[2*e+3]=t[e+3],n[2*e+4]=t[e+4],n[2*e+5]=t[e+5];return super.setPositions(n),this}setColors(t){const i=t.length-3,n=new Float32Array(2*i);for(let e=0;e<i;e+=3)n[2*e]=t[e],n[2*e+1]=t[e+1],n[2*e+2]=t[e+2],n[2*e+3]=t[e+3],n[2*e+4]=t[e+4],n[2*e+5]=t[e+5];return super.setColors(n),this}setFromPoints(t){const i=t.length-1,n=new Float32Array(6*i);for(let e=0;e<i;e++)n[6*e]=t[e].x,n[6*e+1]=t[e].y,n[6*e+2]=t[e].z||0,n[6*e+3]=t[e+1].x,n[6*e+4]=t[e+1].y,n[6*e+5]=t[e+1].z||0;return super.setPositions(n),this}fromLine(t){const i=t.geometry;return this.setPositions(i.attributes.position.array),this}}class rt extends et{constructor(t=new nt,i=new q({color:Math.random()*16777215})){super(t,i),this.isLine2=!0,this.type="Line2"}}export{rt as L,nt as a};
